var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var card_item=function(_super){function card_item(){var _this=_super.call(this)||this;return _this.m_id=0,_this.m_root=new Laya.Sprite,_this.m_frame=new Laya.Sprite,_this.m_bk=new Laya.Sprite,_this.m_icon=new Laya.Sprite,_this.m_info_label=new Laya.Sprite,_this.m_ani=new Laya.Animation,_this.m_parent=null,_this.m_open_tp=0,_this.m_show_animation=!1,_this.m_card_id=0,_this.m_card_type=0,_this.m_card_shape=0,_this.m_card_hp=0,_this.m_card_atk=0,_this.m_card_duration=0,_this.m_name="",_this.m_desc="",_this.m_info="",_this.m_info1="",_this.m_waitani_list=new Array,_this.mouseEnabled=!0,_this.addChild(_this.m_root),_this.m_root.pivot(72,92),_this.m_root.width=144,_this.m_root.height=184,_this.m_root.pos(72,92),_this}return __extends(card_item,_super),card_item.prototype._is_valid=function(){return 0!=this.m_card_id},card_item.prototype.update_data=function(cid,ctype,cshape,chp,catk,cdu){this.m_card_id=cid,this.m_card_type=ctype,this.m_card_shape=cshape,this.m_card_atk=catk,this.m_card_hp=chp,this.m_card_duration=cdu,this.del_icon(),0!=this.m_card_shape?(icon_mgr.fastset_item_icon(this.m_card_shape,this.m_icon,this),this.show_frame(this.m_card_type),this.m_card_type==data.CARD_TYPE_ARMOR||this.m_card_type==data.CARD_TYPE_SWORD||this.m_card_type==data.CARD_TYPE_SPELL||(this.m_card_type,data.CARD_TYPE_TRAP),this.set_icon_wh(120,120)):this.show_bk()},card_item.prototype.update_info=function(name,desc,info,info1){this.m_name=name,this.m_desc=desc,this.m_info=info,this.m_info1=info1,this.update_draw_info()},card_item.prototype.clear_data=function(){this.stop_animation(),this.clear_img(),this.del_icon(),this.m_card_id=0},card_item.prototype.register_event=function(){this.m_root.on(Laya.Event.MOUSE_OVER,this,this.on_over),this.m_root.on(Laya.Event.MOUSE_OUT,this,this.on_out),this.m_root.on(Laya.Event.MOUSE_DOWN,this,this.on_mousedown),this.m_root.on(Laya.Event.MOUSE_UP,this,this.on_mouseup)},card_item.prototype.unregister_event=function(){this.m_root.off(Laya.Event.MOUSE_OVER,this,this.on_over),this.m_root.off(Laya.Event.MOUSE_OUT,this,this.on_out),this.m_root.off(Laya.Event.MOUSE_DOWN,this,this.on_mousedown),this.m_root.off(Laya.Event.MOUSE_UP,this,this.on_mouseup)},card_item.prototype.on_mousedown=function(ud){void 0===ud&&(ud=null),this.m_parent&&this._is_valid()&&this.m_parent.on_mousedown_card(this.m_id,this.m_card_id)},card_item.prototype.on_mouseup=function(ud){void 0===ud&&(ud=null),this.m_parent&&this._is_valid()&&this.m_parent.on_mouseup_card(this.m_id,this.m_card_id)},card_item.prototype.on_over=function(ud){if(void 0===ud&&(ud=null),this._is_valid()&&!this.m_show_animation&&(this.m_root.scale(1.2,1.2),this.m_parent&&0!=this.m_card_id&&0!=this.m_card_shape)){var x=this.x+144,y=this.y,pt=new Laya.Point(x,y),nx=(pt=this.m_id<this.m_parent.m_hand_id_start?this.m_parent.UIins.m_card_sp.localToGlobal(pt):this.m_parent.UIins.m_hand_sp.localToGlobal(pt)).x-144-360;pt.x>Laya.stage.designWidth-360&&0<=nx&&(pt.x=nx),helper.show_float_text_tips(this.m_desc+"\n"+this.m_info,pt.x,pt.y)}},card_item.prototype.on_out=function(ud){void 0===ud&&(ud=null),this._is_valid()&&(this.m_show_animation||(this.m_root.scale(1,1),this.m_parent&&0!=this.m_card_id&&helper.hide_float_text_tips()))},card_item.prototype.show_attacked=function(){this.m_show_animation?this.m_waitani_list.push(-2):(this.on_out(),this.stop_animation(),this.m_root.addChild(this.m_ani),this.m_ani.pos(72,92),this.m_ani.loadAnimation("game_ani/attack.ani"),this.m_ani.play(),this.m_show_animation=!0,Laya.Tween.to(this.m_root,{rotation:-10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase1)))},card_item.prototype.on_showattacked_phase1=function(){Laya.Tween.to(this.m_root,{rotation:10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase2))},card_item.prototype.on_showattacked_phase2=function(){Laya.Tween.to(this.m_root,{rotation:-10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase3))},card_item.prototype.on_showattacked_phase3=function(){Laya.Tween.to(this.m_root,{rotation:10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase4))},card_item.prototype.on_showattacked_phase4=function(){Laya.Tween.to(this.m_root,{rotation:-10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase5))},card_item.prototype.on_showattacked_phase5=function(ud){void 0===ud&&(ud=null),this.stop_animation(!0)},card_item.prototype.show_attack=function(){this.m_show_animation?this.m_waitani_list.push(-1):(this.on_out(),this.stop_animation(),this.m_show_animation=!0,this.m_root.scale(1.2,1.2),Laya.Tween.to(this.m_root,{rotation:-20},50,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattack_phase1)))},card_item.prototype.on_showattack_phase1=function(){Laya.Tween.to(this.m_root,{rotation:0},50,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattack_phase2))},card_item.prototype.on_showattack_phase2=function(ud){void 0===ud&&(ud=null),this.stop_animation(!0)},card_item.prototype.show_open=function(tp){this.m_show_animation?this.m_waitani_list.push(tp):(this.on_out(),this.stop_animation(),this.m_show_animation=!0,this.m_open_tp=tp,this.show_bk(),Laya.Tween.to(this.m_root,{scaleX:0},100,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showopen_phase1)))},card_item.prototype.on_showopen_phase1=function(ud){void 0===ud&&(ud=null),this.show_frame(this.m_open_tp),Laya.Tween.to(this.m_root,{scaleX:1},100,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showopen_phase2))},card_item.prototype.on_showopen_phase2=function(ud){void 0===ud&&(ud=null),this.show_frame(this.m_open_tp),this.stop_animation(!0)},card_item.prototype.stop_animation=function(b_end){if(void 0===b_end&&(b_end=!1),this.m_show_animation=!1,Laya.Tween.clearAll(this.m_root),this.m_root.scale(1,1),this.m_root.rotation=0,this.m_ani.removeSelf(),b_end&&0<this.m_waitani_list.length){var tp=this.m_waitani_list.shift();-2==tp?this.show_attacked():-1==tp?this.show_attack():this.show_open(tp)}},card_item.prototype.re_init=function(){this.m_name="",this.m_desc="",this.m_info="",this.m_card_id=0,this.m_card_type=0,this.m_card_shape=0,this.m_card_hp=0,this.m_card_atk=0,this.m_card_duration=0},card_item.prototype.show_bk=function(){this.clear_img(),this.m_frame.graphics.loadImage("card/Cardback01_minmin.png"),this.m_frame.pivot(72,92),this.m_frame.width=144,this.m_frame.height=184,this.m_frame.pos(72,92),this.m_root.addChild(this.m_frame)},card_item.prototype.set_icon_wh=function(w,h){this.m_icon.pivot(w/2,h/2),this.m_icon.width=w,this.m_icon.height=h},card_item.prototype.show_frame=function(tp){this.clear_img(),this.m_root.addChild(this.m_bk),this.m_root.addChild(this.m_icon),this.m_root.addChild(this.m_frame),this.m_root.addChild(this.m_info_label),this.m_frame.pivot(61,92),this.m_frame.width=122,this.m_frame.height=184,this.m_frame.pos(72,92),this.m_bk.pivot(50,80),this.m_bk.width=100,this.m_bk.height=160,this.m_bk.pos(72,92),this.m_icon.pos(72,92),1==tp?(this.m_frame.graphics.loadImage("card/Frame_TeamBg_Lv2_min.png"),this.m_bk.graphics.loadImage("card/CardBg_Big4_min.png")):2==tp?(this.m_frame.graphics.loadImage("card/Frame_TeamBg_Lv3_min.png"),this.m_bk.graphics.loadImage("card/CardBg_Big4_min.png")):3==tp?(this.m_frame.graphics.loadImage("card/Frame_TeamBg_Lv4_min.png"),this.m_bk.graphics.loadImage("card/CardBg_Big4_min.png")):4==tp?(this.m_frame.graphics.loadImage("card/Frame_TeamBg_Lv5_min.png"),this.m_bk.graphics.loadImage("card/CardBg_Big5_min.png")):(this.m_frame.graphics.loadImage("card/Frame_TeamBg_Lv1_min.png"),this.m_bk.graphics.loadImage("card/CardBg_Big2_min.png")),this.update_draw_info()},card_item.prototype.update_draw_info=function(){this.m_info_label.graphics.clear(),this.m_info_label.graphics.fillBorderText(this.m_name,72,144,"20px SimHei","#ffffff","#000000",2,"center"),this.m_info_label.graphics.fillBorderText(this.m_info,104,30,"20px SimHei","#ffffff","#000000",2,"right"),this.m_info_label.graphics.fillBorderText(this.m_info1,104,50,"20px SimHei","#ffffff","#000000",2,"right")},card_item.prototype.clear_img=function(){this.m_root.removeChildren(),this.m_frame.graphics.clear(),this.m_bk.graphics.clear(),this.m_info_label.graphics.clear()},card_item.prototype.del_icon=function(){icon_mgr.fastdel_icon(this.m_icon)},card_item}(Laya.Sprite);widget.card_item=card_item;var card_ui=function(_super){function card_ui(){var _this=_super.call(this,"res/atlas/card.atlas",ui.game.card_mainUI)||this;_this.UIins=null,_this.m_card_list=new Array,_this.m_card_max=16,_this.m_card_linecnt=4,_this.m_card_dx=20,_this.m_card_dy=0,_this.m_card_gap=0,_this.m_card_w=144,_this.m_card_h=184,_this.m_card_cls_sign="card_ui_card_item",_this.m_hand_id_start=1e4,_this.m_hand_list=new Array,_this.m_hand_max=5,_this.m_hand_gap=130,_this.m_arror_ani=null,_this.m_arror_start=!1,_this.m_start_pt=new Laya.Point,_this.m_end_pt=new Laya.Point,_this.m_arror_startid=0,_this.m_data_ins=null,_this.m_main_ins=null,_this.m_b_end=!1,_this.append_extrares("res/atlas/ani_res/attack.atlas",Laya.Loader.ATLAS),_this.append_extrares("game_ani/attack.ani",Laya.Loader.JSON),_this.m_layer=utils.WIDGET_LAYER.NORMAL;return _this.m_card_gap=(720-_this.m_card_w*_this.m_card_linecnt-2*_this.m_card_dx)/(_this.m_card_linecnt-1),_this}return __extends(card_ui,_super),card_ui.prototype.on_init=function(){},card_ui.prototype.show_head_attacked=function(){this.stop_head_attacked(),this.UIins.m_head_ani.loadAnimation("game_ani/attack.ani"),this.UIins.m_head_ani.play(),this.UIins.addChild(this.UIins.m_head_ani),Laya.Tween.to(this.UIins.m_head_img,{rotation:-10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase1))},card_ui.prototype.on_showattacked_phase1=function(){Laya.Tween.to(this.UIins.m_head_img,{rotation:10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase2))},card_ui.prototype.on_showattacked_phase2=function(){Laya.Tween.to(this.UIins.m_head_img,{rotation:-10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase3))},card_ui.prototype.on_showattacked_phase3=function(){Laya.Tween.to(this.UIins.m_head_img,{rotation:10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase4))},card_ui.prototype.on_showattacked_phase4=function(){Laya.Tween.to(this.UIins.m_head_img,{rotation:-10},30,Laya.Ease.linearIn,laya.utils.Handler.create(this,this.on_showattacked_phase5))},card_ui.prototype.on_showattacked_phase5=function(ud){void 0===ud&&(ud=null),this.stop_head_attacked()},card_ui.prototype.stop_head_attacked=function(){this.UIins.m_head_ani.stop(),this.UIins.m_head_ani.removeSelf(),Laya.Tween.clearAll(this.UIins.m_head_img)},card_ui.prototype.init_allcard=function(){this.clear_allcard(),this.UIins.m_card_sp.width=720,this.UIins.m_card_sp.height=1280;for(var i=0;i<this.m_card_max;++i){var citem=utils.getitembycls(this.m_card_cls_sign,card_item);citem.re_init(),citem.m_parent=this,citem.register_event(),this.UIins.m_card_sp.addChild(citem),citem.x=this.m_card_dx+(this.m_card_w+this.m_card_gap)*(i%this.m_card_linecnt),citem.y=this.m_card_dy+(this.m_card_h+4)*(Math.ceil((i+1)/this.m_card_linecnt)-1),citem.m_id=i,this.m_card_list.push(citem),citem.clear_data()}},card_ui.prototype.clear_allcard=function(){for(var i=0;i<this.m_card_list.length;++i){var citem=this.m_card_list[i];citem.clear_data(),citem.stop_animation(),citem.removeSelf(),citem.m_parent=null,citem.unregister_event(),citem.clear_img(),citem.del_icon(),utils.recover(this.m_card_cls_sign,citem)}this.m_card_list=new Array},card_ui.prototype.init_allhand=function(){this.clear_allhand(),this.UIins.m_hand_sp.width=720,this.UIins.m_hand_sp.height=200;for(var i=0;i<this.m_hand_max;++i){var citem=utils.getitembycls(this.m_card_cls_sign,card_item);citem.re_init(),citem.m_parent=this,citem.register_event(),this.UIins.m_hand_sp.addChild(citem),citem.x=this.m_hand_gap*i,citem.y=0,citem.m_id=this.m_hand_id_start+i,this.m_hand_list.push(citem),citem.clear_data()}},card_ui.prototype.clear_allhand=function(){for(var i=0;i<this.m_hand_list.length;++i){var citem=this.m_hand_list[i];citem.clear_data(),citem.stop_animation(),citem.removeSelf(),citem.m_parent=null,citem.unregister_event(),citem.clear_img(),citem.del_icon(),utils.recover(this.m_card_cls_sign,citem)}this.m_hand_list=new Array},card_ui.prototype.on_show=function(flag){flag?(this.m_b_end=!1,this.m_data_ins=data.get_data(data_enum.DATA_CARD),this.m_main_ins=game.get_module(module_enum.MODULE_CARD),this.UIins=this.m_ui,this.UIins.m_closebtn.on(Laya.Event.CLICK,this,this.on_click_closebtn),this.init_allcard(),this.init_allhand(),this.m_arror_ani||(this.m_arror_ani=new Laya.Animation,this.m_arror_ani.loadAnimation("game_ani/arrow.ani"),this.m_arror_ani.play()),this.UIins.on(Laya.Event.MOUSE_DOWN,this,this.on_mousedown),this.UIins.on(Laya.Event.MOUSE_UP,this,this.on_mouseup),this.UIins.on(Laya.Event.MOUSE_MOVE,this,this.on_mousemove),this.UIins.m_delicon.on(Laya.Event.MOUSE_UP,this,this.on_mouseupon_del),this.register_event(game_event.EVENT_CARD_UPDATEHANDS,this.on_update_hands),this.register_event(game_event.EVENT_CARD_UPDATECARDS,this.on_udpate_cards),this.register_event(game_event.EVENT_CARD_UPDATEDLV,this.on_updatedlv),this.register_event(game_event.EVENT_CARD_CARDCHANGED,this.on_cardchanged),this.register_event(game_event.EVENT_CARD_ATTACK,this.on_card_attack),this.register_event(game_event.EVENT_CARD_DELCARD,this.on_delcard),this.register_event(game_event.EVENT_CARD_OPENCARD,this.on_opencard),this.register_event(game_event.EVENT_CARD_PLAYERINFO,this.on_playerinfo),this.register_event(game_event.EVENT_CARD_END,this.on_end),this.on_update_hands(),this.on_udpate_cards(),this.on_playerinfo(),this.on_updatedlv()):(this.m_b_end=!1,this.m_data_ins=null,this.m_main_ins=null,this.UIins.off(Laya.Event.MOUSE_DOWN,this,this.on_mousedown),this.UIins.off(Laya.Event.MOUSE_UP,this,this.on_mouseup),this.UIins.off(Laya.Event.MOUSE_MOVE,this,this.on_mousemove),this.UIins.m_delicon.off(Laya.Event.MOUSE_UP,this,this.on_mouseupon_del),this.m_arror_ani&&(this.m_arror_ani.removeSelf(),this.m_arror_ani.clear(),this.m_arror_ani.destroy(),this.m_arror_ani=null),this.stop_head_attacked(),this.clear_allcard(),this.clear_allhand(),this.UIins.m_closebtn.off(Laya.Event.CLICK,this,this.on_click_closebtn),this.unregister_allevent(),this.UIins=null)},card_ui.prototype.on_udpate_cards=function(ud){void 0===ud&&(ud=null);for(var cdata=data.get_data(data_enum.DATA_CARD),i=0;i<this.m_card_list.length;++i){var citem=this.m_card_list[i];if(citem.clear_data(),citem.stop_animation(),i<cdata.m_cards.length){var hdata=cdata.m_cards[i];if(0!=hdata.m_id){citem.update_data(hdata.m_id,hdata.m_type,hdata.m_shape,hdata.m_hp,hdata.m_atk,hdata.m_duration);var info=this._gen_card_info(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration),info1=this._gen_card_info1(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration);citem.update_info(hdata.m_name,hdata.m_desc,info,info1)}}}},card_ui.prototype.on_update_hands=function(ud){void 0===ud&&(ud=null);for(var i=0;i<this.m_hand_list.length;++i){(citem=this.m_hand_list[i]).clear_data(),citem.stop_animation()}var cdata=data.get_data(data_enum.DATA_CARD);for(i=0;i<cdata.m_hands.length;++i){var hdata=cdata.m_hands[i];if(i<this.m_hand_list.length){var citem;(citem=this.m_hand_list[i]).update_data(hdata.m_id,hdata.m_type,hdata.m_shape,hdata.m_hp,hdata.m_atk,hdata.m_duration);var info=this._gen_card_info(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration),info1=this._gen_card_info1(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration);citem.update_info(hdata.m_name,hdata.m_desc,info,info1)}}},card_ui.prototype.on_updatedlv=function(ud){void 0===ud&&(ud=null),this.UIins.m_dlv.text=this.m_data_ins.m_dlv.toString(),helper.show_text_tips(game.L_CARD_ENTERDLV+this.m_data_ins.m_dlv.toString()+game.L_CARD_ENTERDLV1)},card_ui.prototype._get_card_item=function(card_id){for(var citem=null,i=0;i<this.m_card_list.length;++i){if((titem=this.m_card_list[i]).m_card_id==card_id){citem=titem;break}}if(null==citem)for(i=0;i<this.m_hand_list.length;++i){var titem;if((titem=this.m_hand_list[i]).m_card_id==card_id){citem=titem;break}}return citem},card_ui.prototype.on_cardchanged=function(ud){void 0===ud&&(ud=null);var card_id=ud,hdata=this.m_data_ins.get_card_data(card_id),citem=this._get_card_item(card_id);if(null!=citem){citem.update_data(hdata.m_id,hdata.m_type,hdata.m_shape,hdata.m_hp,hdata.m_atk,hdata.m_duration);var info=this._gen_card_info(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration),info1=this._gen_card_info1(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration);citem.update_info(hdata.m_name,hdata.m_desc,info,info1)}else core.game_errlog("on_cardchanged error!have not this card "+card_id.toString())},card_ui.prototype.on_card_attack=function(ud){void 0===ud&&(ud=null);var citem,sid=ud[0],did=ud[1];ud[2];0!=sid&&(null!=(citem=this._get_card_item(sid))&&citem.show_attack());0==did?this.show_head_attacked():null!=(citem=this._get_card_item(did))&&citem.show_attacked()},card_ui.prototype.on_delcard=function(ud){void 0===ud&&(ud=null);for(var card_id=ud,i=0;i<this.m_card_list.length;++i){var citem=this.m_card_list[i];if(citem.m_card_id==card_id)return void citem.clear_data()}},card_ui.prototype.on_opencard=function(ud){void 0===ud&&(ud=null);for(var card_id=ud,hdata=this.m_data_ins.get_card_data(card_id),i=0;i<this.m_card_list.length;++i){var citem=this.m_card_list[i];if(citem.m_card_id==card_id){citem.update_data(hdata.m_id,hdata.m_type,hdata.m_shape,hdata.m_hp,hdata.m_atk,hdata.m_duration);var info=this._gen_card_info(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration),info1=this._gen_card_info1(hdata.m_type,hdata.m_hp,hdata.m_atk,hdata.m_duration);return citem.update_info(hdata.m_name,hdata.m_desc,info,info1),void citem.show_open(hdata.m_type)}}},card_ui.prototype.on_playerinfo=function(ud){void 0===ud&&(ud=null);var hp=this.m_data_ins.m_hp,hpmax=this.m_data_ins.m_hpmax,armor=this.m_data_ins.m_armor,stamina=this.m_data_ins.m_stamina,staminamax=this.m_data_ins.m_staminamax;this.m_data_ins.m_exp;this.UIins.m_armor.text=game.PROP_KEY_MAP.armor+":"+armor.toString();var info=game.PROP_KEY_MAP.stam+":"+stamina.toString()+"/"+staminamax.toString();info+="\n",info+=game.PROP_KEY_MAP.hp+":"+hp.toString()+"/"+hpmax.toString(),this.UIins.m_info.text=info,this.UIins.m_dlv.text=this.m_data_ins.m_dlv.toString()},card_ui.prototype.on_end=function(ud){void 0===ud&&(ud=null),this.m_b_end=!0,helper.show_text_tips(game.L_CARD_ENDTIPS)},card_ui.prototype._gen_card_info=function(tp,hp,atk,duration){var ret="";return tp==data.CARD_TYPE_MONSTER?ret=game.PROP_KEY_MAP.atk+":"+atk.toString():tp==data.CARD_TYPE_SWORD?ret=game.PROP_KEY_MAP.atk+":"+atk.toString():tp==data.CARD_TYPE_ARMOR&&(ret=game.PROP_KEY_MAP.def+":"+hp.toString()),ret},card_ui.prototype._gen_card_info1=function(tp,hp,atk,duration){var ret="";return tp==data.CARD_TYPE_MONSTER?ret=game.PROP_KEY_MAP.hp+":"+hp.toString():tp==data.CARD_TYPE_SWORD&&(ret=game.PROP_KEY_MAP.dura+":"+duration.toString()),ret},card_ui.prototype.show_arrow=function(sx,sy,dx,dy){core.game_tiplog("show_arrow ",sx,sy,dx,dy),this.UIins.addChild(this.m_arror_ani);var distance=Math.sqrt((dx-sx)*(dx-sx)+(dy-sy)*(dy-sy)),angle=180*Math.atan2(dy-sy,dx-sx)/Math.PI;core.game_tiplog("angle ",angle);var scale_v=distance/400;this.m_arror_ani.scale(scale_v,1),this.m_arror_ani.rotation=angle,this.m_arror_ani.x=sx+(dx-sx)/2,this.m_arror_ani.y=sy+(dy-sy)/2},card_ui.prototype.on_mousedown=function(e){},card_ui.prototype.on_mousemove=function(e){this.m_arror_start&&(this.m_end_pt.x=Laya.stage.mouseX,this.m_end_pt.y=Laya.stage.mouseY,this.m_end_pt=this.UIins.globalToLocal(this.m_end_pt),this.show_arrow(this.m_start_pt.x,this.m_start_pt.y,this.m_end_pt.x,this.m_end_pt.y))},card_ui.prototype.on_mouseup=function(e){this.m_arror_start=!1,this.hide_arrow()},card_ui.prototype.on_mouseupon_del=function(e){core.game_tiplog("on_mouseupon_del ",e.target.x,e.target.y),this.m_arror_start&&(this.m_arror_start=!1,this.hide_arrow(),this.m_main_ins.req_del_card(this.m_arror_startid))},card_ui.prototype.on_mouseup_card=function(card_idx,card_id){var citem=this._get_card_item(card_id);this.m_arror_start?(card_idx<this.m_hand_id_start?this.m_main_ins.req_use_card(this.m_arror_startid,card_id):this.m_main_ins.req_use_card(card_id,0),this.m_arror_start=!1,this.hide_arrow()):card_idx<this.m_hand_id_start?0==citem.m_card_shape?this.m_main_ins.req_flip_card(card_id):this.m_main_ins.req_click_card(card_id):this.m_main_ins.req_use_card(card_id,0)},card_ui.prototype.hide_arrow=function(){this.m_arror_ani.removeSelf()},card_ui.prototype.on_mousedown_card=function(card_idx,card_id){card_idx<this.m_hand_id_start||(this.m_start_pt.x=Laya.stage.mouseX,this.m_start_pt.y=Laya.stage.mouseY,this.m_start_pt=this.UIins.globalToLocal(this.m_start_pt),this.m_arror_start=!0,this.m_arror_startid=card_id)},card_ui.prototype.on_click_closebtn=function(ud){void 0===ud&&(ud=null),this.m_main_ins.req_quit(),this.show(!1)},card_ui.prototype.on_dispose=function(){this.m_main_ins=null,this.UIins=null,this.m_data_ins=null,this.stop_head_attacked(),this.clear_allhand(),this.clear_allcard()},card_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},card_ui}(utils.game_widget);widget.card_ui=card_ui}(widget||(widget={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var chat_face=function(_super){function chat_face(){var _this=_super.call(this,"res/atlas/emotion.atlas",ui.game.chat_faceUI)||this;return _this.m_layer=utils.WIDGET_LAYER.BACKGROUND,_this}return __extends(chat_face,_super),chat_face.prototype.on_init=function(){var designwh=helper.get_design_wh(),d_w=designwh.w,d_h=designwh.h;this.m_ui.x=(d_w-this.m_ui.width)/2,this.m_ui.y=d_h-this.m_ui.height-354},chat_face.prototype.on_show=function(flag){if(flag){this.UIins=this.m_ui,this.faceArray=[];for(var i=0;i<35;i++)this.faceArray.push({url:"emotion/face"+i+".png"});this.UIins.faceList.vScrollBarSkin="",this.UIins.faceList.array=this.faceArray,this.UIins.faceList.renderHandler=new Laya.Handler(this,this.onRender),this.UIins.faceList.mouseEnabled=!0,this.UIins.faceList.mouseHandler=new Laya.Handler(this,this.on_click)}else this.faceArray=[],this.UIins.faceList.array=[],this.UIins=null},chat_face.prototype.on_click=function(event,index){if(event.type==Laya.Event.CLICK){var e_str="#"+index.toString();this.fire_event_next_frame(game_event.EVENT_SELECT_EMOTION,e_str)}},chat_face.prototype.onRender=function(item,index){item.getChildByName("face").skin=this.faceArray[index].url},chat_face.prototype.update_ui=function(){},chat_face.prototype.on_dispose=function(){},chat_face.prototype.dispose=function(){_super.prototype.dispose.call(this)},chat_face}(utils.game_widget);widget.chat_face=chat_face}(widget||(widget={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var chat_input_ui=function(_super){function chat_input_ui(){var _this=_super.call(this,"res/atlas/chat.atlas",ui.game.chat_input_uiUI)||this;return _this.bottom_distance=0,_this.is_send=!1,_this.focus_ui="",_this.m_layer=utils.WIDGET_LAYER.TOP,_this}return __extends(chat_input_ui,_super),chat_input_ui.prototype.on_init=function(){this.m_ui.width=helper.get_design_w(),this.m_ui.bottom=200},chat_input_ui.prototype.on_show=function(flag){flag?(this.UIins=this.m_ui,this.register_event(game_event.EVENT_KEYBOARD_HIDDEN,this.on_hidden),this.register_event(game_event.EVENT_KEYBOARD_HEIGHT_CHANGE,this.on_height_change),this.UIins.img_send.on(Laya.Event.CLICK,this,this.on_send),this.UIins.on(Laya.Event.KEY_DOWN,this,this.on_key_event),this.m_ud&&(this.bottom_distance=Number(this.m_ud.height)),Laya.timer.once(300,this,this.on_timer),this.init_input_text()):(this.unregister_allevent(),this.UIins.img_send.off(Laya.Event.CLICK,this,this.on_send),this.UIins.off(Laya.Event.KEY_DOWN,this,this.on_key_event),Laya.timer.clearAll(this),this.UIins.input_msg.text="",this.is_send=!1,this.UIins=null)},chat_input_ui.prototype.on_timer=function(){this.UIins.bottom=-helper.get_design_h()+helper.get_design_h()/Laya.Browser.height*this.bottom_distance,this.UIins.input_msg.focus=!0},chat_input_ui.prototype.init_input_text=function(){this.focus_ui=helper.get_focus_str();var msg=helper.chat_input_dict.get(this.focus_ui);msg&&""!=msg&&(this.UIins.input_msg.text=msg)},chat_input_ui.prototype.on_key_event=function(evt){evt.keyCode==Laya.Keyboard.ENTER&&this.on_send()},chat_input_ui.prototype.on_send=function(){this.is_send=!0},chat_input_ui.prototype.on_hidden=function(){var msg=this.UIins.input_msg.text;this.is_send?(this.fire_event_next_frame(game_event.EVENT_CHAT_INPUT_SEND,{msg:msg}),helper.chat_input_dict.set(this.focus_ui,"")):(this.fire_event_next_frame(game_event.EVENT_CHAT_INPUT_MSG,{msg:msg}),helper.chat_input_dict.set(this.focus_ui,msg)),this.show(!1)},chat_input_ui.prototype.on_height_change=function(ud){ud&&void 0!==ud.height&&(this.bottom_distance=Number(ud.height))},chat_input_ui.prototype.on_dispose=function(){},chat_input_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},chat_input_ui}(utils.game_widget);widget.chat_input_ui=chat_input_ui}(widget||(widget={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var chat_ui=function(_super){function chat_ui(){var _this=_super.call(this,"res/atlas/chat.atlas",ui.game.chat_uiUI)||this;return _this.showAll=!1,_this.showFace=!1,_this.curChannel=3,_this.chatLine_pos=0,_this.input_record=new Array,_this.record_index=0,_this.isShowAllChat=!0,_this.b_visible=!0,_this.isFirstChanged=!0,_this.bottom_pos_y=0,_this.keyboard_y=0,_this.append_extrares("res/atlas/emotion.atlas",Laya.Loader.ATLAS),_this.m_layer=utils.WIDGET_LAYER.BACKGROUND,_this}return __extends(chat_ui,_super),chat_ui.prototype.on_init=function(){var designwh=helper.get_design_wh(),d_h=(designwh.w,designwh.h);this.m_ui.scale(.5,.5,!0),this.m_ui.x=0,this.m_ui.y=d_h,fontmgr.set_ui_font(this.m_ui)},chat_ui.prototype.on_show=function(flag){flag?(this.b_visible=!0,this.record_index=0,this.input_record=[],this.htmlele_arr=[],this.UIins=this.m_ui,this.shrinkChatBox(),this.UIins.chatPanel.vScrollBar.visible=!1,this.UIins.showBtn.on(Laya.Event.CLICK,this,this.on_change_msg_area),this.UIins.faceBtn.on(Laya.Event.CLICK,this,this.openFaceList),this.UIins.ch0.on(Laya.Event.CLICK,this,this.selectChannel),this.UIins.ch1.on(Laya.Event.CLICK,this,this.selectChannel),this.UIins.ch2.on(Laya.Event.CLICK,this,this.selectChannel),this.UIins.ch3.on(Laya.Event.CLICK,this,this.selectChannel),this.UIins.sendBtn.on(Laya.Event.CLICK,this,this.sendText),this.UIins.bagBtn.on(Laya.Event.CLICK,this,this.open_bag),this.UIins.on(Laya.Event.KEY_DOWN,this,this.onKeyEvent),this.UIins.inputInfo.on(Laya.Event.FOCUS,this,this.on_focus),this.register_event(game_event.EVENT_CHAT,this.new_chat),this.register_event(game_event.EVENT_SELECT_EMOTION,this.addEmotion),this.register_event(game_event.EVENT_CHANGE_INPUT_LIMIT,this.on_input_limit),this.register_event(game_event.EVENT_ENTERSCENE,this.onSceneChange),this.register_event(game_event.EVENT_TAB_SHOW,this.on_tab_show),this.register_event(game_event.EVENT_CHAT_CLEAR,this.clearAll),this.register_event(game_event.EVENT_CHAT_INPUT_MSG,this.on_input_msg),this.register_event(game_event.EVENT_CHAT_INPUT_SEND,this.on_input_send),this.update_ui(),this.fire_event_next_frame(game_event.EVENT_CHATWND_SIZE,this.UIins.y+this.UIins.showBtn.y-this.UIins.height)):(this.UIins.showBtn.off(Laya.Event.CLICK,this,this.on_change_msg_area),this.UIins.faceBtn.off(Laya.Event.CLICK,this,this.openFaceList),this.UIins.ch0.off(Laya.Event.CLICK,this,this.selectChannel),this.UIins.ch1.off(Laya.Event.CLICK,this,this.selectChannel),this.UIins.ch2.off(Laya.Event.CLICK,this,this.selectChannel),this.UIins.ch3.off(Laya.Event.CLICK,this,this.selectChannel),this.UIins.sendBtn.off(Laya.Event.CLICK,this,this.sendText),this.UIins.bagBtn.off(Laya.Event.CLICK,this,this.open_bag),this.UIins.off(Laya.Event.KEY_DOWN,this,this.onKeyEvent),this.UIins.inputInfo.off(Laya.Event.FOCUS,this,this.on_focus),this.unregister_allevent(),this.UIins.chatPanel.removeChildren(),this.UIins=null,this.chatLine_pos=0,this.input_record=[],this.record_index=0,this.htmlele_arr=[],Laya.Pool.clearBySign("chatLine"))},chat_ui.prototype.update_ui=function(){var chat_arr=data.get_data(data_enum.DATA_CHAT).get_all_chat();this.new_chat(chat_arr),this.UIins.input_bg.visible=!1,this.UIins.input_gray_bg.visible=!1},chat_ui.prototype.new_chat=function(chat_arr){var _this=this;chat_arr.forEach(function(element){var ch=element.ch,pid=element.pid,shape=element.shape,vip=element.vip,name=element.name,msg=element.msg,svrid=element.svrid,chatline=Laya.Pool.getItemByClass("chatLine",ChatLine);chatline.init(ch,pid,shape,vip,name,msg,svrid),_this.htmlele_arr.push(chatline),chatline.y=_this.chatLine_pos,_this.curChannel!=element.ch&&1!=_this.isShowAllChat||(_this.chatLine_pos+=chatline.height,_this.UIins.chatPanel.addChild(chatline),_this.UIins.chatPanel.vScrollBar.max=_this.UIins.chatPanel.contentHeight,Laya.Tween.to(_this.UIins.chatPanel.vScrollBar,{value:_this.UIins.chatPanel.vScrollBar.max},300)),80<=_this.htmlele_arr.length&&(_this.htmlele_arr.splice(0,50),_this.resetPanelInfo())}),data.get_data(data_enum.DATA_CHAT).clear_new_chat()},chat_ui.prototype.disable_ch_color=function(prev_ch){2==prev_ch?(this.UIins.ch2_bg.skin="chat/Tag2.png",this.UIins.ch2_title.skin="chat/bangpai2.png"):3==prev_ch?this.isShowAllChat?(this.UIins.ch0_bg.skin="chat/Tag2.png",this.UIins.ch0_title.skin="chat/zonghe2.png"):(this.UIins.ch1_bg.skin="chat/Tag2.png",this.UIins.ch1_title.skin="chat/shijie2.png"):4==prev_ch&&(this.UIins.ch3_bg.skin="chat/Tag2.png",this.UIins.ch3_title.skin="chat/kuafu2.png")},chat_ui.prototype.able_ch_color=function(){2==this.curChannel?(this.UIins.ch2_bg.skin="chat/Tag1.png",this.UIins.ch2_title.skin="chat/bangpai1.png"):3==this.curChannel?this.isShowAllChat?(this.UIins.ch0_bg.skin="chat/Tag1.png",this.UIins.ch0_title.skin="chat/zonghe1.png"):(this.UIins.ch1_bg.skin="chat/Tag1.png",this.UIins.ch1_title.skin="chat/shijie1.png"):4==this.curChannel&&(this.UIins.ch3_bg.skin="chat/Tag1.png",this.UIins.ch3_title.skin="chat/kuafu1.png")},chat_ui.prototype.selectChannel=function(e){switch(helper.play_sound("sound/mousedown_btn.wav"),e.target.name){case"ch0":if(this.isShowAllChat)return;this.disable_ch_color(this.curChannel),this.isShowAllChat=!0,this.curChannel=3,this.able_ch_color(),this.resetPanelInfo();break;case"ch1":if(this.isShowAllChat)this.disable_ch_color(this.curChannel),this.isShowAllChat=!1,this.curChannel=3,this.able_ch_color(),this.resetPanelInfo();else{if(3==this.curChannel)return;this.disable_ch_color(this.curChannel),this.curChannel=3,this.able_ch_color(),this.resetPanelInfo()}break;case"ch2":if(2==this.curChannel)return;this.disable_ch_color(this.curChannel),this.isShowAllChat=!1,this.curChannel=2,this.able_ch_color(),this.resetPanelInfo();break;case"ch3":if(4==this.curChannel)return;this.disable_ch_color(this.curChannel),this.isShowAllChat=!1,this.curChannel=4,this.able_ch_color(),this.resetPanelInfo()}},chat_ui.prototype.clearAll=function(){null!=this.UIins&&(this.UIins.chatPanel.removeChildren(),this.chatLine_pos=0)},chat_ui.prototype.resetPanelInfo=function(){var _this=this,arr=this.UIins.chatPanel._childs[0]._childs;this.UIins.chatPanel.removeChildren();for(var _i=0,arr_1=arr;_i<arr_1.length;_i++){var ele=arr_1[_i];Laya.Pool.recover("chatLine",ele)}this.chatLine_pos=0,this.get_cur_ch_chat().forEach(function(element){element.y=_this.chatLine_pos,_this.chatLine_pos+=element.height,_this.UIins.chatPanel.addChild(element)}),this.UIins.chatPanel.vScrollBar.max=this.UIins.chatPanel.contentHeight,this.UIins.chatPanel.vScrollBar.value=this.UIins.chatPanel.vScrollBar.max},chat_ui.prototype.get_cur_ch_chat=function(){var _this=this,cur_ch_chat_arr=[];return this.htmlele_arr.forEach(function(element){_this.isShowAllChat?cur_ch_chat_arr.push(element):_this.curChannel==element.channel&&cur_ch_chat_arr.push(element)}),cur_ch_chat_arr},chat_ui.prototype.sendText=function(){var msg=this.UIins.inputInfo.text;if(msg){if(this.input_record.push(msg),50<this.input_record.length&&this.input_record.shift(),this.record_index=this.input_record.length,"$"==msg[0])net.net_ins().send(protocol_def.C2S_CHAT_GM,{msg:msg}),this.UIins.inputInfo.text="";else if(5<=msg.length&&msg.match(/^&test/)){var data_arr=void 0;(data_arr=msg.split(" ")).shift(),helper.do_test(data_arr),this.UIins.inputInfo.text=""}else if(helper.is_sys_open("聊天",!0)){var channel=this.curChannel;channel==base.CHANNEL_GANG&&(0==helper.is_join_gang()?helper.show_text_tips(game.L_GANGNO):net.net_ins().send(protocol_def.C2S_CHAT,{ch:channel,msg:helper.trans_info(msg)})),net.net_ins().send(protocol_def.C2S_CHAT,{ch:channel,msg:helper.trans_info(msg)}),this.UIins.inputInfo.text=""}else this.UIins.inputInfo.text="";utils.widget_ins().is_widget_show(widget_enum.WIDGET_CHAT_FACE)&&(utils.widget_ins().show_widget(widget_enum.WIDGET_CHAT_FACE,!1),this.showFace=!1),helper.play_sound("sound/mousedown_btn.wav"),helper.chat_input_dict.set(helper.main_chat,"")}},chat_ui.prototype.open_bag=function(us){void 0===us&&(us=null),helper.play_sound("sound/mousedown_btn.wav")},chat_ui.prototype.addEmotion=function(e_str){this.UIins.inputInfo.text+=e_str,helper.chat_input_dict.set(helper.main_chat,this.UIins.inputInfo.text)},chat_ui.prototype.onSceneChange=function(ud){void 0===ud&&(ud=null),helper.is_wlmz_scene()?(this.UIins.ch0.mouseEnabled=!1,this.UIins.ch1.mouseEnabled=!1,this.UIins.ch2.mouseEnabled=!1,this.UIins.ch3.mouseEnabled=!1,this.isShowAllChat||(this.disable_ch_color(this.curChannel),this.isShowAllChat=!0,this.curChannel=3,this.able_ch_color(),this.resetPanelInfo(),585==this.UIins.height&&(this.UIins.ch1.y=242,this.UIins.ch1.visible=!0,this.UIins.ch2.visible=!1,this.UIins.ch3.visible=!1))):helper.is_guaji_scene()&&(this.UIins.ch0.mouseEnabled=!0,this.UIins.ch1.mouseEnabled=!0,this.UIins.ch2.mouseEnabled=!0,this.UIins.ch3.mouseEnabled=!0)},chat_ui.prototype.openFaceList=function(){this.showFace=!this.showFace,utils.widget_ins().show_widget(widget_enum.WIDGET_CHAT_FACE,this.showFace),helper.play_sound("sound/mousedown_btn.wav")},chat_ui.prototype.on_change_msg_area=function(){this.showAll=!this.showAll,this.showAll?this.blowUpChatBox():this.shrinkChatBox(),helper.play_sound("sound/mousedown_btn.wav")},chat_ui.prototype.on_tab_show=function(ud){void 0===ud&&(ud=null);var b_visible=!ud.flag;this.b_visible!=b_visible&&(this.m_ui.visible=b_visible,this.b_visible=b_visible)},chat_ui.prototype.blowUpChatBox=function(){this.UIins.chatPanel.vScrollBar.max=this.UIins.chatPanel.contentHeight,this.UIins.chatPanel.vScrollBar.value=this.UIins.chatPanel.vScrollBar.max,this.UIins.height=956,this.UIins.showBtn.y=-10,this.UIins.showBtn.skin="chat/arrowBtn1.png",this.UIins.chatPanel.y=84,this.UIins.chatPanel.height=714,this.UIins.ch0.y=45,this.UIins.ch1.y=234,this.UIins.ch2.y=424,this.UIins.ch3.y=615,this.UIins.bagBtn.y=this.UIins.red_bag.y=this.UIins.bottom_box.y=this.UIins.input_box.y=this.m_ui.height-this.UIins.bottom_box.height,this.bottom_pos_y=this.UIins.bottom_box.y,this.UIins.chatBg.y=this.UIins.bottom_box.y-2,this.UIins.chatBg.height=793,this.keyboard_y=970+helper.TOPBAR_HEIGHT,this.UIins.ch0.visible=!0,this.UIins.ch1.visible=!0,this.UIins.ch2.visible=!0,this.UIins.ch3.visible=!0,this.fire_event_next_frame(game_event.EVENT_CHATWND_SIZE,this.UIins.y+this.UIins.showBtn.y-this.UIins.height)},chat_ui.prototype.shrinkChatBox=function(){this.UIins.chatPanel.vScrollBar.max=this.UIins.chatPanel.contentHeight,this.UIins.chatPanel.vScrollBar.value=this.UIins.chatPanel.vScrollBar.max,this.UIins.height=585,this.UIins.showBtn.y=-10,this.UIins.showBtn.skin="chat/arrowBtn0.png",this.UIins.chatPanel.y=84,this.UIins.chatPanel.height=328,this.UIins.bagBtn.y=this.UIins.red_bag.y=this.UIins.bottom_box.y=this.UIins.input_box.y=this.m_ui.height-this.UIins.bottom_box.height,this.bottom_pos_y=this.UIins.bottom_box.y,this.UIins.chatBg.y=this.UIins.bottom_box.y-2,this.UIins.chatBg.height=412,this.keyboard_y=589+helper.TOPBAR_HEIGHT,this.UIins.ch0.y=51,3==this.curChannel&&this.isShowAllChat?(this.UIins.ch1.y=242,this.UIins.ch2.visible=!1,this.UIins.ch3.visible=!1):3!=this.curChannel||this.isShowAllChat?2==this.curChannel?(this.UIins.ch2.y=242,this.UIins.ch1.visible=!1,this.UIins.ch3.visible=!1):4==this.curChannel&&(this.UIins.ch3.y=242,this.UIins.ch1.visible=!1,this.UIins.ch2.visible=!1):(this.UIins.ch1.y=242,this.UIins.ch2.visible=!1,this.UIins.ch3.visible=!1),this.fire_event_next_frame(game_event.EVENT_CHATWND_SIZE,this.UIins.y+this.UIins.showBtn.y-this.UIins.height)},chat_ui.prototype.onKeyEvent=function(e){e.keyCode==Laya.Keyboard.ENTER?this.sendText():e.keyCode==Laya.Keyboard.UP?(0<this.record_index&&this.record_index--,this.input_record[this.record_index]&&(this.UIins.inputInfo.text=this.input_record[this.record_index])):e.keyCode==Laya.Keyboard.DOWN&&(this.record_index<this.input_record.length-1&&this.record_index++,this.input_record[this.record_index]&&(this.UIins.inputInfo.text=this.input_record[this.record_index]))},chat_ui.prototype.on_focus=function(){helper.set_focus_str(helper.main_chat)},chat_ui.prototype.on_input_limit=function(ud){void 0===ud&&(ud=null),this.UIins.inputInfo.maxChars=500,helper.show_text_tips(game.L_CHAR_LIMIT_CHANGED),this.UIins.inputInfo.focus=!1},chat_ui.prototype.on_input_msg=function(ud){helper.get_focus_str()==helper.main_chat&&(this.UIins.inputInfo.text=ud.msg,helper.clear_focus_str())},chat_ui.prototype.on_input_send=function(ud){helper.get_focus_str()==helper.main_chat&&(this.UIins.inputInfo.text=ud.msg,this.sendText(),helper.clear_focus_str())},chat_ui.prototype.on_dispose=function(){},chat_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},chat_ui}(utils.game_widget);widget.chat_ui=chat_ui}(widget||(widget={}));var ChatLine=function(_super){function ChatLine(){var _this=_super.call(this)||this;return _this.textField=new Laya.HTMLDivElement,_this.addChild(_this.textField),_this.textField.on(Laya.Event.LINK,_this,_this.on_click_link),_this}return __extends(ChatLine,_super),ChatLine.prototype.get_channel_prefix=function(channel){switch(channel){case base.CHANNEL_WORLD:return"【"+game.L_SHIJIE+"】";case base.CHANNEL_GANG:return"【"+game.L_BANGPAI+"】";case base.CHANNEL_ACROSSSVR:return"【"+game.L_KUAFU+"】";case base.CHANNEL_INFO:case base.CHANNEL_SYS:case base.CHANNEL_RECRUIT:return"【"+game.L_XITONG+"】"}return"unknown"},ChatLine.prototype.get_channel_color=function(channel){switch(channel){case base.CHANNEL_WORLD:return base.FORMAT_COLOR["#C14&"];case base.CHANNEL_GANG:return base.FORMAT_COLOR["#C18&"];case base.CHANNEL_ACROSSSVR:return base.FORMAT_COLOR["#C12&"];case base.CHANNEL_SYS:case base.CHANNEL_RECRUIT:return base.FORMAT_COLOR["#C15&"]}return base.FORMAT_COLOR["#C5&"]},ChatLine.prototype.get_name_color=function(sex){switch(sex){case 1:return base.FORMAT_COLOR["#C12&"];case 2:return base.FORMAT_COLOR["#C13&"]}return base.FORMAT_COLOR["#C12&"]},ChatLine.prototype.init=function(channel,userID,shape,vipLevel,userName,msg_str,svrId){this.channel=channel;this.pos(0,0),this.textField.width=1276,this.textField.style.color=this.get_channel_color(channel),this.textField.style.valign="middle",this.textField.style.leading=10,this.textField.style.letterSpacing=2,this.textField.style.font="44px h5font";var chInfo=this.get_channel_prefix(channel),chat_data=data.get_data(data_enum.DATA_CHAT);if(channel==base.CHANNEL_ACROSSSVR){var str=chat_data.get_svr_name(svrId);str&&(chInfo="【"+str+"】")}var ch_color=this.get_channel_color(channel),channelHTML=helper.createSpanTag(ch_color,"44")+chInfo+"</span>",userData=userName+","+base.HYPERLINK_TYPE.TYPE_OPEN_PLAYER_INFO+","+userID+","+shape,nameHTML="";if(userName){var sex=helper.get_sex(shape),name_color=this.get_name_color(sex);nameHTML=helper.createLinkTag(name_color,"44",userData,userName)+":</span>"}var totalInfoHTML=channelHTML+nameHTML+""+helper.analysisMsgStr(msg_str,ch_color,"44");try{this.textField.innerHTML=totalInfoHTML}catch(error){return void core.game_tiplog("异常，含有特殊字符")}this.height=this.textField.contextHeight+10},ChatLine.prototype.on_click_link=function(data){for(var index=0,data_arr=new Array,_i=0,tempArr_1=data.split(",");_i<tempArr_1.length;_i++){var str=tempArr_1[_i];0==index?data_arr.push(str):data_arr.push(parseInt(str)),index+=1}},ChatLine}(Laya.Box);__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var help_tips_ui=function(_super){function help_tips_ui(){var _this=_super.call(this,"res/atlas/ui/other.atlas",ui.game.help_tipsUI)||this;return _this.UIins=null,_this.m_layer=utils.WIDGET_LAYER.TIPS,_this}return __extends(help_tips_ui,_super),help_tips_ui.prototype.on_init=function(){fontmgr.set_ui_font(this.m_ui)},help_tips_ui.prototype.on_show=function(flag){flag?(this.UIins=this.m_ui,this.UIins.btn_close.on(Laya.Event.CLICK,this,this.on_close),this.UIins.btn_close.on(Laya.Event.MOUSE_OUT,this,this.on_mouseout)):(this.UIins.btn_close.off(Laya.Event.MOUSE_OUT,this,this.on_mouseout),this.UIins.btn_close.off(Laya.Event.CLICK,this,this.on_close),this.UIins.lab_text.text="",this.UIins=null)},help_tips_ui.prototype.on_show_ud=function(flag,ud){if(void 0===ud&&(ud=null),flag)if(this.UIins.lab_text.text=ud[0],ud[3]){var w=this.UIins.img_bk.width,h=this.UIins.img_bk.height,x=(Laya.stage.width-w)/2,y=(Laya.stage.height-h)/2;this.move_bk(x,y)}else this.move_bk(ud[1],ud[2])},help_tips_ui.prototype.move_bk=function(x,y){this.UIins.x=x,this.UIins.y=y},help_tips_ui.prototype.on_mouseout=function(ud){void 0===ud&&(ud=null),this.show(!1)},help_tips_ui.prototype.on_close=function(){this.show(!1)},help_tips_ui.prototype.on_dispose=function(){},help_tips_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},help_tips_ui}(utils.game_widget);widget.help_tips_ui=help_tips_ui}(widget||(widget={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var maintop_ui=function(_super){function maintop_ui(){var _this=_super.call(this,"res/atlas/mainui.atlas",ui.game.main_topui_newUI)||this;return _this.UIins=null,_this.append_extrares("res/atlas/ui.atlas",Laya.Loader.ATLAS),_this.append_extrares("res/atlas/ui/sys.atlas",Laya.Loader.ATLAS),_this.append_extrares("res/atlas/ui/new.atlas",Laya.Loader.ATLAS),_this.m_layer=utils.WIDGET_LAYER.NORMAL,_this}return __extends(maintop_ui,_super),maintop_ui.prototype.on_init=function(){fontmgr.set_ui_font(this.m_ui)},maintop_ui.prototype.on_show=function(flag){flag?(this.UIins=this.m_ui,this.register_event(game_event.EVENT_UI_MAINTOPUPDATE,this.on_update_data),this.register_event(game_event.EVENT_MAINPLAYER_MOVE,this.on_mainplayer_move)):(this.unregister_allevent(),this.UIins=null)},maintop_ui.prototype.on_mainplayer_move=function(ud){void 0===ud&&(ud=null);var x=ud[0],y=ud[1],mp=data.get_data(data_enum.DATA_PLAYER);this.UIins.name_label.text=mp.m_name+" ("+x.toString()+","+y.toString()+")"},maintop_ui.prototype.on_update_data=function(ud){void 0===ud&&(ud=null);var gold=ud[0],stamnia=ud[1];this.UIins.num_gold.text=gold.toString(),this.UIins.num_slv.text=stamnia.toString()},maintop_ui.prototype.on_dispose=function(){},maintop_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},maintop_ui}(utils.game_widget);widget.maintop_ui=maintop_ui}(widget||(widget={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var main_ui=function(_super){function main_ui(){var _this=_super.call(this,"res/atlas/mainui.atlas",ui.game.main_ui_newUI)||this;return _this.UIins=null,_this.append_extrares("res/atlas/ui.atlas",Laya.Loader.ATLAS),_this.append_extrares("res/atlas/ui/sys.atlas",Laya.Loader.ATLAS),_this.append_extrares("res/atlas/ui/new.atlas",Laya.Loader.ATLAS),_this.m_layer=utils.WIDGET_LAYER.NORMAL,_this}return __extends(main_ui,_super),main_ui.prototype.on_init=function(){},main_ui.prototype.on_show=function(flag){flag?(this.UIins=this.m_ui,this.UIins.btn1.on(Laya.Event.CLICK,this,this.on_battle),this.UIins.btn2.on(Laya.Event.CLICK,this,this.on_maincity),this.UIins.btn3.on(Laya.Event.CLICK,this,this.on_mainequip),this.UIins.btn4.on(Laya.Event.CLICK,this,this.on_add),this.UIins.btn5.on(Laya.Event.CLICK,this,this.on_partner),this.UIins.x=Laya.stage.designWidth-this.UIins.width,this.UIins.y=Laya.stage.designHeight-this.UIins.height,this.register_event(game_event.EVENT_UI_MAINUPDATE,this.on_update_data)):(this.UIins.btn1.off(Laya.Event.CLICK,this,this.on_battle),this.UIins.btn2.off(Laya.Event.CLICK,this,this.on_maincity),this.UIins.btn3.off(Laya.Event.CLICK,this,this.on_mainequip),this.UIins.btn4.off(Laya.Event.CLICK,this,this.on_add),this.UIins.btn5.off(Laya.Event.CLICK,this,this.on_partner),this.unregister_allevent(),this.UIins=null)},main_ui.prototype.on_update_data=function(ud){void 0===ud&&(ud=null);var rate=ud[0]/ud[1];this.UIins.exp_progress.value=rate,this.UIins.exp_label.changeText((100*rate).toFixed(2)+"%")},main_ui.prototype.on_battle=function(ud){void 0===ud&&(ud=null),this.fire_event_next_frame(game_event.EVENT_CARD_REQ_START)},main_ui.prototype.on_maincity=function(ud){void 0===ud&&(ud=null),console.log("hahahaha"),helper.show_text_tips("hahahahah,this is a test")},main_ui.prototype.on_mainequip=function(ud){void 0===ud&&(ud=null),helper.show_msgbox("OK,let's go")},main_ui.prototype.on_add=function(ud){void 0===ud&&(ud=null),this.fire_event_next_frame(game_event.EVENT_TEST3)},main_ui.prototype.on_partner=function(ud){void 0===ud&&(ud=null),this.fire_event_next_frame(game_event.EVENT_TEST2)},main_ui.prototype.on_dispose=function(){},main_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},main_ui}(utils.game_widget);widget.main_ui=main_ui}(widget||(widget={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var msgbox_ui=function(_super){function msgbox_ui(){var _this=_super.call(this,"res/atlas/ui.atlas",ui.game.msgboxUI)||this;return _this.no_tips_flag=!1,_this.mb_data=null,_this.UIins=null,_this.append_extrares("res/atlas/ui/title.atlas",Laya.Loader.ATLAS),_this.m_layer=utils.WIDGET_LAYER.TIPS,_this}return __extends(msgbox_ui,_super),msgbox_ui.prototype.on_init=function(){var uiins=this.m_ui;uiins.htmlText_content.style.font="48px h5font",uiins.htmlText_content.style.color="#bd8651",fontmgr.set_button(uiins.btn_ok,fontmgr.FONTSTYLE_ENUM.FONT_REDDRAK),fontmgr.set_button(uiins.btn_cancle,fontmgr.FONTSTYLE_ENUM.FONT_REDDRAK)},msgbox_ui.prototype.on_show=function(flag){flag?(this.UIins=this.m_ui,this.UIins.btn_ok.on(Laya.Event.CLICK,this,this.on_ok),this.UIins.btn_cancle.on(Laya.Event.CLICK,this,this.on_cancel),this.UIins.btn_close.on(Laya.Event.CLICK,this,this.on_close),this.mb_data=data.get_data(data_enum.DATA_MSGBOX),this.set_msgbox(),helper.center_widget(this.m_ui),helper.add_widget_hitArea(this.m_ui)):(this.UIins.btn_ok.off(Laya.Event.CLICK,this,this.on_ok),this.UIins.btn_cancle.off(Laya.Event.CLICK,this,this.on_cancel),this.UIins.btn_close.off(Laya.Event.CLICK,this,this.on_close),helper.remove_widget_hitArea(this.m_ui),""!=this.mb_data.NoTips_keys&&null!=this.mb_data.NoTips_keys&&this.UIins.btn_NoTips.off(Laya.Event.CLICK,this,this.on_NoTips),this.mb_data=null,this.UIins=null)},msgbox_ui.prototype.set_msgbox=function(){this.mb_data&&(this.UIins.htmlText_content.innerHTML=this.mb_data.content,1==this.mb_data.type?(this.UIins.btn_ok.pos(240,345),this.UIins.btn_cancle.visible=!1):2==this.mb_data.type&&(this.UIins.btn_ok.pos(375,345),this.UIins.btn_cancle.pos(110,345),this.UIins.btn_cancle.visible=!0),""!=this.mb_data.NoTips_keys&&null!=this.mb_data.NoTips_keys?(this.UIins.btn_NoTips.visible=this.UIins.lab_NoTips.visible=!0,this.no_tips_flag=!1,this.UIins.btn_NoTips.skin="ui/selectn.png",this.UIins.btn_NoTips.on(Laya.Event.CLICK,this,this.on_NoTips)):this.UIins.btn_NoTips.visible=this.UIins.lab_NoTips.visible=!1)},msgbox_ui.prototype.on_ok=function(){null!=this.mb_data.caller&&utils.module_ins().get_module(module_enum.MODULE_SYS_MSG).fire_choosed(this.mb_data.caller,!0,this.mb_data.user_data);this.show(!1)},msgbox_ui.prototype.on_cancel=function(){null!=this.mb_data.caller&&utils.module_ins().get_module(module_enum.MODULE_SYS_MSG).fire_choosed(this.mb_data.caller,!1,this.mb_data.user_data);this.show(!1)},msgbox_ui.prototype.on_NoTips=function(){""!=this.mb_data.NoTips_keys&&null!=this.mb_data.NoTips_keys&&(this.no_tips_flag=!this.no_tips_flag,this.UIins.btn_NoTips.skin=1==this.no_tips_flag?"ui/selecty.png":"ui/selectn.png",this.mb_data.set_NoTips_flag(this.mb_data.NoTips_keys,this.no_tips_flag))},msgbox_ui.prototype.on_close=function(){this.show(!1)},msgbox_ui.prototype.on_dispose=function(){},msgbox_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},msgbox_ui}(utils.game_widget);widget.msgbox_ui=msgbox_ui}(widget||(widget={}));var widget,widget_enum;__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(widget){var tips_ui=function(_super){function tips_ui(){var _this=_super.call(this,"res/atlas/ui/sys.atlas",ui.game.tips_uiUI)||this;return _this.step=0,_this.centre_x=0,_this.centre_y=0,_this.cur_y=0,_this.show_arr=new Array,_this.pool_arr=new Array,_this.tips_data=null,_this.tips_mgr=null,_this.append_extrares("bigpic/tipsbk.png",Laya.Loader.IMAGE),_this.m_layer=utils.WIDGET_LAYER.TOP,_this}return __extends(tips_ui,_super),tips_ui.prototype.on_init=function(){this.m_ui.x=0,this.m_ui.y=0},tips_ui.prototype.on_show=function(flag){if(flag)this.tips_mgr=game.get_module(module_enum.MODULE_TIPS),this.tips_data=data.get_data(data_enum.DATA_TIPS),this.centre_x=Laya.stage.designWidth/2,this.centre_y=Laya.stage.designHeight/2,this.cur_y=this.centre_y,timer.timer_ins().add_timer(100,this,this.update);else{timer.timer_ins().remove_all_timer(this);for(var _i=0,_a=this.pool_arr;_i<_a.length;_i++){var tips=_a[_i];tips.reset(),this.m_ui.removeChild(tips)}this.tips_mgr.revert_tips_ins_arr(this.pool_arr),this.tips_mgr=null,this.tips_data=null,this.pool_arr=[],this.show_arr=[],this.centre_x=0,this.centre_y=0}},tips_ui.prototype.update=function(){this.step+=1,this.add_tips(),1<this.step&&(this.check(),this.step=0),0==this.show_arr.length&&this.show(!1)},tips_ui.prototype._get_tips_ins=function(){return 0==this.pool_arr.length&&this.pool_arr.push(this.tips_mgr.get_tips_ins()),this.pool_arr.pop()},tips_ui.prototype.add_tips=function(){if(this.show_arr.length<=10){var tips_node=this.tips_data.get_tips_node();if(tips_node){var tips_ins=this._get_tips_ins();this.m_ui.addChild(tips_ins),tips_ins.set_msg(tips_node),this.cur_y-=95,this.cur_y<200&&(this.cur_y=this.centre_y),tips_ins.x=this.centre_x-tips_ins.s_w/2,tips_ins.y=this.cur_y,tips_ins.count=0,tips_ins.show(!0),this.show_arr.push(tips_ins)}}},tips_ui.prototype.check=function(){if(0<this.show_arr.length){for(var _i=0,_a=this.show_arr;_i<_a.length;_i++){_a[_i].count+=1}var tips_ins=this.show_arr[0];4<tips_ins.count&&(tips_ins.show(!1),this.show_arr.shift(),this.pool_arr.push(tips_ins))}},tips_ui.prototype.on_dispose=function(){},tips_ui.prototype.dispose=function(){_super.prototype.dispose.call(this)},tips_ui}(utils.game_widget);widget.tips_ui=tips_ui}(widget||(widget={})),function(widget){widget.init_game_widget=function(){utils.widget_ins().register_widget(widget_enum.WIDGET_MAINUI,widget.main_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_MAINTOPUI,widget.maintop_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_CARDUI,widget.card_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_TIPS,widget.tips_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_TEXTTIPS,widget.help_tips_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_MSGBOX,widget.msgbox_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_CHAT_BOX,widget.chat_ui),utils.widget_ins().register_widget(widget_enum.WIDGET_CHAT_FACE,widget.chat_face),utils.widget_ins().register_widget(widget_enum.WIDGET_CHAT_INPUT,widget.chat_input_ui)}}(widget||(widget={})),function(widget_enum){widget_enum.WIDGET_MAINUI="main_ui",widget_enum.WIDGET_MAINTOPUI="maintop_ui",widget_enum.WIDGET_CARDUI="card_ui",widget_enum.WIDGET_TIPS="tips_ui",widget_enum.WIDGET_TEXTTIPS="texttips_ui",widget_enum.WIDGET_MSGBOX="msgbox_ui",widget_enum.WIDGET_CHAT_INPUT="chat_input",widget_enum.WIDGET_CHAT_BOX="chat_box",widget_enum.WIDGET_CHAT_FACE="chat_face",widget_enum.WIDGET_MAINPLAYER_INFO="mainplayer_info"}(widget_enum||(widget_enum={}));