!function(core){var avatardirlink=function(){function avatardirlink(){this.m_dir=0,this.m_framecount=0,this.m_ptcount=0,this.m_pt_arr=null,this.m_pt_max=4,this.m_invalid_pt=new Laya.Point(0,0),this.init()}return avatardirlink.prototype.init=function(){this.m_pt_arr=new Array;for(var i=0;i<this.m_pt_max;++i)this.m_pt_arr.push(new Array)},avatardirlink.prototype.dispose=function(){},avatardirlink.prototype.add_pt=function(idx,x,y){this.m_pt_arr[idx].push(new Laya.Point(x,y))},avatardirlink.prototype.get_pt=function(pt_idx,idx){if(this.m_pt_arr[pt_idx].length<=0)return this.m_invalid_pt;var ret=this.m_pt_arr[pt_idx][idx%this.m_pt_arr[pt_idx].length];return ret||(ret=this.m_invalid_pt),ret},avatardirlink.prototype.print_data=function(){for(var i=0;i<this.m_pt_max;++i){for(var output="ptidx "+i.toString()+" ",j=0;j<this.m_pt_arr[i].length;++j)output=output+this.m_pt_arr[i][j].x.toString()+","+this.m_pt_arr[i][j].y.toString()+" ";core.core_tiplog("avatardirlink ",output)}},avatardirlink}();core.avatardirlink=avatardirlink;var avatarlink=function(){function avatarlink(){this.m_id=0,this.m_action=0,this.m_sign=0,this.m_sign_txt="",this.m_version=0,this.m_dircount=0,this.m_dir_max=8,this.m_dir_arr=null,this.init()}return avatarlink.prototype.print_data=function(){core.core_tiplog("avatarlink ",this.m_id,this.m_version,this.m_dircount);for(var i=0;i<this.m_dir_max;++i){var dir_d=this.m_dir_arr[i];core.core_tiplog("dir data:",dir_d.m_dir,dir_d.m_framecount,dir_d.m_ptcount),dir_d.print_data()}},avatarlink.prototype.dispose=function(){if(null!=this.m_dir_arr){for(var i=0;i<this.m_dir_arr.length;++i)utils.recover("avatardirlink",this.m_dir_arr[i]);this.m_dir_arr=null}},avatarlink.prototype.get_pt=function(dir,pt_idx,idx){return this.m_dir_arr[dir].get_pt(pt_idx,idx)},avatarlink.prototype.init=function(){this.dispose(),this.m_dir_arr=new Array;for(var i=0;i<this.m_dir_max;++i){var new_dir=utils.getitembycls("avatardirlink",avatardirlink);new_dir.init(),this.m_dir_arr.push(new_dir)}},avatarlink.prototype.set_txt_buff=function(buf,buf_len){var f_buf=buf.getUTFBytes(buf_len),line_arr=f_buf.split("\r\n");if(line_arr.length<3)core.core_errlog("avatar_link set_txt_buff error line_arr.length < 3 ",f_buf);else{var tmp_arr=null,line_no=0;this.m_sign_txt=line_arr[line_no];var line_str=line_arr[line_no+=1];tmp_arr=line_str.split(":"),this.m_version=parseInt(tmp_arr[1]),tmp_arr=(line_str=line_arr[line_no+=1]).split(":"),this.m_dircount=parseInt(tmp_arr[1]),line_no+=1;for(var i=0;i<this.m_dircount;++i){tmp_arr=(line_str=line_arr[line_no]).split(":");var dir=parseInt(tmp_arr[1]);tmp_arr=(line_str=line_arr[line_no+=1]).split(":");var framecount=parseInt(tmp_arr[1]);tmp_arr=(line_str=line_arr[line_no+=1]).split(":");var ptcount=parseInt(tmp_arr[1]);line_no+=1,this.m_dir_arr[dir].m_dir=dir,this.m_dir_arr[dir].m_framecount=framecount,this.m_dir_arr[dir].m_ptcount=ptcount,this.m_dir_arr[dir].init();for(var j=0;j<ptcount;++j){tmp_arr=(line_str=line_arr[line_no]).split(":");var ptidx=parseInt(tmp_arr[1]);line_no+=1;for(var k=0;k<framecount;++k){tmp_arr=(line_str=line_arr[line_no]).split(","),line_no+=1;var x=parseInt(tmp_arr[0]),y=parseInt(tmp_arr[1]);this.m_dir_arr[dir].add_pt(ptidx,x,y)}}}}},avatarlink.prototype.set_buff=function(buf,buf_len){this.m_sign=buf.getUint32(),this.m_version=buf.getUint8(),this.m_dircount=buf.getUint8();for(var i=0;i<this.m_dircount;++i){var dir=buf.getUint8(),framecount=buf.getUint8(),ptcount=buf.getUint8();this.m_dir_arr[dir].m_dir=dir,this.m_dir_arr[dir].m_framecount=framecount,this.m_dir_arr[dir].m_ptcount=ptcount,this.m_dir_arr[dir].init();for(var j=0;j<ptcount;++j)for(var ptidx=buf.getUint8(),k=0;k<framecount;++k){var x=buf.getUint16(),y=buf.getUint16();this.m_dir_arr[dir].add_pt(ptidx,x,y)}}},avatarlink}();core.avatarlink=avatarlink}(core||(core={}));var blowfish,__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var avatarname=function(_super){function avatarname(){var _this=_super.call(this)||this;return _this.m_bk=new Laya.Sprite,_this.m_text=new Laya.Text,_this.m_bk_w=80,_this.m_bk_h=40,_this.addChild(_this.m_text),_this.m_text.font="h5font",_this.m_text.overflow=Laya.Text.HIDDEN,_this.m_text.color="#65ff65",_this.m_text.stroke=2,_this.m_text.strokeColor="#19591c",_this.m_text.align="center",_this.m_text.fontSize=22,_this.m_text.size(200,40),_this.m_text.y=0,_this.m_text.x=-100,_this.y=25,_this}return __extends(avatarname,_super),avatarname.prototype.re_init=function(){this.y=25,this.x=0},avatarname.prototype.dispose=function(){},avatarname}(Laya.Sprite);core.avatarname=avatarname;var avatarhp=function(_super){function avatarhp(){var _this=_super.call(this)||this;return _this.m_progress=null,_this.m_w=62,_this.m_h=18,_this.m_progress=new Laya.ProgressBar("avatar/blood.png"),_this.m_progress.width=_this.m_w,_this.m_progress.height=_this.m_h,_this.addChild(_this.m_progress),_this}return __extends(avatarhp,_super),avatarhp.prototype.re_init=function(){this.m_progress.value=1},avatarhp.prototype.set_v=function(v,m){this.m_progress.value=v/m},avatarhp.prototype.clear=function(){},avatarhp.prototype.dispose=function(){this.removeChildren(),null!=this.m_progress&&(this.m_progress=null)},avatarhp}(Laya.Sprite);core.avatarhp=avatarhp;var avatarbuff=function(_super){function avatarbuff(){var _this=_super.call(this)||this;return _this.m_id=0,_this.m_shape=0,_this.m_cd=0,_this.m_overlap=0,_this.m_datas=null,_this.m_icon=null,_this.m_cd_label=null,_this.m_w=0,_this.m_h=0,_this.m_cd_label_h=12,_this.m_effid=0,_this.m_icon=new Laya.Sprite,_this.m_cd_label=new Laya.Label,_this.m_cd_label.color="#fff200",_this.m_cd_label.stroke=1,_this.m_cd_label.strokeColor="#000000",_this.addChild(_this.m_icon),_this.addChild(_this.m_cd_label),_this}return __extends(avatarbuff,_super),avatarbuff.prototype.re_init=function(){this.m_cd_label.y=this.m_h-this.m_cd_label_h,this.m_effid=0},avatarbuff.prototype.set_id=function(id,shape){this.m_id!=id&&this.m_icon.graphics.clear(),this.m_id=id,this.m_shape=shape,this.m_icon.graphics.loadImage("icon/buff/"+this.m_shape.toString()+".jpg",0,0,this.m_w,this.m_h)},avatarbuff.prototype.set_data=function(cd,overlap,datas){this.set_cd(cd),this.m_overlap=overlap,this.m_datas=datas},avatarbuff.prototype.set_cd=function(cd){this.m_cd=cd,this.m_cd_label.text=this.m_cd.toString()},avatarbuff.prototype.set_effid=function(id){this.m_effid=id},avatarbuff.prototype.dispose=function(){this.m_icon.graphics.clear()},avatarbuff}(Laya.Sprite);core.avatarbuff=avatarbuff;var avatarbuffui=function(_super){function avatarbuffui(){var _this=_super.call(this)||this;return _this.m_list=null,_this.m_num_per_row=3,_this.m_buffw=32,_this.m_buffh=32,_this.m_list=new Array,_this}return __extends(avatarbuffui,_super),avatarbuffui.prototype._re_arrange=function(){for(var dx=0,dy=0,idx=0,_i=0,_a=this.m_list;_i<_a.length;_i++){var i=_a[_i];i.x=dx,i.y=dy,idx+=1,dx+=this.m_buffw,2<idx&&(dx=0,dy+=this.m_buffh,idx=0)}dy+=this.m_buffh,this.x=0-this.m_buffw*this.m_num_per_row/2,this.y=-100},avatarbuffui.prototype.addbuff=function(bid,shape,cd,overlap,datas,effid){void 0===effid&&(effid=0);var addbuff=this.getbuff(bid);null==addbuff&&((addbuff=utils.getitembycls("avatarbuff",avatarbuff)).m_w=this.m_buffw,addbuff.m_h=this.m_buffh,addbuff.re_init(),this.addChild(addbuff),addbuff.set_id(bid,shape),addbuff.set_effid(effid),this.m_list.push(addbuff),this._re_arrange()),addbuff.set_data(cd,overlap,datas)},avatarbuffui.prototype.getbuff=function(bid){for(var _i=0,_a=this.m_list;_i<_a.length;_i++){var i=_a[_i];if(i.m_id==bid)return i}return null},avatarbuffui.prototype.delbuff=function(bid){for(var i=0;i<this.m_list.length;++i){var b=this.m_list[i];if(b.m_id==bid)return b.removeSelf(),b.dispose(),utils.recover("avatarbuff",b),this.m_list.splice(i,1),this._re_arrange(),!0}return!1},avatarbuffui.prototype.buffautocd=function(){for(var _i=0,_a=this.m_list;_i<_a.length;_i++){var i=_a[_i];i.set_cd(i.m_cd-1)}},avatarbuffui.prototype.delallbuff=function(){this.removeChildren();for(var _i=0,_a=this.m_list;_i<_a.length;_i++){var i=_a[_i];i.dispose(),utils.recover("avatarbuff",i)}this.m_list.length=0},avatarbuffui.prototype.re_init=function(){},avatarbuffui.prototype.clear=function(){this.delallbuff()},avatarbuffui.prototype.dispose=function(){this.clear()},avatarbuffui}(Laya.Sprite);core.avatarbuffui=avatarbuffui}(core||(core={})),function(blowfish){var bf_P=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],bf_S=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]],CBlowFish=function(){function CBlowFish(){this.m_index=0,this.m_PArray=new Array(18),this.m_SBoxes=new Array;for(var i=0;i<18;++i)this.m_PArray[i]=bf_P[i];for(i=0;i<4;++i){this.m_SBoxes.push(new Array(256));for(var j=0;j<256;++j)this.m_SBoxes[i][j]=bf_S[i][j]}this._print_array("constructor")}return CBlowFish.prototype._print_array=function(msg,b_force){if(void 0===msg&&(msg=""),void 0===b_force&&(b_force=!1),0!=b_force){for(var output="_print_array "+msg+" ",i=0;i<18;++i){output=output+" "+(c=this.m_PArray[i]).toString(16)}core.net_errlog(output),core.net_errlog("sbox start "),output="";for(i=0;i<4;++i){this.m_SBoxes[i];for(var cidx=0,j=0;j<256;++j){var c;(c=this.m_SBoxes[i][j])<0&&(c=c+4294967295+1),output=output+" "+c.toString(16),15<=cidx?(core.net_errlog(output),output="",cidx=0):cidx+=1}}core.net_errlog("sbox end ")}},CBlowFish.prototype._bf_F=function(v){var byte0=v>>24&255,byte1=v>>16&255,byte2=v>>8&255,byte3=255&v;this.m_SBoxes[0][byte0],this.m_SBoxes[1][byte1],this.m_SBoxes[2][byte2],this.m_SBoxes[3][byte3];return(this.m_SBoxes[0][byte0]+this.m_SBoxes[1][byte1]^this.m_SBoxes[2][byte2])+this.m_SBoxes[3][byte3]},CBlowFish.prototype.ROUND=function(a,b,idx){return a^=this._bf_F(b)^this.m_PArray[idx]},CBlowFish.prototype.Blowfish_encipher=function(xl,xr){var TXL=xl,TXR=xr;return TXL^=this.m_PArray[0],TXR=this.ROUND(TXR,TXL,1),TXL=this.ROUND(TXL,TXR,2),TXR=this.ROUND(TXR,TXL,3),TXL=this.ROUND(TXL,TXR,4),TXR=this.ROUND(TXR,TXL,5),TXL=this.ROUND(TXL,TXR,6),TXR=this.ROUND(TXR,TXL,7),TXL=this.ROUND(TXL,TXR,8),TXR=this.ROUND(TXR,TXL,9),TXL=this.ROUND(TXL,TXR,10),TXR=this.ROUND(TXR,TXL,11),TXL=this.ROUND(TXL,TXR,12),TXR=this.ROUND(TXR,TXL,13),TXL=this.ROUND(TXL,TXR,14),TXR=this.ROUND(TXR,TXL,15),TXL=this.ROUND(TXL,TXR,16),TXR^=this.m_PArray[17],this.m_PArray[this.m_index]^=TXL,this.m_index++,18<=this.m_index&&(this.m_index=0),[TXR,TXL]},CBlowFish.prototype.Blowfish_decipher=function(xl,xr){var TXL=xl,TXR=xr,TXR_BACKUP=xr;return TXL^=this.m_PArray[17],TXR=this.ROUND(TXR,TXL,16),TXL=this.ROUND(TXL,TXR,15),TXR=this.ROUND(TXR,TXL,14),TXL=this.ROUND(TXL,TXR,13),TXR=this.ROUND(TXR,TXL,12),TXL=this.ROUND(TXL,TXR,11),TXR=this.ROUND(TXR,TXL,10),TXL=this.ROUND(TXL,TXR,9),TXR=this.ROUND(TXR,TXL,8),TXL=this.ROUND(TXL,TXR,7),TXR=this.ROUND(TXR,TXL,6),TXL=this.ROUND(TXL,TXR,5),TXR=this.ROUND(TXR,TXL,4),TXL=this.ROUND(TXL,TXR,3),TXR=this.ROUND(TXR,TXL,2),TXL=this.ROUND(TXL,TXR,1),TXR^=this.m_PArray[0],this.m_PArray[this.m_index]^=TXR_BACKUP,this.m_index++,18<=this.m_index&&(this.m_index=0),[TXR,TXL]},CBlowFish.prototype.testfunc=function(){var TXR=0;var byte0=255&(TXR=this.ROUND(TXR,713700311,1)),byte1=TXR>>8&255,byte2=TXR>>16&255,byte3=TXR>>24&255;core.net_errlog("byte01234 ",byte0,byte1,byte2,byte3)},CBlowFish.prototype.InitializeKey=function(buff){var blen=buff.length;if(!(blen<=0)){for(var j=0,i=0;i<18;++i){buff.pos=j;var byte0=buff.getUint8();buff.pos=(j+1)%blen;var byte1=buff.getUint8();buff.pos=(j+2)%blen;var byte2=buff.getUint8();buff.pos=(j+3)%blen;var temp=buff.getUint8()|byte2<<8|byte1<<16|byte0<<24;this.m_PArray[i]^=temp,j=(j+4)%blen}this._print_array("InitializeKey1 ");var datal=0,datar=0;for(i=0;i<18;i+=2){datal=(bret=this.Blowfish_encipher(datal,datar))[0],datar=bret[1],this.m_PArray[i]=datal,this.m_PArray[i+1]=datar}for(i=0;i<4;++i)for(var j_1=0;j_1<256;j_1+=2){var bret;datal=(bret=this.Blowfish_encipher(datal,datar))[0],datar=bret[1],this.m_SBoxes[i][j_1]=datal,this.m_SBoxes[i][j_1+1]=datar}this._print_array("InitializeKey2 ")}},CBlowFish.prototype.Initialize=function(seed){this.m_index^=seed,this.m_index<0&&(this.m_index+=4294967296),this.m_index%=18;for(var i=0;i<9;i++){if(seed&1<<i){var temp=this.m_PArray[2*i];this.m_PArray[2*i]=this.m_PArray[2*i+1],this.m_PArray[2*i+1]=temp}}for(i=9;i<18;i++){if(seed&1<<i){temp=this.m_PArray[i-9];this.m_PArray[i-9]=this.m_PArray[17-(i-9)],this.m_PArray[17-(i-9)]=temp}}this._print_array("Initialize seed1 "+this.m_index);for(i=18;i<32;i++){if(seed&1<<i){var t=i-18,offset=seed+this.m_index&255,offset2=(seed>>8)+t&255;temp=this.m_SBoxes[3&t][offset];this.m_SBoxes[3&t][offset]=this.m_SBoxes[3&this.m_index][offset2],this.m_SBoxes[3&this.m_index][offset2]=temp}}this._print_array("Initialize seed2")},CBlowFish.prototype.Encode=function(buff){if(0!=(7&buff.length))return!1;if(buff.length<8)return!1;for(var oldpos=buff.pos,i=0;i<buff.length;i+=8){var opos=buff.pos;buff.pos=i;var xl=buff.getUint32(),xr=buff.getUint32(),bret=this.Blowfish_encipher(xl,xr);buff.pos=opos,buff.writeUint32(bret[0]),buff.writeUint32(bret[1])}return buff.pos=oldpos,!0},CBlowFish.prototype.Decode=function(buff){if(0!=(7&buff.length))return!1;if(buff.length<8)return!1;for(var oldpos=buff.pos,i=0;i<buff.length;i+=8){var opos=buff.pos;buff.pos=i;var xl=buff.getUint32(),xr=buff.getUint32(),bret=this.Blowfish_decipher(xl,xr);buff.pos=opos,buff.writeUint32(bret[0]),buff.writeUint32(bret[1])}return buff.pos=oldpos,!0},CBlowFish}();blowfish.CBlowFish=CBlowFish}(blowfish||(blowfish={})),function(core){var avatar_ani_struct=function(){function avatar_ani_struct(){this.m_anchorX=0,this.m_anchorY=0,this.m_dx=0,this.m_dy=0,this.m_frameRate=24,this.m_frames=new Array}return avatar_ani_struct.prototype.set_data=function(o){var ani_data=o.animations[0];this.m_frameRate=ani_data.frameRate;var keyframes=ani_data.nodes[0].keyframes;keyframes.anchorX&&(this.m_anchorX=keyframes.anchorX[0].value),keyframes.anchorY&&(this.m_anchorY=keyframes.anchorY[0].value),keyframes.x&&(this.m_dx=keyframes.x[0].value),keyframes.y&&(this.m_dy=keyframes.y[0].value);for(var _i=this.m_frames.length=0,_a=keyframes.skin;_i<_a.length;_i++){var i=_a[_i];this.m_frames.push(i.value)}},avatar_ani_struct.parse=function(o){if(null!=o){var n=new avatar_ani_struct;return n.set_data(o),n}return null},avatar_ani_struct}();core.avatar_ani_struct=avatar_ani_struct;var avatar_atlas_img_struct=function(){this.m_name="",this.m_w=0,this.m_h=0,this.m_source_w=0,this.m_source_h=0};core.avatar_atlas_img_struct=avatar_atlas_img_struct;var avatar_atlas_struct=function(){function avatar_atlas_struct(){this.m_prefix="",this.m_frames=new Array}return avatar_atlas_struct.prototype.set_data=function(o){this.m_prefix=o.meta.prefix;for(var _i=this.m_frames.length=0,_a=Object.keys(o.frames);_i<_a.length;_i++){var key=_a[_i];if(o.frames.hasOwnProperty(key)){var f=o.frames[key],n_img=new avatar_atlas_img_struct;n_img.m_name=key,n_img.m_w=f.frame.w,n_img.m_h=f.frame.h,n_img.m_source_w=f.sourceSize.w,n_img.m_source_h=f.sourceSize.h,this.m_frames.push(n_img)}}},avatar_atlas_struct.parse=function(o){if(null!=o){var n=new avatar_atlas_struct;return n.set_data(o),n}return null},avatar_atlas_struct}();core.avatar_atlas_struct=avatar_atlas_struct;var material=function(){function material(){this.m_ref=0,this.m_mat_res="",this.m_mat_id=0,material.s_mat_id+=1,this.m_mat_id=material.s_mat_id}return material.prototype.dispose=function(){},material.prototype.update=function(delta){},material.prototype.load_res=function(){},material.prototype.addref=function(){this.m_ref++},material.prototype.delref=function(){this.m_ref--},material.s_mat_id=0,material}();core.material=material;var material_loader=function(){function material_loader(res,restype){this.m_mat_res="",this.m_mat_res_type="",this.m_loaded=!1,this.m_loading=!1,this.m_ref=0,this.m_unload_mat=new Object,this.m_ref_tm=0,this.m_res_release=!1,this.m_extra_res=new Array,this.re_init(res,restype)}return material_loader.prototype.re_init=function(res,restype){this.m_mat_res=res,this.m_mat_res_type=restype,this.m_loaded=!1,this.m_loading=!1,this.m_ref=0,this.m_unload_mat=new Object,this.m_ref_tm=0,this.m_extra_res=new Array},material_loader.prototype.add_unload_mat=function(mat){this.m_unload_mat[mat.m_mat_id]=mat},material_loader.prototype.del_unload_mat=function(mat){delete this.m_unload_mat[mat.m_mat_id]},material_loader.prototype.on_load=function(){for(var key in this.m_loaded=!0,this.m_loading=!1,this.m_unload_mat){this.m_unload_mat[key].load_res()}core.res_tiplog("material loader on_load ",this.m_mat_res),this.m_unload_mat=new Object},material_loader.prototype.addextrares=function(res,types){this.m_extra_res.push({url:res,type:types})},material_loader.prototype.setextrares=function(res,types){this.m_extra_res=new Array,this.m_extra_res.push({url:res,type:types})},material_loader.prototype.load_res=function(line){if(!this.m_loaded&&!this.m_loading)if(this.addextrares(this.m_mat_res,this.m_mat_res_type),this.m_loading=!0,this.m_res_release)this.on_load();else{var comp=laya.utils.Handler.create(this,this.on_load,[]);core.myload(this.m_extra_res,comp,null,null,line,!0),core.res_tiplog("material loader load ",this.m_mat_res,this.m_extra_res.length)}},material_loader.prototype.addref=function(){this.m_ref++},material_loader.prototype.delref=function(){this.m_ref--,this.m_ref<=0&&this.update_ref_tm()},material_loader.prototype.update_ref_tm=function(){this.m_ref_tm=Laya.Browser.now()},material_loader.prototype.check_release=function(){if(!this.m_loaded)return!1;if(this.m_ref<=0&&Laya.Browser.now()>this.m_ref_tm+1e4)return this.m_loaded=!1,this.m_loading=!1,Laya.Loader.clearTextureRes(this.m_mat_res),core.res_tiplog("material loader check_release ",this.m_mat_res),this.m_res_release=!0;return!1},material_loader.prototype.dispose=function(){this.m_unload_mat=new Object},material_loader}();core.material_loader=material_loader}(core||(core={})),function(core){var materialinfomgr=function(){function materialinfomgr(){this.m_map_grid_w=128,this.m_map_grid_h=128,this.m_map_info_dict=new Object,this.m_ani_info_dict=new Object,this.m_eff_info_dict=new Object,this.m_avatar_action_mat_dict=new Object,this.m_avatar_config=null,this.m_map_config=null,this.m_ani_config=null,this.m_eff_config=null}return materialinfomgr.prototype.set_avatar_config=function(conf){this.m_avatar_config=conf},materialinfomgr.prototype.set_map_config=function(conf){this.m_map_config=conf},materialinfomgr.prototype.set_ani_config=function(conf){this.m_ani_config=conf},materialinfomgr.prototype.set_eff_config=function(conf){this.m_eff_config=conf},materialinfomgr.prototype._get_avatar_info=function(avatarid,actionid){var key=this.genavatarmatkey(avatarid,actionid);if(0==this.m_avatar_action_mat_dict.hasOwnProperty(key.toString())){var avainfo=this.m_avatar_config(avatarid);if(null!=avainfo)for(var _i=0,actioninfo_1=avainfo.info_data;_i<actioninfo_1.length;_i++){var i=actioninfo_1[_i];if(i.aid==actionid){this.m_avatar_action_mat_dict[key]=i;break}}}return this.m_avatar_action_mat_dict[key]},materialinfomgr.prototype._get_map_info=function(mapid){return 0==this.m_map_info_dict.hasOwnProperty(mapid.toString())&&(this.m_map_info_dict[mapid]=this.m_map_config(mapid)),this.m_map_info_dict[mapid]},materialinfomgr.prototype._get_eff_info=function(aniid){return 0==this.m_eff_info_dict.hasOwnProperty(aniid.toString())&&(this.m_eff_info_dict[aniid]=this.m_eff_config(aniid)),this.m_eff_info_dict[aniid]},materialinfomgr.prototype._get_ani_info=function(aniid){return 0==this.m_ani_info_dict.hasOwnProperty(aniid.toString())&&(this.m_ani_info_dict[aniid]=this.m_ani_config(aniid)),this.m_ani_info_dict[aniid]},materialinfomgr.prototype.dispose=function(){},materialinfomgr.prototype.getmapw=function(mapid){var info=this._get_map_info(mapid),ret=0;return null!=info&&null!=info&&(ret=info.w),ret},materialinfomgr.prototype.getmaph=function(mapid){var info=this._get_map_info(mapid),ret=0;return null!=info&&null!=info&&(ret=info.h),ret},materialinfomgr.prototype.genmappath=function(mapid){return"map/city/"+mapid.toString()+"/"},materialinfomgr.prototype.geteffw=function(aniid){var ret=16,obj=this._get_eff_info(aniid);return null!=obj&&(ret=obj.w),ret},materialinfomgr.prototype.geteffh=function(aniid){var ret=16,obj=this._get_eff_info(aniid);return null!=obj&&(ret=obj.h),ret},materialinfomgr.prototype.geteffframecount=function(aniid){var ret=30,obj=this._get_eff_info(aniid);return null!=obj&&(ret=obj.total),ret},materialinfomgr.prototype.geteffframespeed=function(aniid){var ret=30,obj=this._get_eff_info(aniid);return null!=obj&&(ret=obj.speed),ret},materialinfomgr.prototype.geteffname=function(aniid){var ret="",obj=this._get_eff_info(aniid);return null!=obj&&(ret=obj.name),ret},materialinfomgr.prototype.geteffcycle=function(aniid){var ret=!0,obj=this._get_eff_info(aniid);return null!=obj&&0==obj.cycle&&(ret=!1),ret},materialinfomgr.prototype.getaniw=function(aniid){var ret=16,obj=this._get_ani_info(aniid);return null!=obj&&(ret=obj.w),ret},materialinfomgr.prototype.getanih=function(aniid){var ret=16,obj=this._get_ani_info(aniid);return null!=obj&&(ret=obj.h),ret},materialinfomgr.prototype.getaniframecount=function(aniid){var ret=30,obj=this._get_ani_info(aniid);return null!=obj&&(ret=obj.total),ret},materialinfomgr.prototype.getaniframespeed=function(aniid){var ret=30,obj=this._get_ani_info(aniid);return null!=obj&&(ret=obj.speed),ret},materialinfomgr.prototype.getanitexprefix=function(aniid){var ret="",obj=this._get_ani_info(aniid);return null!=obj&&(ret=obj.prefix),ret},materialinfomgr.prototype.genavatarmatkey=function(shape,action){return 100*shape+action},materialinfomgr.prototype.getavataractionw=function(shape,action){var ret=16,obj=(this.genavatarmatkey(shape,action),this._get_avatar_info(shape,action));return null!=obj&&(ret=obj.w),ret},materialinfomgr.prototype.getavataractionh=function(shape,action){var ret=16,obj=(this.genavatarmatkey(shape,action),this._get_avatar_info(shape,action));return null!=obj&&(ret=obj.h),ret},materialinfomgr.prototype.getavataractionframecount=function(shape,action){var ret=30,obj=(this.genavatarmatkey(shape,action),this._get_avatar_info(shape,action));return null!=obj&&(ret=obj.total),ret},materialinfomgr.prototype.getavataractionframespeed=function(shape,action){var ret=30,obj=(this.genavatarmatkey(shape,action),this._get_avatar_info(shape,action));return null!=obj&&(ret=obj.speed),ret},materialinfomgr.prototype.getavataractiontexprefix=function(shape,action){var ret="",obj=this._get_avatar_info(shape,action);return null!=obj&&(ret=obj.prefix),ret},materialinfomgr.prototype._gen_avatarlink_key=function(shape,action){return(1e4*shape+action).toString()},materialinfomgr.prototype._gen_avatarlink_filename=function(shape,action){var ret="",obj=this._get_avatar_info(shape,action);return null!=obj&&(ret=obj.link),null==ret&&(ret=""),ret},materialinfomgr.prototype.get_backride_shape=function(ride){return 0},materialinfomgr}();core.materialinfomgr=materialinfomgr;var g_ins=null;core.matinfo_mgr=function(){return null==g_ins&&(g_ins=new materialinfomgr),g_ins}}(core||(core={})),function(core){var b_init_table=!1,g_crypt_table=new Array;function my_hash(hash_str,hash_type){!function(){if(!b_init_table){b_init_table=!0;for(var i=0;i<1280;++i)g_crypt_table.push(0);for(var seed=1048577,index2=0,index1=0;index1<256;index1++)for(index2=index1,i=0;i<5;++i){var temp1=(65535&(seed=(125*seed+3)%2796203))<<16,temp2=65535&(seed=(125*seed+3)%2796203);g_crypt_table[index2]=temp1|temp2,index2+=256}}}();var char_c,seed1=2146271213,seed2=4008636142;hash_str=hash_str.toUpperCase();for(var i=0;i<hash_str.length;++i){char_c=hash_str.charCodeAt(i),seed1=g_crypt_table[(hash_type<<8)+char_c]^seed1+seed2,seed2=char_c+(seed1&=4294967295)+seed2+(seed2<<5)+3,seed2&=4294967295}return seed1<0&&(seed1=seed1+4294967295+1),seed1}core.get_file_key=function(file_name){return my_hash(file_name,0)}}(core||(core={}));var myrandom,myencode,processencode,game_event,protocol_def,protocolbuf;__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(myrandom){var CRandBase=function(){function CRandBase(){this.m_nSeed=4090270810}return CRandBase.prototype.GetSeed=function(){return this.m_nSeed},CRandBase.prototype.SetSeed=function(seed){this.m_nSeed=seed},CRandBase.prototype.Random_01=function(){return 0},CRandBase.prototype.RandomInt=function(){return 0},CRandBase.prototype.Random=function(Max,Min){void 0===Min&&(Min=0);var ret2=Max-Min+1;return Min+(ret2*=this.Random_01())},CRandBase}(),CLcg1_Rand=function(_super){function CLcg1_Rand(){return _super.call(this)||this}return __extends(CLcg1_Rand,_super),CLcg1_Rand.prototype.Random_01=function(){var k=this.m_nSeed/127773;return this.m_nSeed=16807*(this.m_nSeed-127773*k)-2836*k,this.m_nSeed<=0&&(this.m_nSeed+=2147483647),4.656612875e-10*this.m_nSeed},CLcg1_Rand.prototype.RandomInt=function(){var k=this.m_nSeed/127773;return this.m_nSeed=16807*(this.m_nSeed-127773*k)-2836*k,this.m_nSeed<=0&&(this.m_nSeed+=2147483647),65535&this.m_nSeed},CLcg1_Rand}(myrandom.CRandBase=CRandBase);myrandom.CLcg1_Rand=CLcg1_Rand;var CLcg2_Rand=function(_super){function CLcg2_Rand(){return _super.call(this)||this}return __extends(CLcg2_Rand,_super),CLcg2_Rand.prototype.Random_01=function(){var nFirst=this.m_nSeed;nFirst=nFirst>>16&32767,this.m_nSeed=214013*this.m_nSeed+2531011;var nSecond=this.m_nSeed;return nSecond=nSecond>>16&32767,this.m_nSeed=214013*this.m_nSeed+2531011,(nFirst<<15|nSecond)/1073741824},CLcg2_Rand.prototype.RandomInt=function(){return this.m_nSeed=214013*this.m_nSeed+2531011,this.m_nSeed&=4294967295,this.m_nSeed<0&&(this.m_nSeed+=4294967296),this.m_nSeed>>15&65535},CLcg2_Rand}(CRandBase);myrandom.CLcg2_Rand=CLcg2_Rand}(myrandom||(myrandom={})),function(myencode){var MyEncode=function(){function MyEncode(){this.m_rand=new myrandom.CLcg2_Rand,this.m_remain=0,this.m_flag=0,this.m_rand.SetSeed(4090270810)}return MyEncode.prototype.Encode=function(buff){if(buff.length<1)return!1;var i=0,temp=0;if(65535<this.m_remain&&(buff.pos=i,temp=(temp=buff.getUint8())^255&this.m_remain^this.m_flag^171,buff.pos=i,buff.writeUint8(temp),this.m_flag=temp,this.m_remain=0,i++),buff.length<i+2)return!1;for(var r=0;i<buff.length-1;i+=2)r=65535&this.m_rand.RandomInt(),buff.pos=i,temp=(temp=buff.getUint8())^255&r^this.m_flag,buff.pos=i,buff.writeUint8(temp),buff.pos=i+1,temp=(temp=buff.getUint8())^r>>8&255^this.m_flag^171,buff.pos=i+1,buff.writeUint8(temp),this.m_flag=temp;return i<buff.length&&(r=65535&this.m_rand.RandomInt(),buff.pos=buff.length-1,temp=(temp=buff.getUint8())^255&r^this.m_flag,buff.pos=buff.length-1,buff.writeUint8(temp),this.m_remain=65536+(r>>8)),!0},MyEncode.prototype.Decode=function(buff){if(buff.length<1)return!1;var i=0,temp=0;if(65535<this.m_remain&&(this.m_remain=255&this.m_remain^this.m_flag^171,buff.pos=i,temp=buff.getUint8(),temp=255&((this.m_flag=temp)^this.m_remain),buff.pos=0,buff.writeUint8(temp),this.m_remain=0,i++),buff.length<i+2)return!1;for(var r=0;i<buff.length-1;i+=2)r=65535&this.m_rand.RandomInt(),buff.pos=i,temp=(temp=buff.getUint8())^255&r^this.m_flag,buff.pos=i,buff.writeUint8(temp),r=r>>8&255^this.m_flag^171,buff.pos=i+1,this.m_flag=buff.getUint8(),temp=255&(this.m_flag^255&r),buff.pos=i+1,buff.writeUint8(temp);return i<buff.length&&(r=65535&this.m_rand.RandomInt(),buff.pos=buff.length-1,temp=(temp=buff.getUint8())^255&r^this.m_flag,buff.pos=buff.length-1,buff.writeUint8(temp),this.m_remain=65536+(r>>8)),!0},MyEncode}();myencode.MyEncode=MyEncode}(myencode||(myencode={})),function(core){var log_level_enum;!function(log_level_enum){log_level_enum[log_level_enum.LOG_ERROR=0]="LOG_ERROR",log_level_enum[log_level_enum.LOG_WARNNING=1]="LOG_WARNNING",log_level_enum[log_level_enum.LOG_TIPS=2]="LOG_TIPS",log_level_enum[log_level_enum.LOG_MAX=3]="LOG_MAX"}(log_level_enum=core.log_level_enum||(core.log_level_enum={}));var log_module_enum,log_level=log_level_enum.LOG_MAX;!function(log_module_enum){log_module_enum[log_module_enum.MODULE_CORE=0]="MODULE_CORE",log_module_enum[log_module_enum.MODULE_RES=1]="MODULE_RES",log_module_enum[log_module_enum.MODULE_COMBAT=2]="MODULE_COMBAT",log_module_enum[log_module_enum.MODULE_NET=3]="MODULE_NET",log_module_enum[log_module_enum.MODULE_UI=4]="MODULE_UI",log_module_enum[log_module_enum.MODULE_GAME=5]="MODULE_GAME",log_module_enum[log_module_enum.MODULE_OTHER=6]="MODULE_OTHER",log_module_enum[log_module_enum.MODULE_LOADING=7]="MODULE_LOADING",log_module_enum[log_module_enum.MODULE_ALL=8]="MODULE_ALL"}(log_module_enum=core.log_module_enum||(core.log_module_enum={}));var log_module=log_module_enum.MODULE_ALL;function log(level,module){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];log_level<level||log_module!=log_module_enum.MODULE_ALL&&module!=log_module||function(module){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];console.log("module:"+module+" "+args)}(module,args)}function loading_tiplog(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_LOADING,args)}function myload_complete(comp,url){if(core.g_b_open_loadinglog)if(url instanceof Array){loading_tiplog("gameload complete time ",Laya.Browser.now());for(var _i=0,url_1=url;_i<url_1.length;_i++){var i=url_1[_i];loading_tiplog("gameload complete ",i.type,i.url)}}else loading_tiplog("gameload complete ",Laya.Browser.now(),url);comp.run()}core.set_log_level=function(v){log_level=v},core.set_log_module=function(v){log_module=v},core.log=log,core.res_errlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_ERROR,log_module_enum.MODULE_RES,args)},core.res_warnlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_WARNNING,log_module_enum.MODULE_RES,args)},core.res_tiplog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_RES,args)},core.core_errlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_ERROR,log_module_enum.MODULE_CORE,args)},core.core_warnlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_WARNNING,log_module_enum.MODULE_CORE,args)},core.core_tiplog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_CORE,args)},core.net_errlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_ERROR,log_module_enum.MODULE_NET,args)},core.net_warnlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_WARNNING,log_module_enum.MODULE_NET,args)},core.net_tiplog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_NET,args)},core.combat_errlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_ERROR,log_module_enum.MODULE_COMBAT,args)},core.combat_warnlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_WARNNING,log_module_enum.MODULE_COMBAT,args)},core.combat_tiplog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_COMBAT,args)},core.ui_errlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_ERROR,log_module_enum.MODULE_UI,args)},core.ui_warnlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_WARNNING,log_module_enum.MODULE_UI,args)},core.ui_tiplog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_UI,args)},core.game_errlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_ERROR,log_module_enum.MODULE_GAME,args)},core.game_warnlog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_WARNNING,log_module_enum.MODULE_GAME,args)},core.game_tiplog=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_GAME,args)},core.game_log=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];log(log_level_enum.LOG_TIPS,log_module_enum.MODULE_GAME,args)},core.loading_tiplog=loading_tiplog,core.g_b_open_loadinglog=!1,core.open_loading_log=function(flag){core.g_b_open_loadinglog=flag},core.myload=function(url,complete,progress,type,priority,cache,group,ignoreCache){if(core.g_b_open_loadinglog)if(url instanceof Array){loading_tiplog("gameload start time ",Laya.Browser.now());for(var _i=0,url_2=url;_i<url_2.length;_i++){var i=url_2[_i];loading_tiplog("gameload start ",i.type,i.url)}}else loading_tiplog("gameload start ",Laya.Browser.now(),url);var comp=Laya.Handler.create(null,myload_complete,[complete,url]);return Laya.loader.load(url,comp,progress,type,priority,cache,group,ignoreCache)}}(core||(core={})),function(processencode){var PUBLIC_KEY=[3056417706,958607066,1846441372,733894765,2884932728,3849091325,3112974538,1031800198,3695952152,2747108422,3986058167,551430739,1102935060,40613399,1809096094,759965995,923583685,2539800367,3846827613,4266654447,2132897078,3570701490,3331251513,2908467070,3314168189,168194867,1303738077,2734862194,2018056724,38839819,1934508562,3111940130,1722473874,2348973755,1687569764,290925782,3441175467,3326302810,642692458,3744823602,3187420969,1112861567,1907514446,488319787,2706074989,3785453277,2658466098,1874680856,3534138414,857260280,4098874734,1951088814,4118496565,3725783226,2824606752,3664561855,1973592766,241920811,2309113215,3016926545,4063968121,1107232400,3981583398,3415822226],SBOX_LENGTH=256,PUBLIC_SBOX=new Array(SBOX_LENGTH);var g_bRC4_Inited=!1;processencode.RC4_InitCode=function(){if(!g_bRC4_Inited){g_bRC4_Inited=!0;for(var code_size=4*PUBLIC_KEY.length,code=new Array(code_size),i=0;i<code_size/4;++i){var temp_1=PUBLIC_KEY[i]%30091<<16|PUBLIC_KEY[i]%29017,byte3=temp_1>>24&255,byte2=temp_1>>16&255,byte1=temp_1>>8&255,byte0=255&temp_1;code[4*i]=byte0,code[4*i+1]=byte1,code[4*i+2]=byte2,code[4*i+3]=byte3}var j=0,temp=0;for(i=0;i<code_size;++i)j=(j+code[i])%code_size,temp=code[i],code[i]=code[j],code[j]=temp;!function(code){for(var codelen=code.length,i=0;i<SBOX_LENGTH;++i)PUBLIC_SBOX[i]=i;var j=0,temp=0;for(i=0;i<SBOX_LENGTH;++i)j=(j+code[i%codelen]+PUBLIC_SBOX[i])%SBOX_LENGTH,temp=PUBLIC_SBOX[i],PUBLIC_SBOX[i]=PUBLIC_SBOX[j],PUBLIC_SBOX[j]=temp}(code)}};var CProcessEncode=function(){function CProcessEncode(){this.m_SBox=new Array(SBOX_LENGTH),this.m_x=0,this.m_y=0;for(var i=this.m_seed=0;i<SBOX_LENGTH;++i)this.m_SBox[i]=PUBLIC_SBOX[i]}return CProcessEncode.prototype.Create=function(seed){this.m_seed=seed,this.m_x=4095&this.m_seed^3617,this.m_y=this.m_seed>>12&4095^858},CProcessEncode.prototype.Encode=function(buff){for(var temp=0,v=0,tab=this.m_SBox,x=this.m_x,y=this.m_y,i=0;i<buff.length;++i)y=(tab[x=(x+7)%SBOX_LENGTH]+y)%SBOX_LENGTH,temp=tab[x],tab[x]=tab[y],tab[y]=temp,temp=(tab[x]+tab[y])%SBOX_LENGTH,buff.pos=i,v=buff.getUint8(),buff.pos=i,buff.writeUint8(v^tab[temp]);this.m_x=x,this.m_y=y},CProcessEncode.prototype.Encode2=function(buff){for(var temp=0,v=0,tab=this.m_SBox,x=this.m_x,y=this.m_y,i=0;i<buff.length;++i)tab[x=tab[y=(y+5+x)%SBOX_LENGTH]%SBOX_LENGTH]^=tab[y],tab[y]^=tab[x],tab[x]^=tab[y],temp=(tab[x]+tab[y]+9)%SBOX_LENGTH,buff.pos=i,v=buff.getUint8(),buff.pos=i,buff.writeUint8(v^tab[temp]);this.m_x=x,this.m_y=y},CProcessEncode}();processencode.CProcessEncode=CProcessEncode}(processencode||(processencode={})),function(game_event){game_event.EVENT_NET_PACKET="net_packet",game_event.EVENT_NET_CONNECTED="net_connected",game_event.EVENT_NET_CLOSED="net_closed",game_event.EVENT_NET_ERROR="net_error",game_event.EVENT_WIDGET_ONSHOW="ui_widget_onshow",game_event.EVENT_WIDGET_ONHIDE="ui_widget_onhide",game_event.EVENT_WIDGET_ONDISPOSE="ui_widget_ondispose",game_event.EVENT_WIDGET_ALLDISPOSE="ui_widget_alldispose",game_event.EVENT_TESTCOMBAT="test_combat",game_event.EVENT_TESTCOMBATPROTO="test_combatproto",game_event.gen_netcmd_event=function(cmd){return game_event.EVENT_NET_PACKET+"_"+cmd.toString()}}(game_event||(game_event={})),function(protocol_def){protocol_def.C2S_CMD_2_TYPE={},protocol_def.S2C_CMD_2_TYPE={},protocol_def.C2S_CMD_2_PROTO={},protocol_def.S2C_CMD_2_PROTO={},protocol_def.register_cmd=function(c2s_map,s2c_map){for(var i in c2s_map)c2s_map.hasOwnProperty(i)&&(protocol_def.C2S_CMD_2_PROTO[i]=c2s_map[i]);for(var i in s2c_map)s2c_map.hasOwnProperty(i)&&(protocol_def.S2C_CMD_2_PROTO[i]=s2c_map[i])},protocol_def.Protocol_desc_map={},protocol_def.register_protocol_desc=function(desc_map){protocol_def.Protocol_desc_map=desc_map}}(protocol_def||(protocol_def={})),function(protocolbuf_1){var protocolbuf=function(){function protocolbuf(){this.m_temp=new laya.utils.Byte}return protocolbuf.prototype.get_desc_byname=function(name){return protocol_def.Protocol_desc_map[name]},protocolbuf.prototype.pack_uint8=function(buf,v){buf.writeUint8(v)},protocolbuf.prototype.unpack_uint8=function(buf){return buf.getUint8()},protocolbuf.prototype.pack_uint16=function(buf,v){buf.writeUint16(v)},protocolbuf.prototype.unpack_uint16=function(buf){return buf.getUint16()},protocolbuf.prototype.pack_uint32=function(buf,v){buf.writeUint32(v)},protocolbuf.prototype.unpack_uint32=function(buf){return buf.getUint32()},protocolbuf.prototype.pack_int8=function(buf,v){v<0&&(v+=256),buf.writeUint8(v)},protocolbuf.prototype.unpack_int8=function(buf){var ret=buf.getUint8();return 127<ret&&(ret-=256),ret},protocolbuf.prototype.pack_int16=function(buf,v){buf.writeInt16(v)},protocolbuf.prototype.unpack_int16=function(buf){return buf.getInt16()},protocolbuf.prototype.pack_int32=function(buf,v){buf.writeInt32(v)},protocolbuf.prototype.unpack_int32=function(buf){return buf.getInt32()},protocolbuf.prototype.pack_byte=function(buf,v){if(!(null==v||null==v||v.length<=0))for(v.pos=0;0<v.bytesAvailable;)buf.writeUint8(v.getUint8())},protocolbuf.prototype.unpack_byte=function(buf,blen){for(var ret=new Laya.Byte;0<buf.bytesAvailable&&0<blen;)ret.writeUint8(buf.getUint8()),blen-=1;return ret},protocolbuf.prototype.pack_byte8=function(buf,v){if(null!=v){v.pos=0,buf.writeUint8(v.length);var len=v.length;if(255<len&&(len=255),0<v.length)for(;0<v.bytesAvailable&&0<len;)buf.writeUint8(v.getUint8()),len-=1}else buf.writeUint8(0)},protocolbuf.prototype.unpack_byte8=function(buf){for(var ret=new Laya.Byte,len=buf.getUint8();0<buf.bytesAvailable&&0<len;)ret.writeUint8(buf.getUint8()),len-=1;return ret},protocolbuf.prototype.pack_byte16=function(buf,v){if(null!=v){v.pos=0,buf.writeUint16(v.length);var len=v.length;if(65535<len&&(len=65535),0<v.length)for(;0<v.bytesAvailable&&0<len;)buf.writeUint8(v.getUint8()),len-=1}else buf.writeUint16(0)},protocolbuf.prototype.unpack_byte16=function(buf){for(var ret=new Laya.Byte,len=buf.getUint16();0<buf.bytesAvailable&&0<len;)ret.writeUint8(buf.getUint8()),len-=1;return ret},protocolbuf.prototype.pack_byte32=function(buf,v){if(null!=v){v.pos=0,buf.writeUint32(v.length);var len=v.length;if(4294967295<len&&(len=4294967295),0<v.length)for(;0<v.bytesAvailable&&0<len;)buf.writeUint8(v.getUint8()),len-=1}else buf.writeUint32(0)},protocolbuf.prototype.unpack_byte32=function(buf){for(var ret=new Laya.Byte,len=buf.getUint32();0<buf.bytesAvailable&&0<len;)ret.writeUint8(buf.getUint8()),len-=1;return ret},protocolbuf.prototype.pack_string8=function(buf,v){null!=v&&null!=v||(v="");var oldp=buf.pos;buf.writeUint8(v.length);var startp=buf.pos;buf.writeUTFBytes(v);var p=buf.pos,truelen=p-startp;buf.pos=oldp,buf.writeUint8(truelen),buf.pos=p},protocolbuf.prototype.unpack_string8=function(buf){var len=buf.getUint8();return buf.getUTFBytes(len)},protocolbuf.prototype.pack_string16=function(buf,v){null!=v&&null!=v||(v="");var oldp=buf.pos;buf.writeUint16(v.length);var startp=buf.pos;buf.writeUTFBytes(v);var p=buf.pos,truelen=p-startp;buf.pos=oldp,buf.writeUint16(truelen),buf.pos=p},protocolbuf.prototype.unpack_string16=function(buf){var len=buf.getUint16();return buf.getUTFBytes(len)},protocolbuf.prototype.pack_string32=function(buf,v){null!=v&&null!=v||(v="");var oldp=buf.pos;buf.writeUint32(v.length);var startp=buf.pos;buf.writeUTFBytes(v);var p=buf.pos,truelen=p-startp;buf.pos=oldp,buf.writeUint32(truelen),buf.pos=p},protocolbuf.prototype.unpack_string32=function(buf){var len=buf.getUint32();return buf.getUTFBytes(len)},protocolbuf.prototype.pack_int_data=function(ret,type,v){"uint8"==type?this.pack_uint8(ret,v):"uint16"==type?this.pack_uint16(ret,v):"uint32"==type?this.pack_uint32(ret,v):"int8"==type?this.pack_int8(ret,v):"int16"==type?this.pack_int16(ret,v):"int32"==type&&this.pack_int32(ret,v)},protocolbuf.prototype.unpack_int_data=function(ret,type){return"uint8"==type?this.unpack_uint8(ret):"uint16"==type?this.unpack_uint16(ret):"uint32"==type?this.unpack_uint32(ret):"int8"==type?this.unpack_int8(ret):"int16"==type?this.unpack_int16(ret):"int32"==type?this.unpack_int32(ret):0},protocolbuf.prototype.pack_string_data=function(ret,type,v){"string8"==type?this.pack_string8(ret,v):"string16"==type?this.pack_string16(ret,v):"string32"==type&&this.pack_string32(ret,v)},protocolbuf.prototype.unpack_string_data=function(ret,type){return"string8"==type?this.unpack_string8(ret):"string16"==type?this.unpack_string16(ret):"string32"==type?this.unpack_string32(ret):""},protocolbuf.prototype.pack_data=function(ret,type,value,data){if("int8"==type||"int16"==type||"int32"==type||"uint8"==type||"uint16"==type||"uint32"==type)this.pack_int_data(ret,type,data);else if("string8"==type||"string16"==type||"string32"==type)this.pack_string_data(ret,type,data);else if("byte8"==type)this.pack_byte8(ret,data);else if("byte16"==type)this.pack_byte16(ret,data);else if("byte32"==type)this.pack_byte32(ret,data);else if("byte"==type)this.pack_byte(ret,data);else if("list8"==type||"list16"==type||"list32"==type){var listdata=data,len=listdata.length;"list8"==type?this.pack_uint8(ret,len):"list16"==type?this.pack_uint16(ret,len):"list32"==type&&this.pack_uint32(ret,len);for(var subtype=value,_i=0,listdata_1=listdata;_i<listdata_1.length;_i++){var i=listdata_1[_i];if("int8"==subtype||"int16"==subtype||"int32"==subtype||"uint8"==subtype||"uint16"==subtype||"uint32"==subtype)this.pack_int_data(ret,subtype,i);else if("string8"==subtype||"string16"==subtype||"string32"==subtype)this.pack_string_data(ret,subtype,i);else if("byte8"==subtype)this.pack_byte8(ret,i);else if("byte16"==subtype)this.pack_byte16(ret,i);else if("byte32"==subtype)this.pack_byte32(ret,i);else if("byte"==subtype)this.pack_byte(ret,i);else for(var _a=0,desc_1=this.get_desc_byname(subtype);_a<desc_1.length;_a++){var p=(j=desc_1[_a])[0],stype=j[1],svalue=j[2];this.pack_data(ret,stype,svalue,i[p])}}}else for(var _b=0,desc_2=this.get_desc_byname(type);_b<desc_2.length;_b++){var j;p=(j=desc_2[_b])[0],stype=j[1],svalue=j[2];this.pack_data(ret,stype,svalue,data[p])}},protocolbuf.prototype.unpack_data=function(type,value,buf,max_len){var nv,sv,bv;if(void 0===max_len&&(max_len=-1),max_len<0&&(max_len=buf.length),"int8"==type||"int16"==type||"int32"==type||"uint8"==type||"uint16"==type||"uint32"==type)return nv=this.unpack_int_data(buf,type);if("string8"==type||"string16"==type||"string32"==type)return sv=this.unpack_string_data(buf,type);if("byte8"==type)return bv=this.unpack_byte8(buf);if("byte16"==type)return bv=this.unpack_byte8(buf);if("byte32"==type)return bv=this.unpack_byte8(buf);if("byte"==type)return bv=this.unpack_byte(buf,max_len);if("list8"==type||"list16"==type||"list32"==type){var len=0;"list8"==type?len=this.unpack_uint8(buf):"list16"==type?len=this.unpack_uint16(buf):"list32"==type&&(len=this.unpack_uint32(buf));for(var subtype=value,listdata=[],i=0;i<len;++i)if("int8"==subtype||"int16"==subtype||"int32"==subtype||"uint8"==subtype||"uint16"==subtype||"uint32"==subtype)nv=this.unpack_int_data(buf,subtype),listdata.push(nv);else if("string8"==subtype||"string16"==subtype||"string32"==subtype)sv=this.unpack_string_data(buf,subtype),listdata.push(sv);else if("byte8"==subtype)bv=this.unpack_byte8(buf),listdata.push(bv);else if("byte16"==subtype)bv=this.unpack_byte8(buf),listdata.push(bv);else if("byte32"==subtype)bv=this.unpack_byte8(buf),listdata.push(bv);else if("byte"==subtype)bv=this.unpack_byte(buf,max_len),listdata.push(bv);else{for(var ret={},_i=0,desc_3=this.get_desc_byname(subtype);_i<desc_3.length;_i++){var p=(j=desc_3[_i])[0],stype=j[1],svalue=j[2];ret[p]=this.unpack_data(stype,svalue,buf,max_len)}listdata.push(ret)}return listdata}ret={};for(var _a=0,desc_4=this.get_desc_byname(type);_a<desc_4.length;_a++){var j;p=(j=desc_4[_a])[0],stype=j[1],svalue=j[2];ret[p]=this.unpack_data(stype,svalue,buf,max_len)}return ret},protocolbuf.prototype.c2s_rawbuff2buf=function(cmd,buff){var ret=new Laya.Byte;ret.endian=Laya.Byte.BIG_ENDIAN,ret.writeByte(19),ret.writeByte(82),ret.writeByte(8),ret.writeByte(28),ret.writeByte(1),ret.writeInt32(1);var lenpos=ret.pos;for(ret.writeInt32(0),ret.writeInt32(cmd),buff.pos=0;buff.pos<buff.length;)ret.writeUint8(buff.getUint8());var tl=ret.pos-lenpos-4;return ret.pos=lenpos,ret.writeInt32(tl),ret.pos=0,ret},protocolbuf.prototype.c2s_data2buf=function(cmd,data){var ret=new Laya.Byte;ret.endian=Laya.Byte.BIG_ENDIAN,ret.writeByte(19),ret.writeByte(82),ret.writeByte(8),ret.writeByte(28),ret.writeByte(1),ret.writeInt32(1);var lenpos=ret.pos;if(ret.writeInt32(0),ret.writeInt32(cmd),null!=protocol_def.C2S_CMD_2_PROTO[cmd])for(var desc_name=protocol_def.C2S_CMD_2_PROTO[cmd],_i=0,desc_5=this.get_desc_byname(desc_name);_i<desc_5.length;_i++){var i=desc_5[_i],p=i[0],type=i[1],value=i[2];this.pack_data(ret,type,value,data[p])}var tl=ret.pos-lenpos-4;return ret.pos=lenpos,ret.writeInt32(tl),ret.pos=0,ret},protocolbuf.prototype.s2c_buf2data=function(buf){core.net_errlog("s2c_buf2data ",buf);var cmd,ret={};buf.getByte(),buf.getByte(),buf.getByte(),buf.getByte(),buf.getByte(),buf.getInt32();var buflen=buf.getInt32();if(cmd=buf.getInt32(),core.net_errlog("s2c_buf2data1 ",buf.length,buf.pos,buflen,cmd),null!=protocol_def.S2C_CMD_2_PROTO[cmd])for(var desc_name=protocol_def.S2C_CMD_2_PROTO[cmd],_i=0,desc_6=this.get_desc_byname(desc_name);_i<desc_6.length;_i++){var i=desc_6[_i],p=i[0],type=i[1],value=i[2];ret[p]=this.unpack_data(type,value,buf,buflen)}var data_r={};return data_r.cmd=cmd,data_r.data=ret,data_r},protocolbuf.prototype.c2s_rawbuff2buf_tl=function(cmd,sbuff,sendbuff){var plen=sbuff.length;for(plen+=2,sendbuff.clear(),sendbuff.endian=Laya.Byte.LITTLE_ENDIAN,plen<255?sendbuff.writeUint8(plen):(sendbuff.pos=0,sendbuff.writeUint8(255),sendbuff.writeUint32(plen),sendbuff.pos=4),sendbuff.writeInt16(cmd),sbuff.pos=0;sbuff.pos<sbuff.length;)sendbuff.writeUint8(sbuff.getUint8());return sendbuff.pos=0,sendbuff},protocolbuf.prototype.c2s_data2buf_tl=function(cmd,data,sendbuff){this.m_temp.clear();var ret=this.m_temp;if(ret.endian=Laya.Byte.LITTLE_ENDIAN,ret.writeInt16(cmd),null!=protocol_def.C2S_CMD_2_PROTO[cmd])for(var desc_name=protocol_def.C2S_CMD_2_PROTO[cmd],_i=0,desc_7=this.get_desc_byname(desc_name);_i<desc_7.length;_i++){var i=desc_7[_i],p=i[0],type=i[1],value=i[2];this.pack_data(ret,type,value,data[p])}var plen=ret.length;sendbuff.clear();var newret=sendbuff;for(newret.endian=Laya.Byte.LITTLE_ENDIAN,plen<255?newret.writeUint8(plen):(newret.pos=0,newret.writeUint8(255),newret.writeUint32(plen),newret.pos=4),ret.pos=0;ret.pos<ret.length;)newret.writeUint8(ret.getUint8());return newret.pos=0,newret},protocolbuf.prototype.s2c_buf2data_tl=function(buf){var tmp,cmd=0,ret={},buffoldpos=buf.pos;tmp=buf.getUint8();var recvlen=buf.length-buf.pos,plen=0;if(255==tmp?(buf.pos=buffoldpos,plen=buf.getUint32(),plen>>=8,recvlen-=3):plen=tmp,recvlen<plen)return core.net_errlog("s2c_buf2data_tl is not enough ",plen,recvlen,buf.length),buf.pos=buffoldpos,null;if(cmd=buf.getInt16(),plen-=2,core.net_tiplog("s2c_buf2data_tl ",cmd.toString(16),buf.length,buf.pos,plen),null!=protocol_def.S2C_CMD_2_PROTO[cmd])for(var desc_name=protocol_def.S2C_CMD_2_PROTO[cmd],_i=0,desc_8=this.get_desc_byname(desc_name);_i<desc_8.length;_i++){var i=desc_8[_i],p=i[0],type=i[1],value=i[2];ret[p]=this.unpack_data(type,value,buf,plen)}else buf.getUTFBytes(plen),core.net_errlog("cmd is not defined! ",cmd.toString(16));var data_r={};return data_r.cmd=cmd,data_r.data=ret,data_r},protocolbuf}();protocolbuf_1.protocolbuf=protocolbuf}(protocolbuf||(protocolbuf={})),function(core){var rendercommand=function(){function rendercommand(obj){this.re_init(obj)}return rendercommand.prototype.re_init=function(obj){this.m_obj=obj,null!=this.m_obj&&this.update_z()},rendercommand.prototype.update_z=function(){this.m_screen_z=this.m_obj.y},rendercommand.prototype.dispose=function(){this.m_obj=null},rendercommand.prototype.render=function(context){context.m_view.m_unitView.addChild(this.m_obj)},rendercommand.prototype.is_contain=function(x,y){return!1},rendercommand}();core.rendercommand=rendercommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var renderobject=function(_super){function renderobject(){var _this=_super.call(this)||this;return _this.m_box=new laya.maths.Rectangle,_this.m_rc=null,_this.set_id(),_this}return __extends(renderobject,_super),renderobject.prototype.set_id=function(){this.m_obj_id=this.get_obj_id()},renderobject.prototype.set_pos=function(x,y){this.x=x,this.y=y,this.m_box.setTo(this.x-this.m_box.width/2,this.y-this.m_box.height/2,this.m_box.width,this.m_box.height),this.m_rc.update_z()},Object.defineProperty(renderobject.prototype,"set_x",{get:function(){return this.x},set:function(value){this.x=value,this.m_box.setTo(this.x-this.m_box.width/2,this.y-this.m_box.height/2,this.m_box.width,this.m_box.height)},enumerable:!0,configurable:!0}),Object.defineProperty(renderobject.prototype,"set_y",{get:function(){return this.y},set:function(value){this.y=value,this.m_box.setTo(this.x-this.m_box.width/2,this.y-this.m_box.height/2,this.m_box.width,this.m_box.height),this.m_rc.update_z()},enumerable:!0,configurable:!0}),renderobject.prototype.set_scale=function(sx,sy){},renderobject.prototype.get_obj_id=function(){return renderobject.S_RO_IDMAX++},renderobject.prototype.dispose=function(){this.removeSelf()},renderobject.prototype.update=function(delta){},renderobject.prototype.is_contain=function(x,y){return this.m_box.contains(x,y)},renderobject.prototype.project=function(context){return!!context.m_camera.is_project(this.m_box)&&(context.m_render.addrc(this.m_rc),!0)},renderobject.S_RO_IDMAX=1,renderobject}(laya.display.Sprite);core.renderobject=renderobject}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var anicommand=function(_super){function anicommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(anicommand,_super),anicommand.prototype.update_z=function(){1==this.m_obj.m_data?this.m_screen_z=-5e8+this.m_obj.y:this.m_screen_z=-1e8+this.m_obj.y},anicommand.prototype.dispose=function(){this.m_obj=null},anicommand.prototype.render=function(context){1==this.m_obj.m_data?context.m_view.m_ani_underunit_View.addChild(this.m_obj):context.m_view.m_ani_uponunit_view.addChild(this.m_obj)},anicommand}(core.rendercommand);core.anicommand=anicommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var avatarcommand=function(_super){function avatarcommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(avatarcommand,_super),avatarcommand.prototype.update_z=function(){this.m_screen_z=-4e8+this.m_obj.y},avatarcommand.prototype.dispose=function(){this.m_obj=null},avatarcommand.prototype.render=function(context){context.m_view.m_unitView.addChild(this.m_obj)},avatarcommand.prototype.is_contain=function(x,y){return this.m_obj.is_contain(x,y)},avatarcommand}(core.rendercommand);core.avatarcommand=avatarcommand;var avatarcommand_new=function(_super){function avatarcommand_new(obj){void 0===obj&&(obj=null);var _this=_super.call(this,obj)||this;return _this.m_a=obj,_this}return __extends(avatarcommand_new,_super),avatarcommand_new.prototype.re_init=function(obj){_super.prototype.re_init.call(this,obj),this.m_a=obj},avatarcommand_new.prototype.update_z=function(){this.m_screen_z=-4e8+this.m_obj.y},avatarcommand_new.prototype.dispose=function(){this.m_obj=null},avatarcommand_new.prototype.render=function(context){if(context.m_view.m_unitView.addChild(this.m_obj),0<this.m_obj.alpha){var x=this.m_obj.x+this.m_a.m_dx,y=this.m_obj.y+this.m_a.m_dy;null!=this.m_a.m_aura_adorn&&this.m_a.m_aura_adorn.draw2sp(context.m_view.m_unitground_View,x,y,!1),null!=this.m_a.m_title_adorn&&this.m_a.m_title_adorn.draw2sp(context.m_view.m_unitfront_View,x,y),null!=this.m_a.m_shadow_sp&&context.m_view.m_unitshadow_View.graphics.drawTexture(this.m_a.m_shadow_sp,x-50,y-35),0<this.m_a.m_name.length&&context.m_view.m_unitname_View.graphics.fillBorderText(this.m_a.m_name,x+this.m_a.m_name_dx,y+25+this.m_a.m_name_dy,"22px h5font","#65ff65","#19591c",2,"center")}},avatarcommand_new.prototype.is_contain=function(x,y){return null!=this.m_obj&&this.m_obj.is_contain(x,y)},avatarcommand_new}(core.rendercommand);core.avatarcommand_new=avatarcommand_new}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var effcommand=function(_super){function effcommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(effcommand,_super),effcommand.prototype.update_z=function(){1==this.m_obj.m_data?this.m_screen_z=-5e8+this.m_obj.y:this.m_screen_z=-1e8+this.m_obj.y},effcommand.prototype.dispose=function(){this.m_obj=null},effcommand.prototype.render=function(context){1==this.m_obj.m_data?context.m_view.m_ani_underunit_View.addChild(this.m_obj):context.m_view.m_ani_uponunit_view.addChild(this.m_obj)},effcommand}(core.rendercommand);core.effcommand=effcommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapbkcommand=function(_super){function mapbkcommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(mapbkcommand,_super),mapbkcommand.prototype.update_z=function(){this.m_screen_z=-1e9},mapbkcommand.prototype.dispose=function(){this.m_obj=null},mapbkcommand.prototype.render=function(context){context.m_view.m_mapView.addChild(this.m_obj)},mapbkcommand}(core.rendercommand);core.mapbkcommand=mapbkcommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapblockcommand=function(_super){function mapblockcommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(mapblockcommand,_super),mapblockcommand.prototype.update_z=function(){this.m_screen_z=-1e9},mapblockcommand.prototype.dispose=function(){this.m_obj=null},mapblockcommand.prototype.render=function(context){context.m_view.m_ani_underunit_View.addChild(this.m_obj)},mapblockcommand}(core.rendercommand);core.mapblockcommand=mapblockcommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapscrollbkcommand=function(_super){function mapscrollbkcommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(mapscrollbkcommand,_super),mapscrollbkcommand.prototype.update_z=function(){this.m_screen_z=1-1e9},mapscrollbkcommand.prototype.dispose=function(){this.m_obj=null},mapscrollbkcommand.prototype.render=function(context){context.m_view.m_mapView.addChild(this.m_obj)},mapscrollbkcommand}(core.rendercommand);core.mapscrollbkcommand=mapscrollbkcommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapslotcommand=function(_super){function mapslotcommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(mapslotcommand,_super),mapslotcommand.prototype.update_z=function(){this.m_screen_z=-1e9+this.m_obj.y},mapslotcommand.prototype.dispose=function(){this.m_obj=null},mapslotcommand.prototype.render=function(context){var view=context.m_view.m_mapView,mapslot=this.m_obj;null!=mapslot.m_mat&&null!=mapslot.m_mat.m_tex&&view.graphics.drawTexture(mapslot.m_mat.m_tex,mapslot.x,mapslot.y)},mapslotcommand}(core.rendercommand);core.mapslotcommand=mapslotcommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var spritecommand=function(_super){function spritecommand(obj){return void 0===obj&&(obj=null),_super.call(this,obj)||this}return __extends(spritecommand,_super),spritecommand.prototype.update_z=function(){this.m_screen_z=-1e8+this.m_obj.y},spritecommand.prototype.dispose=function(){this.m_obj=null},spritecommand.prototype.render=function(context){this.m_obj.m_b_upon_unit?context.m_view.m_ani_uponunit_view.addChild(this.m_obj):context.m_view.m_ani_underunit_View.addChild(this.m_obj)},spritecommand}(core.rendercommand);core.spritecommand=spritecommand}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var animaterial=function(_super){function animaterial(){var _this=_super.call(this)||this;return _this.m_res_path=null,_this.m_ani_id=0,_this.m_ready=!1,_this.m_graphic=new laya.display.Animation,_this}return __extends(animaterial,_super),animaterial.prototype.re_init=function(){this.m_mat_res=""},animaterial.prototype.ani_index_pad=function(index,pad_num){for(var ret=index.toString(),count=ret.length;count<pad_num;)ret="0"+ret,count++;return ret},animaterial.prototype.aniUrls=function(aniName,pre,pad_num,length){for(var urls=[],i=0;i<length;i++)urls.push(aniName+pre+this.ani_index_pad(i,pad_num)+".png");return urls},animaterial.prototype.load_res=function(){this.loadres(core.matinfo_mgr().getanitexprefix(this.m_ani_id),"0",4,core.matinfo_mgr().getaniframecount(this.m_ani_id))},animaterial.prototype.loadres=function(anipre,pre,pad_num,length){this.m_graphic.loadImages(this.aniUrls(anipre,pre,pad_num,length)),this.m_ready=!0,this.m_graphic.play(),this.m_graphic.gotoAndStop(0)},animaterial.prototype.goto_frame=function(frame){this.m_ready&&this.m_graphic.gotoAndStop(frame)},animaterial.prototype.clear=function(){this.m_graphic.clear(),this.m_ready=!1},animaterial.prototype.dispose=function(){this.m_graphic.clear(),this.m_graphic=null},animaterial.prototype.update=function(delta){},animaterial}(core.material);core.animaterial=animaterial}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var avataractiondirmaterial=function(_super){function avataractiondirmaterial(){var _this=_super.call(this)||this;return _this.m_ready=!1,_this.m_dir=0,_this.m_graphic=new laya.display.Animation,_this}return __extends(avataractiondirmaterial,_super),avataractiondirmaterial.prototype.re_init=function(){this.m_graphic.clear(),this.m_ready=!1},avataractiondirmaterial.prototype.get_rect=function(){var ret=null;return this.m_ready&&(ret=this.m_graphic.getGraphicBounds(!0)),ret},avataractiondirmaterial.prototype.ani_index_pad=function(index,pad_num){for(var ret=index.toString(),count=ret.length;count<pad_num;)ret="0"+ret,count++;return ret},avataractiondirmaterial.prototype.aniUrls=function(aniName,pre,pad_num,length){for(var urls=[],i=0;i<length;i++)urls.push(aniName+pre+this.ani_index_pad(i,pad_num)+".png");return urls},avataractiondirmaterial.prototype.loadres=function(anipre,pre,pad_num,length){this.m_graphic.loadImages(this.aniUrls(anipre,pre,pad_num,length)),this.m_ready=!0,this.m_graphic.play(),this.m_graphic.gotoAndStop(0)},avataractiondirmaterial.prototype.goto_frame=function(frame){this.m_ready&&this.m_graphic.gotoAndStop(frame)},avataractiondirmaterial.prototype.clear=function(){this.m_graphic.clear(),this.m_ready=!1},avataractiondirmaterial.prototype.dispose=function(){this.m_graphic.clear(),this.m_graphic=null},avataractiondirmaterial.prototype.update=function(delta){},avataractiondirmaterial}(core.material);core.avataractiondirmaterial=avataractiondirmaterial}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var avataractionmaterial=function(_super){function avataractionmaterial(){var _this=_super.call(this)||this;return _this.m_shape=0,_this.m_action=0,_this.m_curdir=0,_this.m_curdirmat=null,_this.m_dir_list={},_this.m_width=0,_this.m_height=0,_this.m_b_mirrior=!0,_this.m_b_dir4=!1,_this.m_alink=null,_this.m_cur_link=new Laya.Point(0,0),_this.m_b_loaded=!1,_this.m_cur_mirrior=!1,_this.m_link_sp=null,_this.m_graphic=new laya.display.Sprite,_this.m_link_sp=new Laya.Sprite,_this}return __extends(avataractionmaterial,_super),avataractionmaterial.prototype.re_init=function(){this.m_mat_res="",this.m_shape=0,this.m_action=0,this.m_curdir=0,this.m_curdirmat=null,this.m_width=0,this.m_height=0,this.m_b_mirrior=!0,this.m_b_dir4=!1,this.m_alink=null,this.m_cur_link=new Laya.Point(0,0),this.m_b_loaded=!1,this.m_cur_mirrior=!1},avataractionmaterial.prototype.get_link=function(dir,pt_idx,frame){var dirmat=this.m_dir_list[dir];return null!=dirmat&&dirmat.m_dir!=dir&&(dir=dirmat.m_dir),null!=this.m_alink?this.m_alink.get_pt(dir,pt_idx,frame):this.m_cur_link},avataractionmaterial.prototype.goto_frame=function(frame){null!=this.m_curdirmat&&this.m_curdirmat.goto_frame(frame)},avataractionmaterial.prototype.is_dir_loaded=function(dir){return null!=this.m_dir_list[dir]&&null!=this.m_dir_list[dir]&&this.m_dir_list[dir].m_ready},avataractionmaterial.prototype.load_res=function(){for(var mat_info=core.matinfo_mgr()._get_avatar_info(this.m_shape,this.m_action),dirlist=(mat_info.prefix,mat_info.dir.split(",")),prefix=core.matinfo_mgr().getavataractiontexprefix(this.m_shape,this.m_action),framecount=core.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),dir_idx=0,_i=0,dirlist_1=dirlist;_i<dirlist_1.length;_i++){var i=dirlist_1[_i];this.adddirmat(prefix,dir_idx,i,4,framecount),dir_idx+=1}this.m_b_loaded=!0},avataractionmaterial.prototype.adddirmat=function(anipre,dir,use_dir,pad_num,length){if(null!=this.m_graphic){var dirmat=null;(dirmat=utils.getitembycls("avataractiondirmaterial",core.avataractiondirmaterial)).re_init(),dirmat.loadres(anipre,use_dir.toString(),pad_num,length),dirmat.m_dir=use_dir,dirmat.m_ready=!0,this.m_dir_list[dir]=dirmat,dir==this.m_curdir&&this.changedir(this.m_curdir),this.m_b_loaded=!0}else core.core_tiplog("avataractionmaterial adddirmat already release ",anipre,dir,pad_num,length)},avataractionmaterial.prototype.changedir=function(dir){this.m_curdir=dir,this.m_graphic.removeChildren(),this.m_curdirmat=null;this.m_curdir;var scalex=1;this.m_cur_mirrior=!1;var dirmat=this.m_dir_list[this.m_curdir];null!=dirmat&&(dirmat.m_dir!=this.m_curdir&&this.m_b_mirrior&&(3==this.m_curdir?5==dirmat.m_dir&&(scalex=-1,this.m_cur_mirrior=!0):5==this.m_curdir?3==dirmat.m_dir&&(scalex=-1,this.m_cur_mirrior=!0):1==this.m_curdir?7==dirmat.m_dir&&(scalex=-1,this.m_cur_mirrior=!0):7==this.m_curdir?1==dirmat.m_dir&&(scalex=-1,this.m_cur_mirrior=!0):2==this.m_curdir?4<dirmat.m_dir&&(scalex=-1,this.m_cur_mirrior=!0):6==this.m_curdir&&dirmat.m_dir<4&&(scalex=-1,this.m_cur_mirrior=!0)),this.m_curdirmat=dirmat,this.m_graphic.pivotX=this.m_width>>1,this.m_graphic.scaleX=scalex,this.m_graphic.addChild(this.m_curdirmat.m_graphic))},avataractionmaterial.prototype.get_rect=function(){return null!=this.m_curdirmat?this.m_curdirmat.get_rect():null},avataractionmaterial.prototype.clear=function(){for(var key in this.m_b_loaded=!1,this.m_graphic.removeChildren(),this.m_curdirmat=null,this.m_dir_list){var mat=this.m_dir_list[key];null!=mat&&(mat.clear(),utils.recover("avataractiondirmaterial",mat))}this.m_dir_list={}},avataractionmaterial.prototype.dispose=function(){for(var key in this.clear(),this.m_graphic=null,this.m_link_sp=null,this.m_dir_list){var mat=this.m_dir_list[key];null!=mat&&mat.dispose()}this.m_dir_list={}},avataractionmaterial.prototype.update=function(delta){},avataractionmaterial}(core.material);core.avataractionmaterial=avataractionmaterial}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var effmaterial=function(_super){function effmaterial(){var _this=_super.call(this)||this;return _this.m_ani_path=null,_this.m_res_path=null,_this.m_ani_id=0,_this.m_ready=!1,_this.m_graphic=new laya.display.Animation,_this}return __extends(effmaterial,_super),effmaterial.prototype.re_init=function(){this.m_mat_res=""},effmaterial.prototype.load_res=function(){this.loadres(core.matinfo_mgr().geteffname(this.m_ani_id),core.matinfo_mgr().geteffcycle(this.m_ani_id))},effmaterial.prototype.loadres=function(name,cycle){null!=this.m_graphic&&(this.m_graphic.loadAnimation(this.m_ani_path),this.m_ready=!0,this.m_graphic.play(0,cycle,name),this.m_graphic.gotoAndStop(0))},effmaterial.prototype.goto_frame=function(frame){this.m_ready&&this.m_graphic.gotoAndStop(frame)},effmaterial.prototype.clear=function(){this.m_graphic&&this.m_graphic.clear(),this.m_ready=!1},effmaterial.prototype.dispose=function(){this.m_graphic&&(this.m_graphic.clear(),this.m_graphic=null),this.m_ready=!1},effmaterial.prototype.update=function(delta){},effmaterial}(core.material);core.effmaterial=effmaterial}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var avatar_ani_frame=function(){function avatar_ani_frame(){this.m_tex=null,this.m_path="",this.m_dx=0,this.m_dy=0}return avatar_ani_frame.prototype.re_init=function(){this.clear()},avatar_ani_frame.prototype.load_res=function(){this.m_tex=Laya.Loader.getRes(this.m_path)},avatar_ani_frame.prototype.clear=function(){this.m_tex=null,this.m_dx=0,this.m_dy=0},avatar_ani_frame.prototype.dispose=function(){this.clear()},avatar_ani_frame}();core.avatar_ani_frame=avatar_ani_frame;var avatar_ani_mat=function(_super){function avatar_ani_mat(){var _this=_super.call(this)||this;return _this.m_atlas_path="",_this.m_ani_path="",_this.m_atlas_data=null,_this.m_ani_data=null,_this.m_frames=new Array,_this.m_b_loaded=!1,_this.m_framemillsec=0,_this.m_frametotalmillsec=0,_this}return __extends(avatar_ani_mat,_super),avatar_ani_mat.prototype.re_init=function(){this.clear(),this.m_atlas_data=null,this.m_ani_data=null,this.m_aniid=0,this.m_framecount=1,this.m_framespeed=2,this.m_framemillsec=0,this.m_frametotalmillsec=0},avatar_ani_mat.prototype.get_frame=function(idx){return this.m_frames.length<=0||idx<0||idx>=this.m_frames.length?null:this.m_frames[idx]},avatar_ani_mat.prototype.load_res=function(){this.m_ani_data=core.mat_mgr().get_avatar_anidata(this.m_ani_path),this.m_atlas_data=core.mat_mgr().get_avatar_anitalasdata(this.m_atlas_path);var totalframe=this.m_ani_data.m_frames.length;this.m_framecount!=totalframe&&(this.m_framecount=totalframe,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed);for(var ax=this.m_ani_data.m_anchorX,ay=this.m_ani_data.m_anchorY,dx=this.m_ani_data.m_dx,dy=this.m_ani_data.m_dy,i=0;i<totalframe;++i){var f=utils.getitembycls("avatar_ani_frame",avatar_ani_frame);f.re_init(),f.m_path=this.m_ani_data.m_frames[i];var aw=512;i<this.m_atlas_data.m_frames.length&&(aw=this.m_atlas_data.m_frames[i].m_source_w);var ah=512;i<this.m_atlas_data.m_frames.length&&(ah=this.m_atlas_data.m_frames[i].m_source_h),f.m_dx=dx-aw*ax,f.m_dy=dy-ah*ay,f.load_res(),this.m_frames.push(f)}this.m_b_loaded=!0},avatar_ani_mat.prototype.clear=function(){this.m_b_loaded=!1;for(var _i=0,_a=this.m_frames;_i<_a.length;_i++){var i=_a[_i];i.dispose(),utils.recover("avatar_ani_frame",i)}this.m_frames=new Array},avatar_ani_mat.prototype.dispose=function(){this.clear()},avatar_ani_mat}(core.material);core.avatar_ani_mat=avatar_ani_mat;var lavatartexture=function(){function lavatartexture(){this.m_tex=null}return lavatartexture.prototype.re_init=function(){this.m_tex=null},lavatartexture.prototype.dispose=function(){this.m_tex=null},lavatartexture}();core.lavatartexture=lavatartexture;var lavatartextureframes=function(){function lavatartextureframes(){this.m_frames=new Array,this.m_use_dir=0,this.m_dir=0,this.m_b_mirror=!1,this.m_m=new Laya.Matrix,this.m_mm=new Laya.Matrix,this.m_matrix=null,this.m_m.a=1,this.m_m.tx=0,this.m_mm.a=-1,this.m_mm.tx=0,this.m_matrix=this.m_m}return lavatartextureframes.prototype.get_texture=function(idx){return this.m_frames.length<=0||idx<0||idx>=this.m_frames.length||null==this.m_frames[idx]?null:this.m_frames[idx].m_tex},lavatartextureframes.prototype.set_mirror=function(flag){this.m_b_mirror=flag,this.m_b_mirror?this.m_matrix=this.m_mm:this.m_matrix=this.m_m},lavatartextureframes.prototype.matrix=function(){return this.m_b_mirror?this.m_mm:this.m_m},lavatartextureframes.prototype.re_init=function(){this.clear()},lavatartextureframes.prototype.clear=function(){for(var _i=0,_a=this.m_frames;_i<_a.length;_i++){var i=_a[_i];i.dispose(),utils.recover("lavatartexture",i)}this.m_frames=new Array},lavatartextureframes.prototype.dispose=function(){this.clear()},lavatartextureframes}();core.lavatartextureframes=lavatartextureframes;var lavataractionmat=function(_super){function lavataractionmat(){var _this=_super.call(this)||this;_this.m_shape=0,_this.m_action=0,_this.m_b_loaded=!1,_this.m_dir_tex=new Array,_this.m_texture_map=new Object,_this.m_alink=null,_this.m_width=0,_this.m_height=0,_this.m_cur_link=new Laya.Point(0,0);for(var i=0;i<8;++i)_this.m_dir_tex.push(new lavatartextureframes);return _this}return __extends(lavataractionmat,_super),lavataractionmat.prototype.re_init=function(){this.m_mat_res="",this.m_shape=0,this.m_action=0,this.m_alink=null,this.m_width=0,this.m_height=0,this.m_b_loaded=!1,this.clear()},lavataractionmat.prototype.get_link=function(dir,pt_idx,frame){return null!=this.m_alink?this.m_alink.get_pt(this.m_dir_tex[dir].m_use_dir,pt_idx,frame):this.m_cur_link},lavataractionmat.prototype._gen_res_path=function(pre,dir,frame){var ret="";ret=dir.toString();for(var fs=frame.toString(),num=ret.length+fs.length;num<5;)ret+="0",num++;return ret+=fs,ret=pre+(ret+=".png")},lavataractionmat.prototype._gen_tex_key=function(dir,frame){return 1e4*dir+frame},lavataractionmat.prototype.load_res=function(){for(var mat_info=core.matinfo_mgr()._get_avatar_info(this.m_shape,this.m_action),atlspre=mat_info.prefix,dirlist=mat_info.dir.split(","),framecount=core.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),b_mirrior=1==mat_info.mirror,dir_idx=0,_i=0,dirlist_1=dirlist;_i<dirlist_1.length;_i++){var i=dirlist_1[_i];this.m_dir_tex[dir_idx].m_dir=dir_idx,this.m_dir_tex[dir_idx].m_use_dir=i,this.m_dir_tex[dir_idx].set_mirror(!1),b_mirrior&&(3==dir_idx?5==i&&this.m_dir_tex[dir_idx].set_mirror(!0):5==dir_idx?3==i&&this.m_dir_tex[dir_idx].set_mirror(!0):1==dir_idx?7==i&&this.m_dir_tex[dir_idx].set_mirror(!0):7==dir_idx?1==i&&this.m_dir_tex[dir_idx].set_mirror(!0):6==dir_idx?2==i&&this.m_dir_tex[dir_idx].set_mirror(!0):2==dir_idx&&6==i&&this.m_dir_tex[dir_idx].set_mirror(!0));for(var j=0;j<framecount;++j){var res=this._gen_res_path(atlspre,i,j),tkey=this._gen_tex_key(i,j),t=this.m_texture_map[tkey];null==t&&(null!=(t=Laya.Loader.getRes(res))&&null!=t||console.log("error!tex = null",res),this.m_texture_map[tkey]=t);var af=utils.getitembycls("lavatartexture",lavatartexture);af.re_init(),af.m_tex=t,this.m_dir_tex[dir_idx].m_frames.push(af)}dir_idx+=1}this.m_b_loaded=!0},lavataractionmat.prototype.clear=function(){this.m_alink=null,this.m_b_loaded=!1;for(var _i=0,_a=this.m_dir_tex;_i<_a.length;_i++){_a[_i].clear()}for(var k in this.m_texture_map)if(this.m_texture_map.hasOwnProperty(k))this.m_texture_map[k];this.m_texture_map=new Object},lavataractionmat.prototype.dispose=function(){this.clear();for(var _i=0,_a=this.m_dir_tex;_i<_a.length;_i++){_a[_i].dispose()}this.m_dir_tex=null},lavataractionmat.prototype.update=function(delta){},lavataractionmat}(core.material);core.lavataractionmat=lavataractionmat}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapbkmaterial=function(_super){function mapbkmaterial(){var _this=_super.call(this)||this;return _this.m_graphic=new laya.display.Sprite,_this}return __extends(mapbkmaterial,_super),mapbkmaterial.prototype.re_init=function(respath){this.m_mat_res=respath},mapbkmaterial.prototype.load_res=function(){this.m_graphic.graphics.clear(),this.m_graphic.loadImage(this.m_mat_res)},mapbkmaterial.prototype.clear=function(){this.m_graphic.graphics.clear()},mapbkmaterial.prototype.dispose=function(){this.m_graphic.graphics.clear(),this.m_graphic=null},mapbkmaterial.prototype.update=function(delta){},mapbkmaterial}(core.material);core.mapbkmaterial=mapbkmaterial}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapblock=function(_super){function mapblock(){var _this=_super.call(this)||this;return _this.m_res_path=null,_this.m_map_id=0,_this.m_grid_w=32,_this.m_grid_h=32,_this.m_buf=null,_this.m_block_array=null,_this.m_block_w_num=0,_this.m_block_h_num=0,_this.m_mask_array=null,_this.m_mask_cache=null,_this.m_mask_w_num=0,_this.m_mask_h_num=0,_this.m_b_n_per_byte=8,_this.m_init_sp=!1,_this.m_block_cache=null,_this.m_graphic=new laya.display.Sprite,_this}return __extends(mapblock,_super),mapblock.prototype.re_init=function(){},mapblock.prototype.load=function(mapid){null!=this.m_buf&&(this.m_buf.clear(),this.m_buf=null),this.m_map_id=mapid,core.mat_mgr().getmapblock(this,this.m_map_id)},mapblock.prototype.setbuff=function(buf){this.m_buf=new laya.utils.Byte(buf);var offset=0,block_len=0;core.core_tiplog("mapblock setbuff len ",this.m_buf.length),core.core_tiplog("mapblock setbuff ",this.m_buf.getByte().toString(16)),core.core_tiplog("mapblock setbuff ",this.m_buf.getByte().toString(16)),offset+=2,core.core_tiplog("mapblock setbuff ",this.m_buf.getByte().toString(16)),offset+=1,core.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),core.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),core.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),core.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),offset+=16,core.core_tiplog("mapblock setbuff bw1 ",this.m_buf.getUint16()),core.core_tiplog("mapblock setbuff bh1 ",this.m_buf.getUint16()),core.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),offset+=8,this.m_block_w_num=this.m_buf.getUint32(),this.m_block_h_num=this.m_buf.getUint32(),core.core_tiplog("mapblock setbuff bw ",this.m_block_w_num),core.core_tiplog("mapblock setbuff bh ",this.m_block_h_num),block_len=this.m_buf.getUint32(),core.core_tiplog("mapblock setbuff block_len ",block_len),offset+=12,this.m_block_array=this.m_buf.getUint8Array(offset,block_len),this.m_init_sp=!1,this.m_block_cache=new Uint8Array(this.m_block_w_num*this.m_block_h_num);for(var i=0;i<this.m_block_h_num;++i)for(var j=0;j<this.m_block_w_num;++j)this.m_block_cache[i*this.m_block_w_num+j]=this.is_block(j,i)?1:0;offset+=block_len;var tmp=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmp),offset+=tmp,tmp=this.m_buf.getUint32(),offset+=4,this.m_buf.getUint8Array(offset,tmp),offset+=tmp,tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){var tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}tmp=this.m_buf.getUint32(),offset+=4;for(i=0;i<tmp;++i){tmplen=this.m_buf.getUint32();offset+=4,this.m_buf.getUint8Array(offset,tmplen),offset+=tmplen}if(offset+=2,0<(tmp=this.m_buf.getUint16())&&(this.m_buf.getUint8Array(offset,tmp),offset+=tmp),this.m_buf.length>offset){core.core_tiplog("mapblock setbuff bw1 ",this.m_buf.getUint16()),core.core_tiplog("mapblock setbuff bh1 ",this.m_buf.getUint16()),core.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),offset+=8,this.m_mask_w_num=this.m_buf.getUint32(),this.m_mask_h_num=this.m_buf.getUint32(),core.core_tiplog("mapblock mask bw ",this.m_mask_w_num),core.core_tiplog("mapblock mask bh ",this.m_mask_h_num),block_len=this.m_buf.getUint32(),core.core_tiplog("mapblock mask block_len ",block_len),offset+=12,this.m_mask_array=this.m_buf.getUint8Array(offset,block_len),this.m_mask_cache=new Uint8Array(this.m_mask_w_num*this.m_mask_h_num);for(i=0;i<this.m_mask_h_num;++i)for(j=0;j<this.m_mask_w_num;++j)this.m_mask_cache[i*this.m_mask_w_num+j]=this.is_mask(j,i)?1:0}},mapblock.prototype._is_block=function(v,pos){return 0!=(v&128>>pos)},mapblock.prototype.is_mask=function(x,y){if(null!=this.m_buf){var offset=y*this.m_mask_w_num+x,vpos=Math.floor(offset/this.m_b_n_per_byte),v=this.m_mask_array[vpos],pos=offset%this.m_b_n_per_byte;return this._is_block(v,pos)}return!0},mapblock.prototype.is_block=function(x,y){if(null!=this.m_buf){var offset=y*this.m_block_w_num+x,vpos=Math.floor(offset/this.m_b_n_per_byte),v=this.m_block_array[vpos],pos=offset%this.m_b_n_per_byte;return this._is_block(v,pos)}return!0},mapblock.prototype.is_block_cache=function(x,y){return null==this.m_buf||x<0||y<0||x>=this.m_block_w_num||y>=this.m_block_h_num||0!=this.m_block_cache[y*this.m_block_w_num+x]},mapblock.prototype.is_mask_cache=function(x,y){return null==this.m_buf||x<0||y<0||x>=this.m_mask_w_num||y>=this.m_mask_h_num||0!=this.m_mask_cache[y*this.m_mask_w_num+x]},mapblock.prototype.get_block_sp=function(){this.m_init_sp=!0,this.m_graphic.removeChildren();for(var i=0;i<this.m_block_w_num;++i)for(var j=0;j<this.m_block_h_num;++j){0,this.is_block_cache(i,j)?20==i?this.m_graphic.graphics.drawRect(32*i,32*j,32,32,"#ffff00","#000000"):this.m_graphic.graphics.drawRect(32*i,32*j,32,32,"#ff0000","#000000"):this.m_graphic.graphics.drawRect(32*i,32*j,32,32,"#00ff00","#000000")}return this.m_graphic},mapblock.prototype.dispose=function(){this.m_block_array=null,this.m_block_cache=null,this.m_mask_array=null,(this.m_mask_cache=null)!=this.m_buf&&(this.m_buf.clear(),this.m_buf=null),null!=this.m_graphic&&(this.m_graphic.removeChildren(),this.m_graphic.graphics.clear(),this.m_graphic=null)},mapblock.prototype.update=function(delta){},mapblock}(core.material);core.mapblock=mapblock}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var mapslotmaterial=function(_super){function mapslotmaterial(){var _this=_super.call(this)||this;return _this.m_graphic=null,_this.m_tex=null,_this.m_res_path=null,_this.m_map_id=0,_this.m_grid_w=0,_this.m_grid_h=0,_this.m_graphic=new laya.display.Sprite,_this}return __extends(mapslotmaterial,_super),mapslotmaterial.prototype.init=function(){this.m_tex=null},mapslotmaterial.prototype.clear=function(){this.m_graphic.graphics.clear(),this.m_tex=null},mapslotmaterial.prototype.dispose=function(){this.m_tex=null,this.m_graphic.graphics.clear(),this.m_graphic=null},mapslotmaterial.prototype.update=function(delta){},mapslotmaterial}(core.material);core.mapslotmaterial=mapslotmaterial}(core||(core={})),function(core){var materialmgr=function(){function materialmgr(){this.m_map_slot_dict=new Object,this.m_ani_mat_dict=new Object,this.m_eff_mat_dict=new Object,this.m_avatar_link_dict=new Object,this.m_lavatar_mat_dict=new Object,this.m_lavatar_animat_dict=new Object,this.m_lavatar_anidata_dict=new Object,this.m_lavatar_aniatlasdata_dict=new Object,this.m_mat_loader=new Object,this.m_avatar_shadow_mat=null}return materialmgr.prototype.dispose=function(){},materialmgr.prototype.get_avatar_shadow_mat=function(){return null==this.m_avatar_shadow_mat&&(this.m_avatar_shadow_mat=new Laya.Texture,this.m_avatar_shadow_mat.load("avatar/shadow.png")),this.m_avatar_shadow_mat},materialmgr.prototype.check_release=function(){for(var i in this.m_mat_loader)this.m_mat_loader[i].check_release()},materialmgr.prototype.get_avatar_anidata=function(res){if(this.m_lavatar_anidata_dict.hasOwnProperty(res))return this.m_lavatar_anidata_dict[res];var o=Laya.Loader.getRes(res);if(null!=o){var data_1=core.avatar_ani_struct.parse(o);return this.m_lavatar_anidata_dict[res]=data_1}return null},materialmgr.prototype.get_avatar_anitalasdata=function(res){if(this.m_lavatar_aniatlasdata_dict.hasOwnProperty(res))return this.m_lavatar_aniatlasdata_dict[res];var o=Laya.Loader.getRes(res);if(null!=o){var data_2=core.avatar_atlas_struct.parse(o);return this.m_lavatar_aniatlasdata_dict[res]=data_2}return null},materialmgr.prototype.get_mat_loader=function(res,restype){return void 0===restype&&(restype=Laya.Loader.ATLAS),0==this.m_mat_loader.hasOwnProperty(res)&&(this.m_mat_loader[res]=new core.material_loader(res,restype)),this.m_mat_loader[res]},materialmgr.prototype.add_mat_ref=function(res){this.get_mat_loader(res).addref()},materialmgr.prototype.del_mat_ref=function(res){this.get_mat_loader(res).delref()},materialmgr.prototype.preload_mat=function(res,extrares,types){void 0===extrares&&(extrares=""),void 0===types&&(types="");var mat_loader=this.get_mat_loader(res);mat_loader.m_loaded||mat_loader.m_loading||(0<extrares.length&&mat_loader.setextrares(extrares,types),mat_loader.load_res(0),mat_loader.update_ref_tm())},materialmgr.prototype.update=function(delta){},materialmgr.prototype.onLoadmapslot=function(key,path){var sp=Laya.loader.getRes(path),mat=this.m_map_slot_dict[key];null!=mat?(mat.m_graphic.graphics.drawTexture(sp,0,0),mat.m_tex=sp,mat.m_res_path=path):core.core_tiplog("materialmgr onLoadmapslot set error ",key,path)},materialmgr.prototype.getmapslot=function(mapid,x,y){var key=mapid.toString()+"_"+x.toString()+"_"+y.toString(),mat=this.m_map_slot_dict[key];if(null==mat){var slotpath=core.matinfo_mgr().genmappath(mapid)+mapid.toString()+"_tile/"+x.toString()+"_"+y.toString()+".png",comp=laya.utils.Handler.create(this,this.onLoadmapslot,[key,slotpath]);core.myload(slotpath,comp,null,Laya.Loader.IMAGE,2,!0,mapid.toString()),(mat=utils.getitembycls("mapslotmaterial",core.mapslotmaterial)).init(),mat.m_map_id=mapid,mat.m_grid_w=core.matinfo_mgr().m_map_grid_w,mat.m_grid_h=core.matinfo_mgr().m_map_grid_h,this.m_map_slot_dict[key]=mat,core.core_tiplog("materialmgr getmapslot load ",key,slotpath)}return this.m_map_slot_dict[key]},materialmgr.prototype.clearallmapslot=function(){for(var key in this.m_map_slot_dict){var mat=this.m_map_slot_dict[key];if(null!=mat&&null!=mat.m_res_path){Laya.loader.clearResByGroup(mat.m_map_id.toString()),mat.clear(),utils.recover("mapslotmaterial",mat);break}}this.m_map_slot_dict={}},materialmgr.prototype.onLoadmapblock=function(mat,path){var buf=Laya.loader.getRes(path);null!=mat&&null!=buf&&null!=buf?(mat.setbuff(buf),mat.m_res_path=path):core.core_tiplog("rendermap onLoadmapblock set error ",path)},materialmgr.prototype.getmapblock=function(mb,mapid){var slotpath=core.matinfo_mgr().genmappath(mapid)+mapid.toString()+".bin",mat=mb,comp=laya.utils.Handler.create(this,this.onLoadmapblock,[mat,slotpath]);return mat.m_map_id=mapid,core.myload(slotpath,comp,null,Laya.Loader.BUFFER,0,!0,mapid.toString()),mat},materialmgr.prototype.getmapbkres=function(respath){var mat=utils.getitembycls("mapbkmaterial",core.mapbkmaterial);mat.re_init(respath);var mat_loader=this.get_mat_loader(mat.m_mat_res,Laya.Loader.IMAGE);return mat_loader.m_loaded?mat.load_res():(mat_loader.add_unload_mat(mat),mat_loader.m_loading||mat_loader.load_res(3)),mat_loader.addref(),mat},materialmgr.prototype.delmapbkres=function(mat){var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.del_unload_mat(mat),mat_loader.delref(),mat.delref(),mat.clear(),utils.recover("mapbkmaterial",mat)},materialmgr.prototype.geteffmat=function(aniid){var mat=null,slotpath=core.matinfo_mgr()._get_eff_info(aniid).path,res=core.matinfo_mgr()._get_eff_info(aniid).res;(mat=utils.getitembycls("effmaterial",core.effmaterial)).re_init(),mat.m_ani_id=aniid,mat.m_res_path=res,mat.m_ani_path=slotpath,mat.m_mat_res=res,mat.addref();var mat_loader=this.get_mat_loader(mat.m_mat_res);return mat_loader.m_loaded?mat.load_res():(mat_loader.add_unload_mat(mat),mat_loader.m_loading||mat_loader.load_res(4)),mat_loader.addref(),core.core_tiplog("materialmgr geteffmat load ",aniid,slotpath),mat},materialmgr.prototype.deleffmat=function(mat){var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.del_unload_mat(mat),mat_loader.delref(),mat.delref(),mat.clear(),utils.recover("effmaterial",mat)},materialmgr.prototype.getanimat=function(aniid){var mat=null,slotpath="ani/"+core.matinfo_mgr()._get_ani_info(aniid).path;(mat=utils.getitembycls("animaterial",core.animaterial)).re_init(),mat.m_ani_id=aniid,mat.m_res_path=slotpath,mat.m_mat_res=slotpath,mat.addref();var mat_loader=this.get_mat_loader(mat.m_mat_res);return mat_loader.m_loaded?mat.load_res():(mat_loader.add_unload_mat(mat),mat_loader.m_loading||mat_loader.load_res(4)),mat_loader.addref(),core.core_tiplog("materialmgr getanimat load ",aniid,slotpath),mat},materialmgr.prototype.delanimat=function(mat){var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.del_unload_mat(mat),mat_loader.delref(),mat.delref(),mat.clear(),utils.recover("animaterial",mat)},materialmgr.prototype.onLoadavatar=function(mat){null!=mat&&mat.load_res()},materialmgr.prototype.getavataractionmat=function(shape,action){var mat,key=core.matinfo_mgr().genavatarmatkey(shape,action);(mat=utils.getitembycls("avataractionmaterial",core.avataractionmaterial)).re_init(),mat.m_shape=shape,mat.m_action=action,mat.m_alink=this.getavatarlinkdata(shape,action);var mat_info=core.matinfo_mgr()._get_avatar_info(shape,action);if(mat.addref(),null!=mat_info){var slotpath="avatar/"+mat_info.path;mat.m_width=mat_info.w,mat.m_height=mat_info.h,1==mat_info.mirror?mat.m_b_mirrior=!0:mat.m_b_mirrior=!1,1==mat_info.dir4?mat.m_b_dir4=!0:mat.m_b_dir4=!1,mat.m_mat_res=slotpath;var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.m_loaded?mat.load_res():(mat_loader.add_unload_mat(mat),mat_loader.m_loading||mat_loader.load_res(3)),mat_loader.addref(),core.core_tiplog("materialmgr getavatarmat load ",key,slotpath)}return mat},materialmgr.prototype.delavataractionmaterial=function(mat){if(0<mat.m_mat_res.length){var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.del_unload_mat(mat),mat_loader.delref()}mat.delref(),mat.clear(),utils.recover("avataractionmaterial",mat)},materialmgr.prototype.getlavatarmat=function(shape,action){var mat,key=core.matinfo_mgr().genavatarmatkey(shape,action);if(this.m_lavatar_mat_dict.hasOwnProperty(key.toString()))return(mat=this.m_lavatar_mat_dict[key]).addref(),mat;(mat=utils.getitembycls("lavataractionmat",core.lavataractionmat)).re_init(),mat.m_shape=shape,mat.m_action=action,mat.m_alink=this.getavatarlinkdata(shape,action);var mat_info=core.matinfo_mgr()._get_avatar_info(shape,action);if(mat.addref(),null!=mat_info){var slotpath="avatar/"+mat_info.path;mat.m_width=mat_info.w,mat.m_height=mat_info.h,mat.m_mat_res=slotpath;var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.m_loaded?mat.load_res():(mat_loader.add_unload_mat(mat),mat_loader.m_loading||mat_loader.load_res(3)),mat_loader.addref(),core.core_tiplog("materialmgr getlavatarmat load ",key,slotpath)}return mat},materialmgr.prototype.dellavatarmaterial=function(mat){if(mat.delref(),mat.m_ref<=0){var key=core.matinfo_mgr().genavatarmatkey(mat.m_shape,mat.m_action);if(0<mat.m_mat_res.length){var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.del_unload_mat(mat),mat_loader.delref()}mat.clear(),utils.recover("lavataractionmat",mat),delete this.m_lavatar_mat_dict[key]}},materialmgr.prototype.getlavataranimat=function(aniid){var mat=null;if(this.m_lavatar_animat_dict.hasOwnProperty(aniid.toString()))return(mat=this.m_lavatar_animat_dict[aniid]).addref(),mat;(mat=utils.getitembycls("avatar_ani_mat",core.avatar_ani_mat)).re_init();var slotpath=core.matinfo_mgr()._get_eff_info(aniid).path,res=core.matinfo_mgr()._get_eff_info(aniid).res;mat.m_aniid=aniid,mat.m_ani_path=slotpath,mat.m_mat_res=res,mat.m_atlas_path=res,mat.m_aw=core.matinfo_mgr().geteffw(aniid),mat.m_ah=core.matinfo_mgr().geteffh(aniid),mat.m_framecount=core.matinfo_mgr().geteffframecount(aniid),mat.m_framespeed=core.matinfo_mgr().geteffframespeed(aniid),mat.m_framemillsec=1e3/mat.m_framespeed,mat.m_frametotalmillsec=1e3*mat.m_framecount/mat.m_framespeed,mat.addref();var mat_loader=this.get_mat_loader(mat.m_mat_res);return mat_loader.m_loaded?mat.load_res():(mat_loader.add_unload_mat(mat),mat_loader.m_loading||(mat_loader.addextrares(mat.m_ani_path,Laya.Loader.JSON),mat_loader.load_res(4))),mat_loader.addref(),core.core_tiplog("materialmgr getlavataranimat load ",aniid,slotpath),mat},materialmgr.prototype.dellavataranimat=function(mat){if(mat.delref(),mat.m_ref<=0){if(0<mat.m_mat_res.length){var mat_loader=this.get_mat_loader(mat.m_mat_res);mat_loader.del_unload_mat(mat),mat_loader.delref()}mat.clear(),utils.recover("avatar_ani_mat",mat),delete this.m_lavatar_animat_dict[mat.m_aniid]}},materialmgr.prototype.setavatarlinkdata=function(shape,action,buff,bufflen,b_txt){this.clearavatarlinkdata(shape,action);var avtarlink_ins=utils.getitembycls("avatarlink",core.avatarlink);avtarlink_ins.init(),b_txt?avtarlink_ins.set_txt_buff(buff,bufflen):avtarlink_ins.set_buff(buff,bufflen);var key=core.matinfo_mgr()._gen_avatarlink_key(shape,action);this.m_avatar_link_dict[key]=avtarlink_ins},materialmgr.prototype.clearavatarlinkdata=function(shape,action){var key=core.matinfo_mgr()._gen_avatarlink_key(shape,action);if(this.m_avatar_link_dict.hasOwnProperty(key)){var ad=this.m_avatar_link_dict[key];ad.dispose(),utils.recover("avatarlink",ad),delete this.m_avatar_link_dict[key]}},materialmgr.prototype.getavatarlinkdata=function(shape,action){var key=core.matinfo_mgr()._gen_avatarlink_key(shape,action);if(this.m_avatar_link_dict.hasOwnProperty(key))return this.m_avatar_link_dict[key];var filen=core.matinfo_mgr()._gen_avatarlink_filename(shape,action);if(null==filen||filen.length<=0)return null;var bufflen,b_txt=!0,buff=null;if(null==(buff=core.filepack_ins().get_file("link_data_txt",filen))&&(buff=core.filepack_ins().get_file("link_data",filen),b_txt=!1),null==buff)return null;bufflen=b_txt?core.filepack_ins().get_file_len("link_data_txt",filen):core.filepack_ins().get_file_len("link_data",filen);var avtarlink_ins=utils.getitembycls("avatarlink",core.avatarlink);return avtarlink_ins.init(),b_txt?avtarlink_ins.set_txt_buff(buff,bufflen):avtarlink_ins.set_buff(buff,bufflen),this.m_avatar_link_dict[key]=avtarlink_ins},materialmgr}();core.materialmgr=materialmgr;var g_ins=null;core.mat_mgr=function(){return null==g_ins&&(g_ins=new materialmgr),g_ins}}(core||(core={}));var net;__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(net){var protocol_item=function(cmd,data){this.m_cmd=0,this.m_data=null,this.m_cmd=cmd,this.m_data=data};net.protocol_item=protocol_item;var game_net_mgr=function(){function game_net_mgr(){this.m_b_connect=!1,this.m_recv_list=new Array,this.m_protocol_map=new Object,this.m_s2c_protocol_map=new Object,this.m_protobuf_root=null,this.m_buf_handle=new protocolbuf.protocolbuf,this.m_buff=new laya.utils.Byte,this.m_byte=new Laya.Byte,this.m_tmp_buf=new Laya.Byte,this.m_byte.endian=Laya.Byte.BIG_ENDIAN,this.m_buff.endian=Laya.Byte.BIG_ENDIAN,this.m_socket=new Laya.Socket,this.m_socket.on(Laya.Event.OPEN,this,this.openHandler),this.m_socket.on(Laya.Event.MESSAGE,this,this.receiveHandler),this.m_socket.on(Laya.Event.CLOSE,this,this.closeHandler),this.m_socket.on(Laya.Event.ERROR,this,this.errorHandler)}return game_net_mgr.prototype.init=function(){null==this.m_protobuf_root&&core.net_errlog("game_net_mgr init")},game_net_mgr.prototype.on_protobuf_loaded=function(err,root){core.net_errlog("game_net_mgr on_protobuf_loaded ",err,root),net.net_ins().m_protobuf_root=root},game_net_mgr.prototype.get_s2c_protocol_cls=function(cmd){if(null==this.m_s2c_protocol_map[cmd]){if(null==protocol_def.S2C_CMD_2_TYPE[cmd])return core.net_errlog("game_net_mgr get_s2c_protocol_cls error!! ",cmd),null;var cls_str=protocol_def.S2C_CMD_2_TYPE[cmd.toString()],cls=this.m_protobuf_root.lookupType(cls_str);this.m_s2c_protocol_map[cmd]=cls}return this.m_s2c_protocol_map[cmd]},game_net_mgr.prototype.get_protocol_cls=function(cmd){if(null==this.m_protocol_map[cmd]){if(null==protocol_def.C2S_CMD_2_TYPE[cmd])return core.net_errlog("game_net_mgr get_protocol_cls error!! ",cmd),null;var cls_str=protocol_def.C2S_CMD_2_TYPE[cmd.toString()],cls=this.m_protobuf_root.lookupType(cls_str);this.m_protocol_map[cmd]=cls}return this.m_protocol_map[cmd]},game_net_mgr.prototype.openHandler=function(event){void 0===event&&(event=null),core.net_errlog("=======openHandler ",event),this.m_b_connect=!0,utils.event_ins().fire_event(game_event.EVENT_NET_CONNECTED,this)},game_net_mgr.prototype.receiveHandler=function(msg){void 0===msg&&(msg=null);for(var recvbuff=this.m_socket.input,i=0;i<recvbuff.length;++i)this.m_buff.writeUint8(recvbuff.getUint8());this.m_buff.pos=0,this._on_split_netpack()},game_net_mgr.prototype._on_split_netpack=function(){for(;0<this.m_buff.bytesAvailable;){var data_1=this.m_buf_handle.s2c_buf2data(this.m_buff);if(null==data_1){if(0<this.m_buff.pos){for(var tmp=new laya.utils.Byte;0<this.m_buff.bytesAvailable;)tmp.writeUint8(this.m_buff.getUint8());this.m_buff.clear(),this.m_buff=tmp}return}var cmd=data_1.cmd,recv=data_1.data;this.m_recv_list.push(new protocol_item(cmd,recv)),core.net_tiplog("recv ",cmd.toString(16),recv)}this.m_buff.clear()},game_net_mgr.prototype.closeHandler=function(e){void 0===e&&(e=null),core.net_errlog("=======closeHandler ",e),utils.event_ins().fire_event(game_event.EVENT_NET_CLOSED,[e,this]),this.close()},game_net_mgr.prototype.errorHandler=function(e){void 0===e&&(e=null),core.net_errlog("=======errorHandler ",e),utils.event_ins().fire_event(game_event.EVENT_NET_ERROR,[e,this]),this.close()},game_net_mgr.prototype.connect=function(host,port,svrid){void 0===svrid&&(svrid=11),this.m_b_connect&&this.close();var url="ws://"+host+":"+port.toString();this.m_socket.connectByUrl(url)},game_net_mgr.prototype.close=function(){this.m_b_connect&&(this.m_socket.close(),this.m_socket.cleanSocket()),this.m_b_connect=!1},game_net_mgr.prototype.send_raw_buff=function(cmd,buff){if(core.net_errlog("send send_raw_buff ",cmd.toString(16)),0!=this.m_b_connect){var buffer=this.m_buf_handle.c2s_rawbuff2buf(cmd,buff);this.m_socket.send(buffer.buffer),core.net_errlog("send send_raw_buff ",cmd.toString(16),buffer.length),this.m_socket.flush()}},game_net_mgr.prototype.send=function(cmd,data){if(void 0===data&&(data=null),core.net_tiplog("game_net_mgr send ",cmd,data,this.m_b_connect),0!=this.m_b_connect){var buffer=this.m_buf_handle.c2s_data2buf(cmd,data);core.net_tiplog("c2s buf ",buffer),core.net_tiplog("send databuflen ",buffer.length),this.m_socket.send(buffer.buffer),core.net_tiplog("send bufferlen ",buffer.length),this.m_socket.flush()}},game_net_mgr.prototype.update=function(){if(0<this.m_recv_list.length){for(var _i=0,_a=this.m_recv_list;_i<_a.length;_i++){var i=_a[_i];utils.event_ins().fire_event(game_event.gen_netcmd_event(i.m_cmd),i.m_data)}this.m_recv_list=new Array}},game_net_mgr.prototype.update2=function(){if(0<this.m_recv_list.length){for(var _i=0,_a=this.m_recv_list;_i<_a.length;_i++){var i=_a[_i];utils.event_ins().fire_event(game_event.gen_netcmd_event(i.m_cmd),[i.m_data,this])}this.m_recv_list=new Array}},game_net_mgr.prototype.dispose=function(){this.m_b_connect&&this.close()},game_net_mgr}();net.game_net_mgr=game_net_mgr;var PUBLIC_LOGIN_EKEY=[2421017128,944700278,3597879372,543195225,615609371,79095973,2885087988,2014019705,3182056064,933482824,2837597272,2270166524,4262461171,2410585700,3110862077,4135951199,2096971708,1870535724,807074513,3100559001,2750774944,3034115174,2332016203,1921350898,2393502071,3608787775,3946381035,2138888167,2279707291,525803258,3753769097,325057777,1306726518,3452919620,3244222623,722984785,2401034239,4232246011,2615356152,706510068,790418703,2104616424,3204118350,939478278,4042798641,3896753369,1739758764,2638025168,2097149256,4188968811,1944768271,2909158585,3533173142,3293651166,999980935,1066444197,1247435342,3773656417,1996108900,589768527,1304154597,3078156774,2408315896,398644441],CLoginEncode=function(){function CLoginEncode(){this.m_seed=0,this.m_bfish=new blowfish.CBlowFish,this.m_buff=new Laya.Byte;for(var i=0;i<PUBLIC_LOGIN_EKEY.length;++i)this.m_buff.writeUint32(PUBLIC_LOGIN_EKEY[i]);this.m_buff.pos=0,this.m_bfish.InitializeKey(this.m_buff),this.m_bfish.Initialize(3022389628)}return CLoginEncode.prototype.print_data=function(){this.m_bfish._print_array("print_data",!0)},CLoginEncode.prototype.MixKey=function(buff){this.m_bfish.InitializeKey(buff)},CLoginEncode.prototype.Create=function(key){this.m_bfish.Initialize(key)},CLoginEncode.prototype.Encode=function(buff){this.m_bfish.Encode(buff)},CLoginEncode.prototype.Decode=function(buff){this.m_bfish.Decode(buff)},CLoginEncode.prototype.GetSeed=function(){return this.m_seed},CLoginEncode}();net.CLoginEncode=CLoginEncode;var PUBLIC_LOGIN_DKEY=[1851554275,1986835509,4189688633,1012854005,3714495462,1619558451,3792216072,1764367207,362855653,2131378364,3858518866,3031713739,494281646,645737092,3120145297,3897244085,2064705853,1975659352,2661204187,3398779783,1640207804,834224019,3656231674,4122874472,3423678618,1228553645,2554098444,383313281,2439000095,2167838853,2551399170,2902517165,4132634850,2812983208,185456121,1961678951,3014995244,1775643882,3140414513,3598669284,2678620157,3304132233,3577231914,1743844886,2939582962,3647095842,1467598307,4088362055,3665214298,3439858470,115598572,1945394254,20494853,68691148,4271188760,2028697492,2767983744,2916594463,1844568672,2824467365,2299960696,3062497994,4290442823,858888274],CLoginDecode=function(){function CLoginDecode(){this.m_seed=0,this.m_bfish=new blowfish.CBlowFish,this.m_buff=new Laya.Byte;for(var i=0;i<PUBLIC_LOGIN_DKEY.length;++i)this.m_buff.writeUint32(PUBLIC_LOGIN_DKEY[i]);this.m_buff.pos=0,this.m_bfish.InitializeKey(this.m_buff)}return CLoginDecode.prototype.MixKey=function(buff){this.m_bfish.InitializeKey(buff)},CLoginDecode.prototype.Create=function(key){this.m_bfish.Initialize(key)},CLoginDecode.prototype.Encode=function(buff){this.m_bfish.Encode(buff)},CLoginDecode.prototype.Decode=function(buff){this.m_bfish.Decode(buff)},CLoginDecode.prototype.GetSeed=function(){return this.m_seed},CLoginDecode}();net.CLoginDecode=CLoginDecode;var TL_Login_net=function(_super){function TL_Login_net(){var _this=_super.call(this)||this;return _this.m_svrid=0,_this.m_host="",_this.m_port=0,_this.m_loginstep=0,_this.m_b_connected=!1,_this.m_loginencode=null,_this.m_logindecode=null,_this.m_sendencode=new myencode.MyEncode,_this.m_recvdecode=null,_this.m_loginIdx=0,_this.m_decodebuff=new laya.utils.Byte,_this.m_sendbuff=new laya.utils.Byte,_this.m_parent=null,_this.m_testsendcount=999,_this.m_buff.endian=Laya.Byte.BIG_ENDIAN,processencode.RC4_InitCode(),_this.m_recvdecode=new processencode.CProcessEncode,_this}return __extends(TL_Login_net,_super),TL_Login_net.prototype.connect=function(host,port,svrid){void 0===svrid&&(svrid=11),this.close(),this.m_svrid=svrid,this.m_host=host,this.m_port=port,null==this.m_socket&&(this.m_socket=new laya.net.Socket,this.m_socket.endian=Laya.Byte.BIG_ENDIAN,this.m_socket.on(Laya.Event.OPEN,this,this.openHandler),this.m_socket.on(Laya.Event.MESSAGE,this,this.receiveHandler),this.m_socket.on(Laya.Event.CLOSE,this,this.closeHandler),this.m_socket.on(Laya.Event.ERROR,this,this.errorHandler)),this.m_socket.connectByUrl("ws://"+host+":"+port.toString())},TL_Login_net.prototype._getbuffuint8=function(buff,pos){var oldpos=buff.pos;buff.pos=pos;var ret=buff.getUint8();return buff.pos=oldpos,ret},TL_Login_net.prototype._setbuffuint8=function(buff,pos,v){var oldpos=buff.pos;buff.pos=pos,buff.writeUint8(v),buff.pos=oldpos},TL_Login_net.prototype.testfunc2=function(){for(var test_data1=[202,194,246,253,63,48,46,4,224,246,143,166,113,167,242,11,185,210,239,233,213,207,43,17,175,128,139,58,99,147,86,115],firstpkg=new laya.utils.Byte,i=0;i<test_data1.length;++i)firstpkg.writeUint8(test_data1[i]);this._print_pkg(firstpkg,"recv src "),this.m_recvdecode.Create(4148050427),this.m_recvdecode.Encode(firstpkg),this._print_pkg(firstpkg,"recv decode ")},TL_Login_net.prototype.testfunc=function(){for(var firstpkg=new laya.utils.Byte,test_data=[202,194,246,253,63,48,46,4,224,246,143,166,113,167,242,11,185,210,239,233,213,207,43,17,175,128,139,58,99,147,86,115,33,178,208,174,211,59,151,157],i=0;i<40;++i)firstpkg.writeUint8(test_data[i]);this._print_pkg(firstpkg,"testbuff "),this.m_loginIdx=0;for(i=firstpkg.pos=0;i<39;++i)this.m_loginIdx+=this._getbuffuint8(firstpkg,i)^this._getbuffuint8(firstpkg,i+1);this.m_loginIdx=this.m_loginIdx%36,core.net_errlog("this.m_loginIdx ",this.m_loginIdx);var mixkey=new laya.utils.Byte;firstpkg.pos=3;for(i=0;i<32;++i)mixkey.writeUint8(firstpkg.getUint8());this._print_pkg(mixkey,"testbuff mixkey "),mixkey.pos=0,null==this.m_logindecode&&(this.m_logindecode=new CLoginDecode),this.m_logindecode.MixKey(mixkey),mixkey.pos=0,null==this.m_loginencode&&(this.m_loginencode=new CLoginEncode),this.m_loginencode.MixKey(mixkey);var svrencode=new CLoginEncode;mixkey.pos=0,svrencode.MixKey(mixkey);var test_data1=[241,115,60,37,104,16,197,226,44,133,19,255,239,107,60,228,136,172,68,104,140,93,67,158,78,18,32,116,4,5,11,124,103,158,186,110,198,60,64,195],tempbuff=new laya.utils.Byte;for(i=0;i<40;++i)tempbuff.writeUint8(test_data1[i]);tempbuff.pos=0,this.m_logindecode.Decode(tempbuff),this._print_pkg(tempbuff,"tempbuff "),tempbuff.pos=27;var m_nToken=tempbuff.getUint32();tempbuff.pos=this.m_loginIdx;var tmpkey=tempbuff.getUint32();core.net_errlog("m_nToken tmpkey ",m_nToken.toString(16),tmpkey.toString(16));var test_data2=[217,166,31,153,168,8,104,233,157,89,84,131,219,33,82,166],secondpkg=new laya.utils.Byte;for(i=0;i<test_data2.length;++i)secondpkg.writeUint8(test_data2[i]);this._print_pkg(secondpkg,"send secondpkg src "),secondpkg.pos=0,this.m_loginencode.Encode(secondpkg),this._print_pkg(secondpkg,"send secondpkg encoded "),secondpkg.pos=0,svrencode.Decode(secondpkg),this._print_pkg(secondpkg," econdpkg decode ")},TL_Login_net.prototype._print_pkg=function(buff,pre){void 0===pre&&(pre=""),core.net_errlog("======_print_pkg start ",pre,buff.length);for(var oldpos=buff.pos,output="",total=buff.pos=0;total<buff.length;){output="";for(var i=0;i<32;++i){var c=buff.getUint8();if(output=c<=15?output+" 0"+c.toString(16):output+" "+c.toString(16),(total+=1)>=buff.length)break}core.net_errlog(output)}core.net_errlog("======_print_pkg end"),buff.pos=oldpos},TL_Login_net.prototype._gen_firstpkg=function(){for(var firstpkg=new laya.utils.Byte,temp=0,i=0;i<40;++i)temp=Math.floor(255*Math.random()),firstpkg.writeUint8(temp);var svrid=65535&(27285^this.m_svrid);firstpkg.pos=35,firstpkg.writeUint16(svrid),this._setbuffuint8(firstpkg,35,this._getbuffuint8(firstpkg,35)^this._getbuffuint8(firstpkg,5)),this._setbuffuint8(firstpkg,36,this._getbuffuint8(firstpkg,36)^this._getbuffuint8(firstpkg,16)),this._setbuffuint8(firstpkg,39,114^this._getbuffuint8(firstpkg,18)),this._setbuffuint8(firstpkg,13,78^this._getbuffuint8(firstpkg,19)),this._setbuffuint8(firstpkg,17,163^this._getbuffuint8(firstpkg,12)),this._setbuffuint8(firstpkg,23,248^this._getbuffuint8(firstpkg,19)),this._setbuffuint8(firstpkg,28,149^this._getbuffuint8(firstpkg,9)),this.m_loginIdx=0;for(i=firstpkg.pos=0;i<39;++i)this.m_loginIdx+=this._getbuffuint8(firstpkg,i)^this._getbuffuint8(firstpkg,i+1);this.m_loginIdx=this.m_loginIdx%36;var mixkey=new laya.utils.Byte;firstpkg.pos=3;for(i=0;i<32;++i)mixkey.writeUint8(firstpkg.getUint8());return mixkey.pos=0,null==this.m_logindecode&&(this.m_logindecode=new CLoginDecode),this.m_logindecode.MixKey(mixkey),mixkey.pos=0,null==this.m_loginencode&&(this.m_loginencode=new CLoginEncode),this.m_loginencode.MixKey(mixkey),firstpkg},TL_Login_net.prototype.send_firstpkg=function(){var firstpkg=this._gen_firstpkg();firstpkg.pos=0,this.m_socket.send(firstpkg.buffer),this.m_socket.flush()},TL_Login_net.prototype.send_secondpkg=function(seed){var ipbuff=new laya.utils.Byte;ipbuff.writeUint8(192),ipbuff.writeUint8(168),ipbuff.writeUint8(1),ipbuff.writeUint8(110);var macbuff=new laya.utils.Byte;macbuff.writeUint8(0),macbuff.writeUint8(0),macbuff.writeUint8(0),macbuff.writeUint8(0),macbuff.writeUint8(0),macbuff.writeUint8(0);for(var ipkey=[168,65,156,55],mackey=[84,131,219,33,82,166],i=0;i<4;++i)this._setbuffuint8(ipbuff,i,ipkey[i]^this._getbuffuint8(ipbuff,i));for(i=0;i<6;++i)this._setbuffuint8(macbuff,i,mackey[i]^this._getbuffuint8(macbuff,i));var seedbuff=new laya.utils.Byte,temp=0;for(i=0;i<6;++i)temp=Math.floor(255*Math.random()),seedbuff.writeUint8(temp);var npos=seed%3;seedbuff.pos=npos,seedbuff.writeUint32(seed);var secondpkg=new laya.utils.Byte;for(i=seedbuff.pos=0;i<seedbuff.length;++i)secondpkg.writeUint8(seedbuff.getUint8());for(i=ipbuff.pos=0;i<ipbuff.length;++i)secondpkg.writeUint8(ipbuff.getUint8());for(i=macbuff.pos=0;i<macbuff.length;++i)secondpkg.writeUint8(macbuff.getUint8());secondpkg.pos=0,this.m_loginencode.Encode(secondpkg),secondpkg.pos=0,this.m_socket.send(secondpkg.buffer),this.m_socket.flush()},TL_Login_net.prototype.get_first_seed=function(msg){void 0===msg&&(msg=null);for(var recvbuff=msg,i=0;i<recvbuff.length;++i)this.m_buff.writeUint8(recvbuff.getUint8());if(this.m_buff.length<40)core.net_errlog("get_first_seed this.m_buff.length < firstpkglen ",this.m_buff.length);else{var firstpkgbuff=new laya.utils.Byte;for(i=this.m_buff.pos=0;i<40;++i)firstpkgbuff.writeUint8(this.m_buff.getUint8());for(var newbuff=new laya.utils.Byte;this.m_buff.pos<this.m_buff.length;)newbuff.writeUint8(this.m_buff.getUint8());this.m_buff=newbuff,firstpkgbuff.pos=0,this.m_logindecode.Decode(firstpkgbuff);var idx=this.m_loginIdx;firstpkgbuff.pos=27;var m_nToken=firstpkgbuff.getUint32();firstpkgbuff.pos=idx;var tmpkey=firstpkgbuff.getUint32();this.m_logindecode.Create(tmpkey),this.send_secondpkg(m_nToken),this.m_loginIdx=0;for(i=firstpkgbuff.pos=0;i<firstpkgbuff.length-1;++i)this.m_loginIdx+=this._getbuffuint8(firstpkgbuff,i)^this._getbuffuint8(firstpkgbuff,i+1);this.m_loginIdx=this.m_loginIdx%32,this.m_loginstep=1}},TL_Login_net.prototype.get_second_seed=function(msg){void 0===msg&&(msg=null);for(var recvbuff=msg,i=0;i<recvbuff.length;++i)this.m_buff.writeUint8(recvbuff.getUint8());if(this.m_buff.length<40)core.net_errlog("get_second_seed this.m_buff.length < secondpkglen ",this.m_buff.length);else{var secondpkgbuff=new laya.utils.Byte;for(i=this.m_buff.pos=0;i<40;++i)secondpkgbuff.writeUint8(this.m_buff.getUint8());for(var newbuff=new laya.utils.Byte;this.m_buff.pos<this.m_buff.length;)newbuff.writeUint8(this.m_buff.getUint8());this.m_buff=newbuff,secondpkgbuff.pos=0,this.m_logindecode.Decode(secondpkgbuff);var idx=this.m_loginIdx;secondpkgbuff.pos=idx;var tmpkey=secondpkgbuff.getUint32(),idxkey2=idx+4;secondpkgbuff.pos=idxkey2;secondpkgbuff.getUint32();this.m_recvdecode.Create(tmpkey),this.m_loginstep=2,this.m_b_connected=!0,null!=this.m_parent&&this.m_parent.on_notify("connect succeed"),core.net_errlog("connected succeed"),utils.event_ins().fire_event(game_event.EVENT_NET_CONNECTED,this),0<this.m_buff.length&&(this.m_buff.pos=0,this._decrypt_buff(this.m_buff),this._on_split_netpack())}},TL_Login_net.prototype._testsend=function(count){count.toString();for(var cc=8;0<cc;)" lalala,hello svr!",cc-=1},TL_Login_net.prototype.openHandler=function(event){void 0===event&&(event=null),core.net_errlog("TL_Login_net openHandler ",event),this.send_firstpkg()},TL_Login_net.prototype._decrypt_buff=function(buff){var oldpos=buff.pos;buff.pos=0,this.m_recvdecode.Encode(buff),buff.pos=oldpos},TL_Login_net.prototype._on_split_netpack=function(){for(;0<this.m_buff.bytesAvailable;){var data_2=this.m_buf_handle.s2c_buf2data_tl(this.m_buff);if(null==data_2){if(0<this.m_buff.pos){for(var tmp=new laya.utils.Byte;0<this.m_buff.bytesAvailable;)tmp.writeUint8(this.m_buff.getUint8());this.m_buff.clear(),this.m_buff=tmp}return}var cmd=data_2.cmd,recv=data_2.data;this.m_recv_list.push(new protocol_item(cmd,recv)),core.net_tiplog("recv ",cmd.toString(16),recv)}this.m_buff.clear()},TL_Login_net.prototype.receiveHandler=function(msg){if(void 0===msg&&(msg=null),0==this.m_loginstep)this.get_first_seed(this.m_socket.input);else if(1==this.m_loginstep)this.get_second_seed(this.m_socket.input);else{core.net_errlog("TL_Login_net receiveHandler ",msg,msg.length,this.m_socket.input.length);var tmp=this.m_socket.input;for(this.m_decodebuff.clear();tmp.pos<tmp.length;)this.m_decodebuff.writeUint8(tmp.getUint8());for(this.m_decodebuff.pos=0,this._decrypt_buff(this.m_decodebuff),0<this.m_buff.length&&(this.m_buff.pos=this.m_buff.length-1),this.m_decodebuff.pos=0;this.m_decodebuff.pos<this.m_decodebuff.length;)this.m_buff.writeUint8(this.m_decodebuff.getUint8());this.m_buff.pos=0,this._on_split_netpack()}},TL_Login_net.prototype.send_raw_buff=function(cmd,buff){if(this.m_b_connected){core.net_errlog("send_raw_buff ",cmd.toString(16),buff.length),this.m_sendbuff.clear(),this.m_sendbuff.endian=Laya.Byte.LITTLE_ENDIAN;var buffer=this.m_buf_handle.c2s_rawbuff2buf_tl(cmd,buff,this.m_sendbuff);buffer.pos=0,this.m_sendencode.Encode(buffer),buffer.pos=0,this.m_socket.send(buffer.buffer),core.net_errlog("send send_raw_buff len ",cmd.toString(16),buffer.length),this.m_socket.flush()}},TL_Login_net.prototype.send=function(cmd,data){if(void 0===data&&(data=null),this.m_b_connected){core.net_errlog("send ",cmd.toString(16),data),this.m_sendbuff.clear(),this.m_sendbuff.endian=Laya.Byte.LITTLE_ENDIAN;var buffer=this.m_buf_handle.c2s_data2buf_tl(cmd,data,this.m_sendbuff);buffer.pos=0,this.m_sendencode.Encode(buffer),buffer.pos=0,this.m_socket.send(buffer.buffer),core.net_errlog("send bufferlen ",cmd.toString(16),buffer.length),this.m_socket.flush()}},TL_Login_net.prototype.testlogin=function(account,pwd){if(this.m_b_connected){this.m_sendbuff.clear();this.m_sendbuff.clear();var newret=this.m_sendbuff;newret.endian=Laya.Byte.BIG_ENDIAN,newret.writeUint8(130),this.m_sendbuff.writeUint16(151),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(1),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(2),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(3),this.m_sendbuff.writeUTFBytes(account);for(var alen=64-account.length;0<alen;)this.m_sendbuff.writeUint8(0),alen-=1;this.m_sendbuff.writeUTFBytes(pwd);for(var pwdlen=32-pwd.length;0<pwdlen;)this.m_sendbuff.writeUint8(0),pwdlen-=1;this.m_sendbuff.writeUint8(0),this.m_sendbuff.writeUint8(0),this.m_sendbuff.writeUint8(0);for(var extlen=11;0<extlen;)this.m_sendbuff.writeUint8(0),extlen-=1;this._print_pkg(this.m_sendbuff,"testlogin src"),this.m_sendbuff.pos=0,this.m_sendencode.Encode(this.m_sendbuff),this._print_pkg(this.m_sendbuff,"testlogin encode "),this.m_sendbuff.pos=0,this.m_socket.send(this.m_sendbuff.buffer),core.net_errlog("testlogin bufferlen ",this.m_sendbuff.length),this.m_socket.flush()}else alert("Have not connected to svr")},TL_Login_net.prototype.close=function(){_super.prototype.close.call(this),this.m_loginstep=0,this.m_b_connected=!1},TL_Login_net.prototype.dispose=function(){this.close()},TL_Login_net}(game_net_mgr);net.TL_Login_net=TL_Login_net;var g_ins=null,g_b_mysvr=!1;net.net_ins=function(){return null==g_ins&&(g_ins=g_b_mysvr?new game_net_mgr:new TL_Login_net),g_ins},net.my_svr=function(flag){g_b_mysvr=flag},net.is_mysvr=function(){return g_b_mysvr},net.clear=function(){null!=g_ins&&(g_ins.dispose(),g_ins=null)}}(net||(net={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var renderani=function(_super){function renderani(){var _this=_super.call(this)||this;return _this.m_framecurrent=0,_this.m_framemillsec=0,_this.m_framecurrenttm=0,_this}return __extends(renderani,_super),renderani.prototype.re_init=function(aniid,x,y,underunit){void 0===underunit&&(underunit=!0),this.set_id(),this.m_aniid=aniid,this.m_rc=utils.getitembycls("anicommand",core.anicommand),this.m_rc.re_init(this),_super.prototype.set_pos.call(this,x,y),this.m_data=underunit,this.m_mat=null,this.m_aw=core.matinfo_mgr().getaniw(this.m_aniid),this.m_ah=core.matinfo_mgr().getanih(this.m_aniid),this.m_framecount=core.matinfo_mgr().getaniframecount(this.m_aniid),this.m_framespeed=core.matinfo_mgr().getaniframespeed(this.m_aniid),this.m_framemillsec=1e3/this.m_framespeed,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah)},renderani.prototype.project=function(context){var ret=_super.prototype.project.call(this,context);return ret&&null==this.m_mat&&(this.m_mat=core.mat_mgr().getanimat(this.m_aniid),this.addChild(this.m_mat.m_graphic)),ret},renderani.prototype.update=function(delta){this.m_framecurrenttm+=delta;var framecount=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=framecount%this.m_framecount,null!=this.m_mat&&this.m_mat.goto_frame(this.m_framecurrent)},renderani.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(core.mat_mgr().delanimat(this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("anicommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},renderani}(core.renderobject);core.renderani=renderani}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var renderavatar_default=function(_super){function renderavatar_default(){var _this=_super.call(this)||this;return _this.graphics.loadImage("avatar/default.png"),_this}return __extends(renderavatar_default,_super),renderavatar_default}(Laya.Sprite);core.renderavatar_default=renderavatar_default;var renderavatar_shadow=function(_super){function renderavatar_shadow(){var _this=_super.call(this)||this;return _this.graphics.loadImage("avatar/shadow.png"),_this}return __extends(renderavatar_shadow,_super),renderavatar_shadow}(Laya.Sprite);core.renderavatar_shadow=renderavatar_shadow;var renderavatar_adorn=function(_super){function renderavatar_adorn(){var _this=_super.call(this)||this;return _this.m_id=0,_this.m_front=!0,_this.m_dx=0,_this.m_dy=0,_this.m_id=_this._gen_id(),_this}return __extends(renderavatar_adorn,_super),renderavatar_adorn.prototype._gen_id=function(){return renderavatar_adorn.S_ADORN_IDMAX++},renderavatar_adorn.prototype.draw2sp=function(sp,x,y,b_front){void 0===b_front&&(b_front=!0)},renderavatar_adorn.prototype.update=function(delta){},renderavatar_adorn.prototype.dispose=function(){},renderavatar_adorn.S_ADORN_IDMAX=1,renderavatar_adorn}(Laya.Sprite),avatar_aura=function(_super){function avatar_aura(){var _this=_super.call(this)||this;return _this.m_framecurrent=0,_this.m_framemillsec=0,_this.m_frametotalmillsec=0,_this.m_framecurrenttm=0,_this.m_b_loop=!0,_this.m_b_end=!1,_this.m_b_autodel=!1,_this.m_b_loaded=!1,_this}return __extends(avatar_aura,_super),avatar_aura.prototype.re_init=function(aura_id){this.m_id=this._gen_id(),this.m_aniid=aura_id,this.m_mat=null,this.m_aw=core.matinfo_mgr().geteffw(this.m_aniid),this.m_ah=core.matinfo_mgr().geteffh(this.m_aniid),this.m_framecount=core.matinfo_mgr().geteffframecount(this.m_aniid),this.m_framespeed=core.matinfo_mgr().geteffframespeed(this.m_aniid),this.m_b_loop=core.matinfo_mgr().geteffcycle(this.m_aniid),this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_b_loaded=!1},avatar_aura.prototype.load_res=function(){return this.m_b_loaded||null==this.m_mat&&(this.m_mat=core.mat_mgr().geteffmat(this.m_aniid),this.addChild(this.m_mat.m_graphic),this.m_b_loaded=!0),!0},avatar_aura.prototype.update=function(delta){if(0!=this.m_b_loaded&&!this.m_b_end){if(this.m_framecurrenttm+=delta,this.m_framecurrenttm>=this.m_frametotalmillsec){if(this.m_b_autodel)return void(this.m_b_end=!0);if(0==this.m_b_loop)return void(this.m_b_end=!0)}var framecount=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=framecount%this.m_framecount,null!=this.m_mat&&this.m_mat.goto_frame(this.m_framecurrent)}},avatar_aura.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(core.mat_mgr().deleffmat(this.m_mat),this.m_mat=null),_super.prototype.dispose.call(this),utils.recover("avatar_aura",this)},avatar_aura}(core.renderavatar_adorn=renderavatar_adorn);core.avatar_aura=avatar_aura;var avatar_aura_new=function(_super){function avatar_aura_new(){var _this=_super.call(this)||this;return _this.m_framecurrent=0,_this.m_framecurrenttm=0,_this.m_b_loaded=!1,_this}return __extends(avatar_aura_new,_super),avatar_aura_new.prototype.re_init=function(aura_id){this.m_id=this._gen_id(),this.m_aniid=aura_id,this.m_mat=null,this.m_framecurrent=0,this.m_framecurrenttm=0,this.m_b_loaded=!1,this.m_dx=0,this.m_dy=0,this.m_front=!0},avatar_aura_new.prototype.load_res=function(){return 0==this.m_b_loaded&&(null==this.m_mat&&(this.m_mat=core.mat_mgr().getlavataranimat(this.m_aniid)),this.m_b_loaded=this.m_mat.m_b_loaded),!0},avatar_aura_new.prototype.draw2sp=function(sp,x,y,b_front){if(void 0===b_front&&(b_front=!0),this.m_b_loaded&&null!=this.m_mat&&this.m_mat.m_b_loaded&&this.m_front==b_front){var f=this.m_mat.get_frame(this.m_framecurrent);f&&sp.graphics.drawTexture(f.m_tex,x+f.m_dx+this.m_dx,y+f.m_dy+this.m_dy)}},avatar_aura_new.prototype.update=function(delta){if(this.m_framecurrenttm+=delta,this.m_b_loaded){var framecount=Math.floor(this.m_framecurrenttm/this.m_mat.m_framemillsec);this.m_framecurrent=framecount%this.m_mat.m_framecount}},avatar_aura_new.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(core.mat_mgr().dellavataranimat(this.m_mat),this.m_mat=null),_super.prototype.dispose.call(this),utils.recover("avatar_aura_new",this)},avatar_aura_new}(renderavatar_adorn);core.avatar_aura_new=avatar_aura_new;var renderavatar_old=function(_super){function renderavatar_old(){var _this=_super.call(this)||this;return _this.m_designw=512,_this.m_designh=512,_this.m_shape=0,_this.m_shape_weapon=0,_this.m_shape_wing=0,_this.m_shape_ride=0,_this.m_shape_backride=0,_this.m_shape_hair=0,_this.m_aura_id=0,_this.m_aura_adorn=null,_this.m_title_id=0,_this.m_title_adorn=null,_this.m_action=0,_this.m_lastaction=0,_this.m_dir=0,_this.m_framecurrent=0,_this.m_framemillsec=0,_this.m_frametotalmillsec=0,_this.m_framecurrenttm=0,_this.m_mat_dx=0,_this.m_mat_dy=-_this.m_designh/2,_this.m_ride_h=0,_this.m_user_data=0,_this.m_name="",_this.m_name_dx=0,_this.m_name_dy=0,_this.m_name_sp=null,_this.m_hp=null,_this.m_buff=null,_this.m_b_cycle=!0,_this.m_b_stop_frame=-1,_this.m_sp_front=null,_this.m_sp_back=null,_this.m_sp_center=null,_this.m_sp_center_f=null,_this.m_sp_center_b=null,_this.m_sp_center_c=null,_this.m_sp_center_rf=null,_this.m_sp_center_rb=null,_this.m_adorn_list=new Array,_this.m_dx=0,_this.m_dy=0,_this.m_org_pt=new Laya.Point(0,0),_this.m_shadow_sp=null,_this.m_default_sp=null,_this.m_draw_avatar=!1,_this.m_use_default=!0,_this.m_draw_link=!1,_this}return __extends(renderavatar_old,_super),renderavatar_old.prototype.re_init=function(shape,x,y,use_default){void 0===use_default&&(use_default=!0),this.set_id(),this.m_name_dx=0,this.m_name_dy=0,this.m_draw_link=!1,this.m_sp_front=new Laya.Sprite,this.m_sp_back=new Laya.Sprite,this.m_sp_center=new Laya.Sprite,this.m_sp_center_rb=new Laya.Sprite,this.m_sp_center_rf=new Laya.Sprite,this.m_sp_center_b=new Laya.Sprite,this.m_sp_center_c=new Laya.Sprite,this.m_sp_center_f=new Laya.Sprite,this.m_shadow_sp=utils.getitembycls("renderavatar_shadow",renderavatar_shadow),this.addChild(this.m_shadow_sp),this.m_shadow_sp.x=-50,this.m_shadow_sp.y=-35,this.set_ride_h(0),this.m_mat_dy=-this.m_designh/2,this.m_use_default=use_default,this.m_use_default?(this.m_draw_avatar=!1,this.create_default_sp()):this.m_draw_avatar=!0,this.m_sp_center.addChild(this.m_sp_center_rb),this.m_sp_center.addChild(this.m_sp_center_b),this.m_sp_center.addChild(this.m_sp_center_c),this.m_sp_center.addChild(this.m_sp_center_f),this.m_sp_center.addChild(this.m_sp_center_rf),this.m_dx=0,this.m_dy=0,this.addChild(this.m_sp_back),this.addChild(this.m_sp_center),this.addChild(this.m_sp_front),this.m_shape=shape,this.rotation=0,this.alpha=1,this.m_rc=utils.getitembycls("avatarcommand",core.avatarcommand),this.m_rc.re_init(this),_super.prototype.set_pos.call(this,x,y),this.m_mat=null,this.m_mat_weapon=null,this.m_mat_wing=null,this.m_mat_ride=null,this.m_mat_backride=null,this.m_mat_hair=null,this.m_shape_weapon=0,this.m_shape_wing=0,this.m_shape_ride=0,this.m_shape_backride=0,this.m_shape_hair=0,this.m_aura_id=0,this.m_aura_adorn=null,this.m_title_id=0,this.m_title_adorn=null,this.reset_data()},renderavatar_old.prototype.show_shadow=function(flag){flag?this.addChildAt(this.m_shadow_sp,0):this.m_shadow_sp.removeSelf()},renderavatar_old.prototype.set_dxy=function(x,y){this.m_dx=x,this.m_dy=y,this.m_sp_front.x=this.m_dx,this.m_sp_front.y=this.m_dy,this.m_sp_center.x=this.m_dx,this.m_sp_center.y=this.m_dy,this.m_sp_back.x=this.m_dx,this.m_sp_back.y=this.m_dy},renderavatar_old.prototype.change_shape=function(shape){shape!=this.m_shape&&(null!=this.m_mat&&(this.m_mat.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(this.m_mat),this.m_mat=null),this.m_shape=shape,this.reset_data(),this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},renderavatar_old.prototype.change_weapon=function(shape){shape!=this.m_shape_weapon&&(null!=this.m_mat_weapon&&(this.m_mat_weapon.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(this.m_mat_weapon),this.m_mat_weapon=null),this.m_shape_weapon=shape)},renderavatar_old.prototype.change_wing=function(shape){shape!=this.m_shape_wing&&(null!=this.m_mat_wing&&(this.m_mat_wing.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(this.m_mat_wing),this.m_mat_wing=null),this.m_shape_wing=shape)},renderavatar_old.prototype.change_ride=function(shape,backshape){shape!=this.m_shape_ride&&(null!=this.m_mat_ride&&(this.m_mat_ride.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(this.m_mat_ride),this.m_mat_ride=null),null!=this.m_mat_backride&&(this.m_mat_backride.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(this.m_mat_backride),this.m_mat_backride=null),this.m_shape_ride=shape,this.m_shape_backride=backshape,this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},renderavatar_old.prototype.set_ride_h=function(v){this.m_ride_h=v},renderavatar_old.prototype.change_hair=function(shape){shape!=this.m_shape_hair&&(null!=this.m_mat_hair&&(this.m_mat_hair.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(this.m_mat_hair),this.m_mat_hair=null),this.m_shape_hair=shape)},renderavatar_old.prototype.change_aura=function(shape){if(0!=this.m_aura_id&&(this.del_adorn(this.m_aura_id),this.m_aura_adorn=null,this.m_aura_id=0),0!=shape){var aura_adorn=utils.getitembycls("avatar_aura",avatar_aura);aura_adorn.re_init(shape),this.m_aura_id=aura_adorn.m_id,this.m_aura_adorn=aura_adorn,this.add_adorn(aura_adorn,!0)}},renderavatar_old.prototype.change_title=function(shape){if(0!=this.m_title_id&&(this.del_adorn(this.m_title_id),this.m_title_adorn=null,this.m_title_id=0),0!=shape){var aura_adorn=utils.getitembycls("avatar_aura",avatar_aura);aura_adorn.re_init(shape),this.m_title_id=aura_adorn.m_id,this.m_title_adorn=aura_adorn,this.add_adorn(aura_adorn,!1)}},renderavatar_old.prototype.reset_data=function(){this.m_aw=core.matinfo_mgr().getavataractionw(this.m_shape,this.m_action),this.m_ah=core.matinfo_mgr().getavataractionh(this.m_shape,this.m_action),this.m_framecount=core.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),this.m_framespeed=core.matinfo_mgr().getavataractionframespeed(this.m_shape,this.m_action),this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_framecurrenttm=0,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah),core.core_tiplog("renderavatar resetdata ",this.m_obj_id,this.m_shape,this.m_dir,this.m_action,this.m_framecount)},renderavatar_old.prototype.set_name=function(name){this.m_name=name,null==this.m_name_sp&&(this.m_name_sp=utils.getitembycls("avatarname",core.avatarname),this.m_name_sp.re_init(),this.m_sp_front.addChild(this.m_name_sp)),this.m_name_sp.m_text.text=this.m_name,0<this.m_name.length?this.m_sp_front.addChild(this.m_name_sp):this.m_name_sp.removeSelf()},renderavatar_old.prototype.set_name_dxy=function(x,y){this.m_name_dx=x,this.m_name_dy=y,null!=this.m_name_sp&&(this.m_name_sp.x=x,this.m_name_sp.y=y)},renderavatar_old.prototype.set_dy=function(dy){this.m_mat_dy=dy-this.m_ah/2},renderavatar_old.prototype.set_dx=function(dx){this.m_mat_dx=dx},renderavatar_old.prototype.get_buffui=function(){return null==this.m_buff&&(this.m_buff=utils.getitembycls("avatarbuffui",core.avatarbuffui),this.m_buff.re_init(),this.m_sp_front.addChild(this.m_buff)),this.m_buff},renderavatar_old.prototype.del_buffui=function(){null!=this.m_buff&&(this.m_buff.removeSelf(),this.m_buff.clear(),utils.recover("avatarbuffui",this.m_buff),this.m_buff=null)},renderavatar_old.prototype.add_buffeff=function(eff_id){return 0},renderavatar_old.prototype.del_buffeff=function(buff_eff_id){},renderavatar_old.prototype.clearall_buffeff=function(){},renderavatar_old.prototype.set_hp=function(v,m){null==this.m_hp&&(this.m_hp=utils.getitembycls("avatarhp",core.avatarhp),this.m_hp.re_init(),this.m_sp_front.addChild(this.m_hp),this.m_hp.x=0-this.m_hp.m_w/2,this.m_hp.y=-120),this.m_hp.set_v(v,m)},renderavatar_old.prototype.del_hp=function(){null!=this.m_hp&&(this.m_hp.removeSelf(),this.m_hp.clear(),utils.recover("avatarhp",this.m_hp),this.m_hp=null)},renderavatar_old.prototype.add_adorn=function(sp,b_back){return this.del_adorn(sp.m_id),b_back?this.m_sp_back.addChild(sp):this.m_sp_front.addChild(sp),this.m_adorn_list.push(sp),sp.m_id},renderavatar_old.prototype.get_adorn=function(id){for(var _i=0,_a=this.m_adorn_list;_i<_a.length;_i++){var i=_a[_i];if(i.m_id==id)return i;0}return null},renderavatar_old.prototype.del_adorn=function(id){for(var idx=0,_i=0,_a=this.m_adorn_list;_i<_a.length;_i++){var i=_a[_i];if(i.m_id==id)return i.removeSelf(),i.dispose(),void this.m_adorn_list.splice(idx,1);idx++}},renderavatar_old.prototype.change_action=function(action,b_cycle,stop_f){void 0===b_cycle&&(b_cycle=!0),void 0===stop_f&&(stop_f=-1),core.core_tiplog("renderavatar change_action ",this.m_obj_id,this.m_shape,this.m_action,action,this.m_dir),this.m_lastaction=this.m_action,this.m_action=action,this.m_b_cycle=b_cycle,this.m_b_stop_frame=stop_f,action!=this.m_action&&this.m_use_default&&(this.m_draw_avatar=!1,this.m_sp_center.removeSelf(),this.create_default_sp())},renderavatar_old.prototype.change_dir=function(dir){if(dir!=this.m_dir){if(this.m_dir=dir,null!=this.m_mat&&this.m_mat.changedir(dir),null!=this.m_mat_weapon){this.m_mat_weapon.changedir(dir);var sp=this._get_weapon_sp(dir,this.m_mat_weapon.m_b_mirrior);this.m_mat_weapon.m_graphic.removeSelf(),sp.addChild(this.m_mat_weapon.m_graphic)}if(null!=this.m_mat_wing){this.m_mat_wing.changedir(dir);sp=this._get_wing_sp(dir,this.m_mat_wing.m_b_mirrior);this.m_mat_wing.m_graphic.removeSelf(),sp.addChild(this.m_mat_wing.m_graphic)}null!=this.m_mat_ride&&this.m_mat_ride.changedir(dir),null!=this.m_mat_backride&&this.m_mat_backride.changedir(dir),null!=this.m_mat_hair&&this.m_mat_hair.changedir(dir)}},renderavatar_old.prototype._project_mat=function(mat,mtype,shape,sp,b_create){return void 0===b_create&&(b_create=!0),null!=mat&&mat.m_action!=this.m_action&&(mat.m_graphic.removeSelf(),core.mat_mgr().delavataractionmaterial(mat),mat=null),null==mat&&(mat=core.mat_mgr().getavataractionmat(shape,this.m_action),sp&&sp.addChild(mat.m_graphic),mat.changedir(this.m_dir)),mat},renderavatar_old.prototype.set_scale=function(sx,sy){this.m_sp_center.scale(sx,sy)},renderavatar_old.prototype._get_mat_dx=function(){return this.m_mat_dx},renderavatar_old.prototype._get_mat_dy=function(){return this.m_mat_dy-this.m_ride_h},renderavatar_old.prototype._get_weapon_sp=function(dir,b_mirror){return void 0===b_mirror&&(b_mirror=!1),2<=dir&&dir<=5?this.m_sp_center_b:this.m_sp_center_f},renderavatar_old.prototype._get_wing_sp=function(dir,b_mirror){return void 0===b_mirror&&(b_mirror=!1),2<=dir&&dir<=5?this.m_sp_center_f:this.m_sp_center_b},renderavatar_old.prototype.project=function(context){var ret=_super.prototype.project.call(this,context);if(ret){null!=this.m_mat&&this.m_mat.m_action!=this.m_action&&this.reset_data(),null!=this.m_aura_adorn&&this.m_aura_adorn.load_res(),null!=this.m_title_adorn&&this.m_title_adorn.load_res();var b_br=!0;0!=this.m_shape_backride&&(this.m_mat_backride=this._project_mat(this.m_mat_backride,5,this.m_shape_backride,this.m_sp_center_rb,5!=this.m_action),this.m_draw_avatar||(b_br=this.m_mat_backride.m_b_loaded));var b_m=!0;this.m_mat=this._project_mat(this.m_mat,0,this.m_shape,this.m_sp_center_c),this.m_draw_avatar||(b_m=this.m_mat.m_b_loaded),0!=this.m_shape_weapon&&(this.m_mat_weapon=this._project_mat(this.m_mat_weapon,1,this.m_shape_weapon,this._get_weapon_sp(this.m_dir))),0!=this.m_shape_wing&&(this.m_mat_wing=this._project_mat(this.m_mat_wing,2,this.m_shape_wing,this._get_wing_sp(this.m_dir)));var b_fr=!0;0!=this.m_shape_ride&&(this.m_mat_ride=this._project_mat(this.m_mat_ride,3,this.m_shape_ride,this.m_sp_center_rf,5!=this.m_action),this.m_draw_avatar||(b_fr=this.m_mat_ride.m_b_loaded)),0!=this.m_shape_hair&&(this.m_mat_hair=this._project_mat(this.m_mat_hair,4,this.m_shape_hair,this.m_sp_center)),this.m_draw_avatar||b_br&&b_m&&b_fr&&(this.m_draw_avatar=!0,this.m_sp_back.removeSelf(),this.m_sp_front.removeSelf(),this.addChild(this.m_sp_back),this.addChild(this.m_sp_center),this.addChild(this.m_sp_front),this.del_default_sp())}return ret},renderavatar_old.prototype._update_mat=function(mat,frame){mat.goto_frame(frame)},renderavatar_old.prototype.update=function(delta){for(var _i=0,_a=this.m_adorn_list;_i<_a.length;_i++){_a[_i].update(delta)}this.m_framecurrenttm+=delta;var framecount=Math.floor(this.m_framecurrenttm/this.m_framemillsec);if(0==this.m_b_cycle)if(0==this.m_b_stop_frame){if(framecount>this.m_framecount-1)return void this.change_action(this.m_lastaction)}else{var stop_f=this.m_framecount-1;-1!=this.m_b_stop_frame&&(stop_f=this.m_b_stop_frame),stop_f<framecount&&(framecount=stop_f)<0&&(framecount=0)}if(this.m_framecurrent=framecount%this.m_framecount,this.m_draw_avatar){var org_pt=this.m_org_pt;if(null!=this.m_mat){if(org_pt=this.m_mat.get_link(this.m_dir,0,this.m_framecurrent),this._update_mat(this.m_mat,this.m_framecurrent),this.m_mat.m_graphic.x=this._get_mat_dx(),this.m_mat.m_graphic.y=this._get_mat_dy(),null!=this.m_mat_weapon){this._update_mat(this.m_mat_weapon,this.m_framecurrent);var pt=this.m_mat.get_link(this.m_dir,3,this.m_framecurrent),pt1=this.m_mat_weapon.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat.m_cur_mirrior?this.m_mat_weapon.m_graphic.x=this._get_mat_dx()+pt1.x-pt.x:this.m_mat_weapon.m_graphic.x=this._get_mat_dx()+pt.x-pt1.x,this.m_mat_weapon.m_graphic.y=this._get_mat_dy()+pt.y-pt1.y}if(null!=this.m_mat_wing){this._update_mat(this.m_mat_wing,this.m_framecurrent);pt=this.m_mat.get_link(this.m_dir,1,this.m_framecurrent),pt1=this.m_mat_wing.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat.m_cur_mirrior?this.m_mat_wing.m_graphic.x=this._get_mat_dx()+pt1.x-pt.x:this.m_mat_wing.m_graphic.x=this._get_mat_dx()+pt.x-pt1.x,this.m_mat_wing.m_graphic.y=this._get_mat_dy()+pt.y-pt1.y}if(this.m_sp_center_b.x=0,this.m_sp_center_b.y=0,this.m_sp_center_c.x=0,this.m_sp_center_c.y=0,this.m_sp_center_f.x=0,this.m_sp_center_f.y=0,null!=this.m_mat_ride){this._update_mat(this.m_mat_ride,this.m_framecurrent);pt=this.m_mat_ride.get_link(this.m_dir,3,this.m_framecurrent),pt1=this.m_mat_ride.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat_ride.m_graphic.x=this._get_mat_dx(),this.m_mat_ride.m_graphic.y=this._get_mat_dy()}if(null!=this.m_mat_backride){this._update_mat(this.m_mat_backride,this.m_framecurrent);pt=this.m_mat_backride.get_link(this.m_dir,3,this.m_framecurrent),pt1=this.m_mat_backride.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat_backride.m_graphic.x=this._get_mat_dx(),this.m_mat_backride.m_graphic.y=this._get_mat_dy();var rb_dx=pt.x-pt1.x;this.m_mat.m_cur_mirrior&&(rb_dx=pt1.x-pt.x);var rb_dy=pt.y-pt1.y+pt1.y-org_pt.y;this.m_sp_center_b.x=rb_dx,this.m_sp_center_b.y=rb_dy,this.m_sp_center_c.x=rb_dx,this.m_sp_center_c.y=rb_dy,this.m_sp_center_f.x=rb_dx,this.m_sp_center_f.y=rb_dy}if(null!=this.m_mat_hair){this._update_mat(this.m_mat_hair,this.m_framecurrent);pt=this.m_mat.get_link(this.m_dir,2,this.m_framecurrent),pt1=this.m_mat_hair.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat.m_cur_mirrior?this.m_mat_hair.m_graphic.x=this._get_mat_dx()+pt1.x-pt.x:this.m_mat_hair.m_graphic.x=this._get_mat_dx()+pt.x-pt1.x,this.m_mat_hair.m_graphic.y=this._get_mat_dy()+pt.y-pt1.y}}}},renderavatar_old.prototype.is_contain=function(x,y){var ret=_super.prototype.is_contain.call(this,x,y);if(ret){var rt=null;ret=!1;var rx=void 0,ry=void 0;null!=this.m_mat&&null!=(rt=this.m_mat.get_rect())&&(rx=this.x+this.m_mat.m_graphic.x-this.m_aw/2+rt.x-this._get_mat_dx(),ry=this.y+this.m_mat.m_graphic.y-this.m_ah/2+rt.y-this._get_mat_dy()-this.m_ride_h,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0)),ret||null==this.m_mat_weapon||null!=(rt=this.m_mat_weapon.get_rect())&&(rx=this.x+this.m_mat_weapon.m_graphic.x-this.m_aw/2+rt.x-this._get_mat_dx(),ry=this.y+this.m_mat_weapon.m_graphic.y-this.m_ah/2+rt.y-this._get_mat_dy()-this.m_ride_h,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0)),ret||null==this.m_mat_wing||null!=(rt=this.m_mat_wing.get_rect())&&(rx=this.x+this.m_mat_wing.m_graphic.x-this.m_aw/2+rt.x-this._get_mat_dx(),ry=this.y+this.m_mat_wing.m_graphic.y-this.m_ah/2+rt.y-this._get_mat_dy()-this.m_ride_h,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0)),ret||null==this.m_mat_ride||null!=(rt=this.m_mat_ride.get_rect())&&(rx=this.x+this.m_mat_ride.m_graphic.x-this.m_aw/2+rt.x-this._get_mat_dx(),ry=this.y+this.m_mat_ride.m_graphic.y-this.m_ah/2+rt.y-this._get_mat_dy()-this.m_ride_h,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&512!=rt.width&&(ret=!0)),ret||null==this.m_mat_backride||null!=(rt=this.m_mat_backride.get_rect())&&(rx=this.x+this.m_mat_backride.m_graphic.x-this.m_aw/2+rt.x-this._get_mat_dx(),ry=this.y+this.m_mat_backride.m_graphic.y-this.m_ah/2+rt.y-this._get_mat_dy()-this.m_ride_h,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&512!=rt.width&&(ret=!0)),ret||null==this.m_mat_hair||null!=(rt=this.m_mat_hair.get_rect())&&(rx=this.x+this.m_mat_hair.m_graphic.x-this.m_aw/2+rt.x-this._get_mat_dx(),ry=this.y+this.m_mat_hair.m_graphic.y-this.m_ah/2+rt.y-this._get_mat_dy()-this.m_ride_h,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0))}return ret},renderavatar_old.prototype.create_default_sp=function(){null==this.m_default_sp&&(this.m_default_sp=utils.getitembycls("renderavatar_default",renderavatar_default),this.addChild(this.m_default_sp),this.m_default_sp.y=-120,this.m_default_sp.x=-26)},renderavatar_old.prototype.del_default_sp=function(){null!=this.m_default_sp&&(this.m_default_sp.removeSelf(),utils.recover("renderavatar_default",this.m_default_sp),this.m_default_sp=null)},renderavatar_old.prototype.dispose=function(){this.removeChildren(),null!=this.m_shadow_sp&&(this.m_shadow_sp.removeSelf(),utils.recover("renderavatar_shadow",this.m_shadow_sp),this.m_shadow_sp=null),this.del_default_sp(),null!=this.m_sp_back&&(this.m_sp_back.removeChildren(),this.m_sp_back=null),null!=this.m_sp_front&&(this.m_sp_front.removeChildren(),this.m_sp_front=null),null!=this.m_sp_center&&(this.m_sp_center.removeChildren(),this.m_sp_center=null),null!=this.m_sp_center_c&&(this.m_sp_center_c.removeChildren(),this.m_sp_center_c=null),null!=this.m_sp_center_b&&(this.m_sp_center_b.removeChildren(),this.m_sp_center_b=null),null!=this.m_sp_center_f&&(this.m_sp_center_f.removeChildren(),this.m_sp_center_f=null),null!=this.m_sp_center_rb&&(this.m_sp_center_rb.removeChildren(),this.m_sp_center_rb=null),null!=this.m_sp_center_rf&&(this.m_sp_center_rf.removeChildren(),this.m_sp_center_rf=null),0!=this.m_aura_id&&this.change_aura(0),0!=this.m_title_id&&this.change_title(0);for(var _i=0,_a=this.m_adorn_list;_i<_a.length;_i++){_a[_i].dispose()}this.m_adorn_list.length=0,this.removeChildren(),null!=this.m_name_sp&&(this.m_name_sp.dispose(),utils.recover("avatarname",this.m_name_sp),this.m_name_sp=null),this.del_hp(),this.del_buffui(),null!=this.m_mat&&(core.mat_mgr().delavataractionmaterial(this.m_mat),this.m_mat=null),null!=this.m_mat_weapon&&(core.mat_mgr().delavataractionmaterial(this.m_mat_weapon),this.m_mat_weapon=null),null!=this.m_mat_wing&&(core.mat_mgr().delavataractionmaterial(this.m_mat_wing),this.m_mat_wing=null),null!=this.m_mat_ride&&(core.mat_mgr().delavataractionmaterial(this.m_mat_ride),this.m_mat_ride=null),null!=this.m_mat_backride&&(core.mat_mgr().delavataractionmaterial(this.m_mat_backride),this.m_mat_backride=null),null!=this.m_mat_hair&&(core.mat_mgr().delavataractionmaterial(this.m_mat_hair),this.m_mat_hair=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("avatarcommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},renderavatar_old}(core.renderobject);core.renderavatar_old=renderavatar_old;var renderavatar_new=function(_super){function renderavatar_new(){var _this=_super.call(this)||this;return _this.m_designw=512,_this.m_designh=512,_this.m_shape=0,_this.m_shape_weapon=0,_this.m_shape_wing=0,_this.m_shape_ride=0,_this.m_shape_backride=0,_this.m_shape_hair=0,_this.m_aura_id=0,_this.m_aura_adorn=null,_this.m_title_id=0,_this.m_title_adorn=null,_this.m_action=0,_this.m_lastaction=0,_this.m_dir=0,_this.m_framecurrent=0,_this.m_framemillsec=0,_this.m_frametotalmillsec=0,_this.m_framecurrenttm=0,_this.m_mat_dx=0,_this.m_mat_dy=-_this.m_designh/2,_this.m_ride_h=0,_this.m_user_data=0,_this.m_name="",_this.m_name_dx=0,_this.m_name_dy=0,_this.m_name_sp=null,_this.m_hp=null,_this.m_buff=null,_this.m_buffeff_list=new Array,_this.m_eff_list=new Array,_this.m_b_cycle=!0,_this.m_b_stop_frame=-1,_this.m_sp_front=null,_this.m_sp_back=null,_this.m_sp_center=null,_this.m_adorn_list=new Array,_this.m_dx=0,_this.m_dy=0,_this.m_org_pt=new Laya.Point(0,0),_this.m_shadow_sp=null,_this.m_default_sp=null,_this.m_draw_avatar=!1,_this.m_use_default=!0,_this.m_b_projected=!1,_this.m_draw_link=!1,_this.m_mat_rt=new Laya.Rectangle,_this.m_weapon_behind=!1,_this.m_mat_weapon_rt=new Laya.Rectangle,_this.m_mat_wing_rt=new Laya.Rectangle,_this.m_mat_ride_rt=new Laya.Rectangle,_this.m_mat_backeride_rt=new Laya.Rectangle,_this.m_mat_hair_rt=new Laya.Rectangle,_this}return __extends(renderavatar_new,_super),renderavatar_new.prototype.re_init=function(shape,x,y,use_default){void 0===use_default&&(use_default=!0),this.set_id(),this.scale(1,1),this.alpha=1,this.m_draw_link=!1,this.m_name_dx=0,this.m_name_dy=0,this.m_sp_front=new Laya.Sprite,this.m_sp_back=new Laya.Sprite,this.m_sp_center=new Laya.Sprite,this.m_shadow_sp=core.mat_mgr().get_avatar_shadow_mat(),this.set_ride_h(0),this.m_mat_dy=-this.m_designh/2,this.m_use_default=use_default,this.m_use_default?(this.m_draw_avatar=!1,this.create_default_sp()):this.m_draw_avatar=!0,this.m_dx=0,this.m_dy=0,this.m_shape=shape,this.rotation=0,this.alpha=1,this.m_rc=utils.getitembycls("avatarcommand_new",core.avatarcommand_new),this.m_rc.re_init(this),_super.prototype.set_pos.call(this,x,y),null!=this.m_mat&&core.mat_mgr().dellavatarmaterial(this.m_mat),(this.m_mat=null)!=this.m_mat_weapon&&core.mat_mgr().dellavatarmaterial(this.m_mat_weapon),(this.m_mat_weapon=null)!=this.m_mat_wing&&core.mat_mgr().dellavatarmaterial(this.m_mat_wing),(this.m_mat_wing=null)!=this.m_mat_ride&&core.mat_mgr().dellavatarmaterial(this.m_mat_ride),(this.m_mat_ride=null)!=this.m_mat_backride&&core.mat_mgr().dellavatarmaterial(this.m_mat_backride),(this.m_mat_backride=null)!=this.m_mat_hair&&core.mat_mgr().dellavatarmaterial(this.m_mat_hair),this.m_mat_hair=null,this.m_weapon_behind=!1,this.m_shape_weapon=0,this.m_shape_wing=0,this.m_shape_ride=0,this.m_shape_backride=0,this.m_shape_hair=0,this.m_aura_id=0,this.m_aura_adorn=null,this.m_title_id=0,this.m_title_adorn=null,this.m_buffeff_list=new Array,this.m_eff_list=new Array,this.reset_data(),this.graphics.clear()},renderavatar_new.prototype.show_shadow=function(flag){this.m_shadow_sp=flag?core.mat_mgr().get_avatar_shadow_mat():null},renderavatar_new.prototype.set_dxy=function(x,y){this.m_dx=x,this.m_dy=y,this.m_sp_front.x=this.m_dx,this.m_sp_front.y=this.m_dy,this.m_sp_center.x=this.m_dx,this.m_sp_center.y=this.m_dy,this.m_sp_back.x=this.m_dx,this.m_sp_back.y=this.m_dy},renderavatar_new.prototype.change_shape=function(shape){shape!=this.m_shape&&(this.m_shape=shape,this.reset_data(),this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},renderavatar_new.prototype.change_weapon=function(shape,behind_body){void 0===behind_body&&(behind_body=!1),shape!=this.m_shape_weapon&&(this.m_shape_weapon=shape,this.m_weapon_behind=behind_body)},renderavatar_new.prototype.change_wing=function(shape){shape!=this.m_shape_wing&&(this.m_shape_wing=shape)},renderavatar_new.prototype.change_ride=function(shape,backshape){shape!=this.m_shape_ride&&(this.m_shape_ride=shape,this.m_shape_backride=backshape,this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},renderavatar_new.prototype.set_ride_h=function(v){this.m_ride_h=v},renderavatar_new.prototype.change_hair=function(shape){shape!=this.m_shape_hair&&(this.m_shape_hair=shape)},renderavatar_new.prototype.change_aura=function(shape){if(0!=this.m_aura_id&&(this.del_adorn(this.m_aura_id),this.m_aura_adorn=null,this.m_aura_id=0),0!=shape){var aura_adorn=utils.getitembycls("avatar_aura_new",avatar_aura_new);aura_adorn.re_init(shape),this.m_aura_id=aura_adorn.m_id,this.m_aura_adorn=aura_adorn,this.add_adorn(aura_adorn,!0)}},renderavatar_new.prototype.change_title=function(shape){if(0!=this.m_title_id&&(this.del_adorn(this.m_title_id),this.m_title_adorn=null,this.m_title_id=0),0!=shape){var aura_adorn=utils.getitembycls("avatar_aura_new",avatar_aura_new);aura_adorn.re_init(shape),this.m_title_id=aura_adorn.m_id,this.m_title_adorn=aura_adorn,this.add_adorn(aura_adorn,!1)}},renderavatar_new.prototype.reset_data=function(){this.m_aw=core.matinfo_mgr().getavataractionw(this.m_shape,this.m_action),this.m_ah=core.matinfo_mgr().getavataractionh(this.m_shape,this.m_action),this.m_mat_dy=-this.m_ah/2,this.m_framecount=core.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),this.m_framespeed=core.matinfo_mgr().getavataractionframespeed(this.m_shape,this.m_action),this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_framecurrenttm=0,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah),core.core_tiplog("renderavatar resetdata ",this.m_obj_id,this.m_shape,this.m_dir,this.m_action,this.m_framecount)},renderavatar_new.prototype.set_name=function(name){this.m_name=name,null==this.m_name_sp&&(this.m_name_sp=utils.getitembycls("avatarname",core.avatarname),this.m_name_sp.re_init()),this.m_name_sp.m_text.text=this.m_name,0<this.m_name.length||this.m_name_sp.removeSelf()},renderavatar_new.prototype.set_name_dxy=function(x,y){this.m_name_dx=x,this.m_name_dy=y,null!=this.m_name_sp&&(this.m_name_sp.x=x,this.m_name_sp.y=y)},renderavatar_new.prototype.set_dy=function(dy){this.m_mat_dy=dy-this.m_ah/2},renderavatar_new.prototype.set_dx=function(dx){this.m_mat_dx=dx},renderavatar_new.prototype.get_buffui=function(){return null==this.m_buff&&(this.m_buff=utils.getitembycls("avatarbuffui",core.avatarbuffui),this.m_buff.re_init(),this.addChild(this.m_buff)),this.m_buff},renderavatar_new.prototype.del_buffui=function(){null!=this.m_buff&&(this.m_buff.removeSelf(),this.m_buff.clear(),utils.recover("avatarbuffui",this.m_buff),this.m_buff=null)},renderavatar_new.prototype.addeff=function(eff_id,b_front,dx,dy){if(void 0===b_front&&(b_front=!0),void 0===dx&&(dx=0),void 0===dy&&(dy=0),0!=eff_id){var aura_adorn=utils.getitembycls("avatar_aura_new",avatar_aura_new);aura_adorn.re_init(eff_id),aura_adorn.m_dx=dx,aura_adorn.m_dy=dy;var id=aura_adorn.m_id;return this.add_adorn(aura_adorn,!b_front),this.m_eff_list.push(aura_adorn),id}},renderavatar_new.prototype.del_eff=function(eff_id){for(var i=0;i<this.m_eff_list.length;++i){var b=this.m_eff_list[i];if(b.m_id==eff_id)return this.del_adorn(b.m_id),void this.m_eff_list.splice(i,1)}},renderavatar_new.prototype.clearall_eff=function(){for(var _i=0,_a=this.m_eff_list;_i<_a.length;_i++){var i=_a[_i];this.del_adorn(i.m_id)}this.m_eff_list=new Array},renderavatar_new.prototype.add_buffeff=function(eff_id){if(0!=eff_id){var aura_adorn=utils.getitembycls("avatar_aura_new",avatar_aura_new);aura_adorn.re_init(eff_id);var id=aura_adorn.m_id;return this.add_adorn(aura_adorn,!1),this.m_buffeff_list.push(aura_adorn),id}},renderavatar_new.prototype.del_buffeff=function(buff_eff_id){for(var i=0;i<this.m_buffeff_list.length;++i){var b=this.m_buffeff_list[i];if(b.m_id==buff_eff_id)return this.del_adorn(b.m_id),void this.m_buffeff_list.splice(i,1)}},renderavatar_new.prototype.clearall_buffeff=function(){for(var _i=0,_a=this.m_buffeff_list;_i<_a.length;_i++){var i=_a[_i];this.del_adorn(i.m_id)}this.m_buffeff_list=new Array},renderavatar_new.prototype.set_hp=function(v,m){null==this.m_hp&&(this.m_hp=utils.getitembycls("avatarhp",core.avatarhp),this.m_hp.re_init(),this.addChild(this.m_hp),this.m_hp.x=0-this.m_hp.m_w/2,this.m_hp.y=-120),this.m_hp.set_v(v,m)},renderavatar_new.prototype.del_hp=function(){null!=this.m_hp&&(this.m_hp.removeSelf(),this.m_hp.clear(),utils.recover("avatarhp",this.m_hp),this.m_hp=null)},renderavatar_new.prototype.add_adorn=function(sp,b_back){return this.del_adorn(sp.m_id),sp.m_front=!b_back,this.m_adorn_list.push(sp),sp.m_id},renderavatar_new.prototype.get_adorn=function(id){for(var _i=0,_a=this.m_adorn_list;_i<_a.length;_i++){var i=_a[_i];if(i.m_id==id)return i;0}return null},renderavatar_new.prototype.del_adorn=function(id){for(var idx=0,_i=0,_a=this.m_adorn_list;_i<_a.length;_i++){var i=_a[_i];if(i.m_id==id)return i.removeSelf(),i.dispose(),void this.m_adorn_list.splice(idx,1);idx++}},renderavatar_new.prototype.change_action=function(action,b_cycle,stop_f){void 0===b_cycle&&(b_cycle=!0),void 0===stop_f&&(stop_f=-1),core.core_tiplog("renderavatar change_action ",this.m_obj_id,this.m_shape,this.m_action,action,this.m_dir);this.m_action;this.m_lastaction=this.m_action,this.m_action=action,this.reset_data(),this.m_b_cycle=b_cycle,this.m_b_stop_frame=stop_f},renderavatar_new.prototype.change_dir=function(dir){dir!=this.m_dir&&(this.m_dir=dir)},renderavatar_new.prototype._project_mat=function(mat,cur_shape){return null==mat||mat.m_action==this.m_action&&mat.m_shape==cur_shape||(core.mat_mgr().dellavatarmaterial(mat),mat=null),null==mat&&(mat=core.mat_mgr().getlavatarmat(cur_shape,this.m_action)),mat},renderavatar_new.prototype.set_scale=function(sx,sy){this.scale(sx,sy)},renderavatar_new.prototype._get_mat_dx=function(){return this.m_mat_dx},renderavatar_new.prototype._get_mat_dy=function(){return this.m_mat_dy-this.m_ride_h},renderavatar_new.prototype.project=function(context){var ret=_super.prototype.project.call(this,context);if(this.m_b_projected=ret){null==this.m_mat||this.m_mat.m_action==this.m_action&&this.m_mat.m_shape==this.m_shape||this.reset_data(),null!=this.m_aura_adorn&&this.m_aura_adorn.load_res(),null!=this.m_title_adorn&&this.m_title_adorn.load_res();for(var _i=0,_a=this.m_buffeff_list;_i<_a.length;_i++){_a[_i].load_res()}for(var _b=0,_c=this.m_eff_list;_b<_c.length;_b++){_c[_b].load_res()}var b_br=!0;0!=this.m_shape_backride&&(this.m_mat_backride=this._project_mat(this.m_mat_backride,this.m_shape_backride),this.m_draw_avatar||(b_br=this.m_mat_backride.m_b_loaded));var b_m=!0;this.m_mat=this._project_mat(this.m_mat,this.m_shape),this.m_draw_avatar||(b_m=this.m_mat.m_b_loaded),0!=this.m_shape_weapon&&(this.m_mat_weapon=this._project_mat(this.m_mat_weapon,this.m_shape_weapon)),0!=this.m_shape_wing&&(this.m_mat_wing=this._project_mat(this.m_mat_wing,this.m_shape_wing));var b_fr=!0;0!=this.m_shape_ride&&(this.m_mat_ride=this._project_mat(this.m_mat_ride,this.m_shape_ride),this.m_draw_avatar||(b_fr=this.m_mat_ride.m_b_loaded)),0!=this.m_shape_hair&&(this.m_mat_hair=this._project_mat(this.m_mat_hair,this.m_shape_hair)),this.m_draw_avatar||b_br&&b_m&&b_fr&&(this.m_draw_avatar=!0,this.m_sp_back.removeSelf(),this.m_sp_front.removeSelf(),this.del_default_sp())}return ret},renderavatar_new.prototype._draw_mat=function(mat,link_idx,rt,dx,dy,b_body_mirrior,body_link_dir){if(null!=mat&&mat.m_b_loaded){var drawy,link_dir=this.m_dir,b_mirrior=mat.m_dir_tex[this.m_dir].m_b_mirror,drawx=dx;b_mirrior&&(link_dir=mat.m_dir_tex[this.m_dir].m_use_dir);var pt=this.m_mat.get_link(body_link_dir,link_idx,this.m_framecurrent),pt1=mat.get_link(link_dir,0,this.m_framecurrent);drawx=b_mirrior?b_body_mirrior?dx+(this.m_aw-pt1.x)-(this.m_aw-pt.x):dx+(this.m_aw-pt1.x)-pt.x:b_body_mirrior?dx+pt1.x-(this.m_aw-pt.x):dx+pt1.x-pt.x,drawy=dy+pt.y-pt1.y;var tex,matf=void 0;(tex=(matf=mat.m_dir_tex[this.m_dir]).get_texture(this.m_framecurrent))&&(this.graphics.drawTexture(tex,drawx,drawy,mat.m_width,mat.m_height,matf.m_matrix),rt.x=drawx+tex.offsetX,b_mirrior&&(rt.x=drawx+tex.sourceWidth-tex.offsetX-tex.width),rt.y=drawy+tex.offsetY,rt.width=tex.width,rt.height=tex.height)}return rt},renderavatar_new.prototype.update=function(delta){for(var _i=0,_a=this.m_adorn_list;_i<_a.length;_i++){_a[_i].update(delta)}this.m_framecurrenttm+=delta;var framecount=Math.floor(this.m_framecurrenttm/this.m_framemillsec);if(0==this.m_b_cycle)if(0==this.m_b_stop_frame){if(framecount>this.m_framecount-1)return void this.change_action(this.m_lastaction)}else{var stop_f=this.m_framecount-1;-1!=this.m_b_stop_frame&&(stop_f=this.m_b_stop_frame),stop_f<framecount&&(framecount=stop_f)<0&&(framecount=0)}if(this.m_framecurrent=framecount%this.m_framecount,this.m_draw_avatar&&this.m_b_projected&&(this.graphics.clear(),this.m_sp_back.graphics.clear(),null!=this.m_mat&&0!=this.m_mat.m_b_loaded)){var dx,dy,org_pt=this.m_org_pt,rdx=(new Laya.Point,0),rdy=0,drawx=0,drawy=0,b_mirrior=!1,pivot_x=-this.m_aw/2;dx=this._get_mat_dx()+pivot_x,dy=this._get_mat_dy();var link_dir=this.m_dir,b_body_mirrior=this.m_mat.m_dir_tex[this.m_dir].m_b_mirror,body_link_dir=this.m_dir;b_body_mirrior&&(body_link_dir=this.m_mat.m_dir_tex[this.m_dir].m_use_dir);var tex,mat,matf,tmp_org_pt=this.m_mat.get_link(body_link_dir,0,this.m_framecurrent);org_pt.x=b_body_mirrior?this.m_aw-tmp_org_pt.x:tmp_org_pt.x,org_pt.y=tmp_org_pt.y;for(var _b=0,_c=this.m_eff_list;_b<_c.length;_b++){_c[_b].draw2sp(this,this.m_dx,this.m_dy,!1)}if(null!=this.m_mat_backride&&this.m_mat_backride.m_b_loaded){link_dir=this.m_dir,(b_mirrior=this.m_mat_backride.m_dir_tex[this.m_dir].m_b_mirror)&&(link_dir=this.m_mat_backride.m_dir_tex[this.m_dir].m_use_dir),matf=(mat=this.m_mat_backride).m_dir_tex[this.m_dir];var pt=this.m_mat_backride.get_link(link_dir,3,this.m_framecurrent),pt1=this.m_mat_backride.get_link(link_dir,0,this.m_framecurrent);rdx=pt.x-pt1.x,b_mirrior&&(rdx=pt1.x-pt.x),rdy=pt.y-org_pt.y,drawx=b_mirrior?dx+rdx+(this.m_aw-pt.x)-org_pt.x+this.m_dx:dx+rdx+pt.x-org_pt.x+this.m_dx,drawy=dy+this.m_dy,(tex=matf.get_texture(this.m_framecurrent))&&(this.graphics.drawTexture(tex,drawx,drawy,mat.m_width,mat.m_height,matf.m_matrix),this.m_mat_backeride_rt.x=drawx+tex.offsetX,b_mirrior&&(this.m_mat_backeride_rt.x=drawx+tex.sourceWidth-tex.offsetX-tex.width),this.m_mat_backeride_rt.y=drawy+tex.offsetY,this.m_mat_backeride_rt.width=tex.width,this.m_mat_backeride_rt.height=tex.height)}if(2<=this.m_dir&&this.m_dir<=5?this.m_weapon_behind||(this.m_mat_weapon_rt=this._draw_mat(this.m_mat_weapon,3,this.m_mat_weapon_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir)):(this.m_weapon_behind&&(this.m_mat_weapon_rt=this._draw_mat(this.m_mat_weapon,3,this.m_mat_weapon_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir)),this.m_mat_wing_rt=this._draw_mat(this.m_mat_wing,1,this.m_mat_wing_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir)),(tex=(matf=(mat=this.m_mat).m_dir_tex[this.m_dir]).get_texture(this.m_framecurrent))&&(this.graphics.drawTexture(tex,dx+rdx+this.m_dx,dy+rdy+this.m_dy,mat.m_width,mat.m_height,matf.m_matrix),this.m_mat_rt.x=dx+rdx+tex.offsetX+this.m_dx,b_mirrior&&(this.m_mat_rt.x=dx+rdx+tex.sourceWidth-tex.offsetX-tex.width+this.m_dx),this.m_mat_rt.y=dy+rdy+tex.offsetY+this.m_dy,this.m_mat_rt.width=tex.width,this.m_mat_rt.height=tex.height),2<=this.m_dir&&this.m_dir<=5?(this.m_weapon_behind&&(this.m_mat_weapon_rt=this._draw_mat(this.m_mat_weapon,3,this.m_mat_weapon_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir)),this.m_mat_wing_rt=this._draw_mat(this.m_mat_wing,1,this.m_mat_wing_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir)):this.m_weapon_behind||(this.m_mat_weapon_rt=this._draw_mat(this.m_mat_weapon,3,this.m_mat_weapon_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir)),null!=this.m_mat_ride&&this.m_mat_ride.m_b_loaded){link_dir=this.m_dir,(b_mirrior=this.m_mat_ride.m_dir_tex[this.m_dir].m_b_mirror)&&(link_dir=this.m_mat_ride.m_dir_tex[this.m_dir].m_use_dir);pt=this.m_mat_ride.get_link(link_dir,3,this.m_framecurrent),pt1=this.m_mat_ride.get_link(link_dir,0,this.m_framecurrent);drawx=b_mirrior?dx+rdx+(this.m_aw-pt.x)-org_pt.x+this.m_dx:dx+rdx+pt.x-org_pt.x+this.m_dx,drawy=dy+this.m_dy,(tex=(matf=(mat=this.m_mat_ride).m_dir_tex[this.m_dir]).get_texture(this.m_framecurrent))&&(this.graphics.drawTexture(tex,drawx,drawy,mat.m_width,mat.m_height,matf.m_matrix),this.m_mat_ride_rt.x=drawx+tex.offsetX,b_mirrior&&(this.m_mat_ride_rt.x=drawy+tex.sourceWidth-tex.offsetX-tex.width),this.m_mat_ride_rt.y=drawy+tex.offsetY,this.m_mat_ride_rt.width=tex.width,this.m_mat_ride_rt.height=tex.height)}this.m_mat_hair_rt=this._draw_mat(this.m_mat_hair,2,this.m_mat_hair_rt,dx+rdx+this.m_dx,dy+rdy+this.m_dy,b_body_mirrior,body_link_dir);for(var _d=0,_e=this.m_buffeff_list;_d<_e.length;_d++){_e[_d].draw2sp(this,this.m_dx,this.m_dy,!0)}for(var _f=0,_g=this.m_eff_list;_f<_g.length;_f++){_g[_f].draw2sp(this,this.m_dx,this.m_dy,!0)}}},renderavatar_new.prototype.is_contain=function(x,y){var ret=_super.prototype.is_contain.call(this,x,y);if(ret){var rt=null;ret=!1;var rx=void 0,ry=void 0;null!=this.m_mat&&this.m_mat.m_b_loaded&&(rt=this.m_mat_rt,rx=this.x+rt.x,ry=this.y+rt.y,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0)),!ret&&null!=this.m_mat_weapon&&this.m_mat_weapon.m_b_loaded&&(rt=this.m_mat_weapon_rt,rx=this.x+rt.x,ry=this.y+rt.y,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0)),!ret&&null!=this.m_mat_wing&&this.m_mat_wing.m_b_loaded&&(rt=this.m_mat_wing_rt,rx=this.x+rt.x,ry=this.y+rt.y,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0)),!ret&&null!=this.m_mat_ride&&this.m_mat_ride.m_b_loaded&&(rt=this.m_mat_ride_rt,rx=this.x+rt.x,ry=this.y+rt.y,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&512!=rt.width&&(ret=!0)),!ret&&null!=this.m_mat_backride&&this.m_mat_backride.m_b_loaded&&(rt=this.m_mat_backeride_rt,rx=this.x+rt.x,ry=this.y+rt.y,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&512!=rt.width&&(ret=!0)),!ret&&null!=this.m_mat_hair&&this.m_mat_hair.m_b_loaded&&(rt=this.m_mat_hair_rt,rx=this.x+rt.x,ry=this.y+rt.y,rx<=x&&x<=rx+rt.width&&ry<=y&&y<=ry+rt.height&&(ret=!0))}return ret},renderavatar_new.prototype.create_default_sp=function(){null==this.m_default_sp&&(this.m_default_sp=utils.getitembycls("renderavatar_default",renderavatar_default),this.addChild(this.m_default_sp),this.m_default_sp.y=-120,this.m_default_sp.x=-26)},renderavatar_new.prototype.del_default_sp=function(){null!=this.m_default_sp&&(this.m_default_sp.removeSelf(),utils.recover("renderavatar_default",this.m_default_sp),this.m_default_sp=null)},renderavatar_new.prototype.dispose=function(){this.removeChildren(),null!=this.m_shadow_sp&&(this.m_shadow_sp=null),this.del_default_sp(),null!=this.m_sp_back&&(this.m_sp_back.removeChildren(),this.m_sp_back=null),null!=this.m_sp_front&&(this.m_sp_front.removeChildren(),this.m_sp_front=null),null!=this.m_sp_center&&(this.m_sp_center.removeChildren(),this.m_sp_center=null),0!=this.m_aura_id&&this.change_aura(0),0!=this.m_title_id&&this.change_title(0),this.m_buffeff_list=new Array,this.m_eff_list=new Array;for(var _i=0,_a=this.m_adorn_list;_i<_a.length;_i++){_a[_i].dispose()}this.m_adorn_list.length=0,this.removeChildren(),null!=this.m_name_sp&&(this.m_name_sp.dispose(),utils.recover("avatarname",this.m_name_sp),this.m_name_sp=null),this.del_hp(),this.del_buffui(),null!=this.m_mat&&(core.mat_mgr().dellavatarmaterial(this.m_mat),this.m_mat=null),null!=this.m_mat_weapon&&(core.mat_mgr().dellavatarmaterial(this.m_mat_weapon),this.m_mat_weapon=null),null!=this.m_mat_wing&&(core.mat_mgr().dellavatarmaterial(this.m_mat_wing),this.m_mat_wing=null),null!=this.m_mat_ride&&(core.mat_mgr().dellavatarmaterial(this.m_mat_ride),this.m_mat_ride=null),null!=this.m_mat_backride&&(core.mat_mgr().dellavatarmaterial(this.m_mat_backride),this.m_mat_backride=null),null!=this.m_mat_hair&&(core.mat_mgr().dellavatarmaterial(this.m_mat_hair),this.m_mat_hair=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("avatarcommand_new",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},renderavatar_new}(core.renderobject),renderavatar=function(_super){function renderavatar(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(renderavatar,_super),renderavatar}(core.renderavatar_new=renderavatar_new);core.renderavatar=renderavatar}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var rendereff=function(_super){function rendereff(){var _this=_super.call(this)||this;return _this.m_framecurrent=0,_this.m_framemillsec=0,_this.m_frametotalmillsec=0,_this.m_framecurrenttm=0,_this.m_b_loop=!0,_this.m_b_end=!1,_this.m_b_autodel=!1,_this}return __extends(rendereff,_super),rendereff.prototype.re_init=function(aniid,x,y,underunit,autodel){void 0===underunit&&(underunit=!0),void 0===autodel&&(autodel=!1),this.set_id(),this.m_aniid=aniid,this.m_rc=utils.getitembycls("effcommand",core.effcommand),this.m_rc.re_init(this),_super.prototype.set_pos.call(this,x,y),this.m_data=underunit,this.m_mat=null,this.m_aw=core.matinfo_mgr().geteffw(this.m_aniid),this.m_ah=core.matinfo_mgr().geteffh(this.m_aniid),this.m_framecount=core.matinfo_mgr().geteffframecount(this.m_aniid),this.m_framespeed=core.matinfo_mgr().geteffframespeed(this.m_aniid),this.m_b_loop=core.matinfo_mgr().geteffcycle(this.m_aniid),this.m_b_autodel=autodel,this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah)},rendereff.prototype.project=function(context){var ret=_super.prototype.project.call(this,context);return ret&&null==this.m_mat&&(this.m_mat=core.mat_mgr().geteffmat(this.m_aniid),this.addChild(this.m_mat.m_graphic)),ret},rendereff.prototype.update=function(delta){if(!this.m_b_end){if(this.m_framecurrenttm+=delta,this.m_framecurrenttm>=this.m_frametotalmillsec){if(this.m_b_autodel)return void(this.m_b_end=!0);if(0==this.m_b_loop)return void(this.m_b_end=!0)}var framecount=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=framecount%this.m_framecount,null!=this.m_mat&&this.m_mat.goto_frame(this.m_framecurrent)}},rendereff.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(core.mat_mgr().deleffmat(this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("effcommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},rendereff}(core.renderobject);core.rendereff=rendereff}(core||(core={})),function(core){var rendermap=function(){function rendermap(){this.m_bk=null,this.m_scrollbk=null,this.m_mapid=0,this.m_bk=null,this.m_scrollbk=null,this.m_slots=new Array,this.m_block=new core.rendermapblock,this.m_pathfind=new core.pathfind(null,0,0)}return rendermap.prototype.setmapid=function(mapid,b_create_slot){if(void 0===b_create_slot&&(b_create_slot=!0),core.core_tiplog("rendermap setmapid 1 ",mapid,this.m_mapid),mapid!=this.m_mapid&&(this.clear(),0!=mapid)){core.core_tiplog("rendermap setmapid 2 ",mapid,this.m_mapid),this.m_mapid=mapid,this.m_block.setmapid(this.m_mapid);var mapw=core.matinfo_mgr().getmapw(this.m_mapid),maph=core.matinfo_mgr().getmaph(this.m_mapid);if(this.m_mapw=mapw,this.m_maph=maph,b_create_slot)for(var gridw=core.matinfo_mgr().m_map_grid_w,gridh=core.matinfo_mgr().m_map_grid_h,colnum=mapw/gridw,rownum=maph/gridh,i=0;i<colnum;++i)for(var j=0;j<rownum;++j){var x=i*gridw,y=j*gridh,slot=utils.getitembycls("rendermapslot",core.rendermapslot);slot.re_init(mapid,x,y,i,j),this.m_slots.push(slot)}}},rendermap.prototype.delallslot=function(){for(var _i=0,_a=this.m_slots;_i<_a.length;_i++){var i=_a[_i];i.dispose(),utils.recover("rendermapslot",i)}this.m_slots=new Array},rendermap.prototype.clear=function(){this.clearscrollbk(),null!=this.m_bk&&(this.m_bk.dispose(),utils.recover("rendermapbk",this.m_bk),this.m_bk=null),this.delallslot(),this.m_mapid=0},rendermap.prototype.is_block=function(sx,sy){var bw=this.m_block.m_mat.m_grid_w,bh=this.m_block.m_mat.m_grid_h,ssx=Math.floor(sx/bw),ssy=Math.floor(sy/bh);return this.m_block.m_mat.is_block_cache(ssx,ssy)},rendermap.prototype.is_mask=function(sx,sy){var bw=this.m_block.m_mat.m_grid_w,bh=this.m_block.m_mat.m_grid_h,ssx=Math.floor(sx/bw),ssy=Math.floor(sy/bh);return this.m_block.m_mat.is_mask_cache(ssx,ssy)},rendermap.prototype.findpath=function(sx,sy,dx,dy,bclosest,spd){utils.get_render_milltm();var bw=this.m_block.m_mat.m_grid_w,bh=this.m_block.m_mat.m_grid_h,ssx=Math.floor(sx/bw),ssy=Math.floor(sy/bh),ddx=Math.floor(dx/bw),ddy=Math.floor(dy/bh);this.m_pathfind.set_block(this.m_block.m_mat,this.m_block.m_mat.m_block_w_num,this.m_block.m_mat.m_block_h_num);var ret=this.m_pathfind.findpath(ssx,ssy,ddx,ddy,bclosest);utils.get_render_milltm();if(null!=ret){var lastnode=null,retpath=utils.getitembycls("path",core.path);retpath.init(spd);for(var i=0;i<ret.length;++i)null==lastnode||(1==i?retpath.push_pt(sx,sy,ret[i].x*bw,ret[i].y*bh):retpath.push_pt(lastnode.x*bw,lastnode.y*bh,ret[i].x*bw,ret[i].y*bh)),lastnode=ret[i];return retpath}return null},rendermap.prototype.addscrollbk=function(res,w,h){null==this.m_scrollbk&&(this.m_scrollbk=utils.getitembycls("rendermapscrollbk",core.rendermapscrollbk),this.m_scrollbk.re_init()),this.m_scrollbk.addres(res,w,h)},rendermap.prototype.setscrollbkpos=function(x,y){null==this.m_scrollbk&&(this.m_scrollbk=utils.getitembycls("rendermapscrollbk",core.rendermapscrollbk),this.m_scrollbk.re_init()),this.m_scrollbk.setdeltapos(x,y)},rendermap.prototype.setscrollbkview=function(w,h){null==this.m_scrollbk&&(this.m_scrollbk=utils.getitembycls("rendermapscrollbk",core.rendermapscrollbk),this.m_scrollbk.re_init()),this.m_scrollbk.m_view_w=w},rendermap.prototype.setscrollbkspd=function(spd){null==this.m_scrollbk&&(this.m_scrollbk=utils.getitembycls("rendermapscrollbk",core.rendermapscrollbk),this.m_scrollbk.re_init()),this.m_scrollbk.setspd(spd)},rendermap.prototype.clearscrollbk=function(){null!=this.m_scrollbk&&(this.m_scrollbk.dispose(),utils.recover("rendermapscrollbk",this.m_scrollbk),this.m_scrollbk=null)},rendermap.prototype.setbk=function(res){null!=res?(null==this.m_bk&&(this.m_bk=utils.getitembycls("rendermapbk",core.rendermapbk),this.m_bk.re_init()),this.m_bk.setres(res)):null!=this.m_bk&&(this.m_bk.dispose(),utils.recover("rendermapbk",this.m_bk),this.m_bk=null)},rendermap.prototype.setsp=function(sp){null==this.m_bk&&(this.m_bk=utils.getitembycls("rendermapbk",core.rendermapbk),this.m_bk.re_init()),this.m_bk.setsp(sp)},rendermap.prototype.removesp=function(){null!=this.m_bk&&this.m_bk.clearsp()},rendermap.prototype.dispose=function(){this.clear(),null!=this.m_block&&(this.m_block.dispose(),this.m_block=null)},rendermap.prototype.update=function(delta){null!=this.m_scrollbk&&this.m_scrollbk.update(delta)},rendermap.prototype.project=function(context){var ret=!1;null!=this.m_scrollbk&&(ret=this.m_scrollbk.project(context)||ret),null!=this.m_bk&&(ret=this.m_bk.project(context)||ret),this.m_block;for(var _i=0,_a=this.m_slots;_i<_a.length;_i++){ret=_a[_i].project(context)||ret,0}return ret},rendermap}();core.rendermap=rendermap}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var rendermapbk=function(_super){function rendermapbk(){var _this=_super.call(this)||this;return _this.re_init(),_this}return __extends(rendermapbk,_super),rendermapbk.prototype.re_init=function(){this.m_mat=null,this.m_rc=utils.getitembycls("mapbkcommand",core.mapbkcommand),this.m_rc.re_init(this)},rendermapbk.prototype.setres=function(res){null!=this.m_mat&&core.mat_mgr().delmapbkres(this.m_mat),this.m_mat=core.mat_mgr().getmapbkres(res),this.removeChildren(),this.addChild(this.m_mat.m_graphic)},rendermapbk.prototype.setsp=function(sp){this.addChild(sp)},rendermapbk.prototype.clearsp=function(){this.removeChildren()},rendermapbk.prototype.project=function(context){return context.m_render.addrc(this.m_rc),!0},rendermapbk.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(core.mat_mgr().delmapbkres(this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapbkcommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},rendermapbk}(core.renderobject);core.rendermapbk=rendermapbk}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var rendermapblock=function(_super){function rendermapblock(){var _this=_super.call(this)||this;return _this.re_init(),_this}return __extends(rendermapblock,_super),rendermapblock.prototype.re_init=function(){this.m_mat=utils.getitembycls("mapblock",core.mapblock),this.m_mat.re_init(),this.addChild(this.m_mat.m_graphic),this.m_rc=utils.getitembycls("mapblockcommand",core.mapblockcommand),this.m_rc.re_init(this)},rendermapblock.prototype.setmapid=function(mapid){core.mat_mgr().getmapblock(this.m_mat,mapid)},rendermapblock.prototype.project=function(context){return null!=this.m_mat&&0==this.m_mat.m_init_sp&&this.m_mat.get_block_sp(),context.m_render.addrc(this.m_rc),!0},rendermapblock.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(this.m_mat.dispose(),utils.recover("mapblock",this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapblockcommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},rendermapblock}(core.renderobject);core.rendermapblock=rendermapblock}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var scrollbkslot=function(_super){function scrollbkslot(){var _this=_super.call(this)||this;return _this.m_mat=null,_this.m_mat_res="",_this.m_w=0,_this.m_h=0,_this.m_drawx=0,_this.m_drawy=0,_this.m_view_w=0,_this.m_b_draw=!1,_this}return __extends(scrollbkslot,_super),scrollbkslot.prototype.set_pos=function(x,y){this.m_drawx=x,this.m_drawy=y,this.x=this.m_drawx,this.y=this.m_drawy,this.removeChildren(),this.m_drawx>=-this.m_w&&this.m_drawx<=this.m_view_w?(this.m_b_draw=!0,this.addChild(this.m_mat.m_graphic)):this.m_b_draw=!1},scrollbkslot.prototype.re_init=function(respath){this.m_mat=core.mat_mgr().getmapbkres(respath),this.m_mat_res=respath,this.m_w=0,this.m_h=0,this.m_drawx=0,this.m_drawy=0,this.m_view_w=0,this.m_b_draw=!1,this.x=0,this.y=0,this.removeChildren()},scrollbkslot.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(core.mat_mgr().delmapbkres(this.m_mat),this.m_mat=null)},scrollbkslot}(Laya.Sprite);core.scrollbkslot=scrollbkslot;var rendermapscrollbk=function(_super){function rendermapscrollbk(){var _this=_super.call(this)||this;return _this.m_mat_list=new Array,_this.m_tmpmat_list=new Array,_this.m_dx=0,_this.m_dy=0,_this.m_spd=200,_this.m_view_w=0,_this.re_init(),_this}return __extends(rendermapscrollbk,_super),rendermapscrollbk.prototype.re_init=function(){this.m_mat_list.length=0,this.m_dx=0,this.m_dy=0,this.x=0,this.y=0,this.m_spd=200,this.m_rc=utils.getitembycls("mapscrollbkcommand",core.mapscrollbkcommand),this.m_rc.re_init(this)},rendermapscrollbk.prototype.setdeltapos=function(x,y){this.m_dx=x,this.m_dy=y,this.x=x,this.y=y},rendermapscrollbk.prototype.setspd=function(spd){this.m_spd=spd},rendermapscrollbk.prototype.addres=function(res,w,h){var mat=utils.getitembycls("scrollbkslot",scrollbkslot);if(mat.re_init(res),mat.m_view_w=this.m_view_w,mat.m_w=w,mat.m_h=h,this.m_mat_list.length<=0)mat.set_pos(0,0);else{var pre_mat=this.m_mat_list[this.m_mat_list.length-1];mat.set_pos(pre_mat.m_drawx+pre_mat.m_w,0)}this.m_mat_list.push(mat),this.addChild(mat)},rendermapscrollbk.prototype.update=function(delta){this.m_tmpmat_list.length=0;for(var dx=delta/1e3*this.m_spd,mat=null,i=this.m_mat_list.length-1;0<=i;--i){var drawx=(mat=this.m_mat_list[i]).m_drawx-dx;drawx<-mat.m_w?(this.m_tmpmat_list.push(mat),this.m_mat_list.splice(i,1)):mat.set_pos(drawx,0)}if(0<this.m_tmpmat_list.length){this.m_tmpmat_list.reverse();var startx=0;0<this.m_mat_list.length&&(startx=(mat=this.m_mat_list[this.m_mat_list.length-1]).m_drawx+mat.m_w);for(var _i=0,_a=this.m_tmpmat_list;_i<_a.length;_i++){i=_a[_i];this.m_mat_list.push(i),i.set_pos(startx,0),startx+=i.m_w}this.m_tmpmat_list.length=0}},rendermapscrollbk.prototype.clearRes=function(){this.removeChildren();for(var _i=0,_a=this.m_mat_list;_i<_a.length;_i++){var i=_a[_i];i.dispose(),utils.recover("scrollbkslot",i)}this.m_mat_list.length=0},rendermapscrollbk.prototype.project=function(context){return context.m_render.addrc(this.m_rc),!0},rendermapscrollbk.prototype.dispose=function(){this.clearRes(),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapscrollbkcommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},rendermapscrollbk}(core.renderobject);core.rendermapscrollbk=rendermapscrollbk}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var rendermapslot=function(_super){function rendermapslot(){return _super.call(this)||this}return __extends(rendermapslot,_super),rendermapslot.prototype.re_init=function(mapid,x,y,colnum,rownum){this.set_id(),this.m_mapid=mapid,this.m_rc=utils.getitembycls("mapslotcommand",core.mapslotcommand),this.m_rc.re_init(this),_super.prototype.set_pos.call(this,x,y),this.m_colnum=colnum,this.m_rownum=rownum,this.m_mat=null,this.m_box.setTo(this.x,this.y,core.matinfo_mgr().m_map_grid_w,core.matinfo_mgr().m_map_grid_h)},rendermapslot.prototype.project=function(context){var ret=_super.prototype.project.call(this,context);return ret&&(null==this.m_mat&&(this.m_mat=core.mat_mgr().getmapslot(this.m_mapid,this.m_rownum,this.m_colnum)),this.addChild(this.m_mat.m_graphic)),ret},rendermapslot.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapslotcommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},rendermapslot}(core.renderobject);core.rendermapslot=rendermapslot}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var renderspcontent=function(_super){function renderspcontent(){var _this=_super.call(this)||this;return _this.m_w=0,_this.m_h=0,_this}return __extends(renderspcontent,_super),renderspcontent.prototype.update=function(delta){},renderspcontent.prototype.dispose=function(){},renderspcontent.prototype.selfremove=function(){},renderspcontent}(laya.display.Sprite);core.renderspcontent=renderspcontent}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var rendersprite=function(_super){function rendersprite(){var _this=_super.call(this)||this;return _this.m_sprite=null,_this.m_b_upon_unit=!0,_this}return __extends(rendersprite,_super),rendersprite.prototype.re_init=function(sp,x,y,b_upon){void 0===b_upon&&(b_upon=!0),this.set_id(),this.m_b_upon_unit=b_upon,this.m_sprite=sp,this.removeChildren(),null!=this.m_sprite&&this.addChild(this.m_sprite),this.m_rc=utils.getitembycls("spritecommand",core.spritecommand),this.m_rc.re_init(this),_super.prototype.set_pos.call(this,x,y),this.m_box.setTo(this.x-sp.m_w/2,this.y-sp.m_h/2,sp.m_w,sp.m_h)},rendersprite.prototype.project=function(context){return _super.prototype.project.call(this,context)},rendersprite.prototype.update=function(delta){null!=this.m_sprite&&this.m_sprite.update(delta)},rendersprite.prototype.dispose=function(){this.removeChildren(),null!=this.m_sprite&&this.m_sprite.selfremove(),(this.m_sprite=null)!=this.m_rc&&(this.m_rc.dispose(),utils.recover("spritecommand",this.m_rc),this.m_rc=null),_super.prototype.dispose.call(this)},rendersprite}(core.renderobject);core.rendersprite=rendersprite}(core||(core={})),function(core){var path=function(){function path(spd){this.m_nodes=null,this.m_dir_count=8,this.m_speed=300,this.m_ret_node=null,this.m_unit_id=0,this.m_force_dir=-1,this.m_nodes=new Array,this.init(spd)}return path.prototype.init=function(spd){this.m_speed=spd,this.m_ret_node=utils.getitembycls("pathnode",core.pathnode),this.m_ret_node.init(0,0,0,0),this.m_force_dir=-1},path.prototype.push_pt=function(sx,sy,dx,dy){var node=utils.getitembycls("pathnode",core.pathnode);node.init(sx,sy,dx,dy,this.m_dir_count),node.cal_total_tm(this.m_speed);var tm=0;if(0<this.m_nodes.length){var last=this.m_nodes[this.m_nodes.length-1];tm=last.m_start_tm+last.m_total_tm}else this.m_ret_node.x=node.x,this.m_ret_node.y=node.y,this.m_ret_node.m_dir=node.m_dir;node.m_start_tm=tm,this.m_nodes.push(node)},path.prototype.start=function(){this.m_cur_tm=0,this.m_cur_node_idx=0},path.prototype.update=function(delta){if(!(this.m_nodes.length<=0))for(this.m_cur_tm+=delta;this.m_cur_node_idx<this.m_nodes.length;){var node=this.m_nodes[this.m_cur_node_idx];if(!(this.m_cur_tm>=node.m_start_tm+node.m_total_tm))break;this.m_cur_node_idx++}},path.prototype.get_end=function(){return this.m_nodes[this.m_nodes.length-1].m_end_pt},path.prototype.is_end=function(){return this.m_cur_node_idx>=this.m_nodes.length},path.prototype.get_cur_pt=function(){var idx=this.m_cur_node_idx<this.m_nodes.length?this.m_cur_node_idx:this.m_nodes.length-1,cur_node=this.m_nodes[idx].get_pos(this.m_cur_tm);return this.m_ret_node.x=cur_node.x,this.m_ret_node.y=cur_node.y,this.m_ret_node.m_dir=this.m_nodes[idx].m_dir,0<=this.m_force_dir&&(this.m_ret_node.m_dir=this.m_force_dir),this.m_ret_node},path.prototype.dispose=function(){for(var _i=0,_a=this.m_nodes;_i<_a.length;_i++){var i=_a[_i];utils.recover("pathnode",i)}this.m_nodes.length=0,utils.recover("pathnode",this.m_ret_node),this.m_ret_node=null},path}();core.path=path}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var pathfindnode=function(_super){function pathfindnode(x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this,x,y)||this;return _this.m_g=0,_this.m_h=0,_this.m_f=0,_this.m_key=0,_this.m_parent_x=0,_this.m_parent_y=0,_this.m_key=pathfindnode._genkey(x,y),_this}return __extends(pathfindnode,_super),pathfindnode._genkey=function(x,y){return 1e4*x+y},pathfindnode.prototype.init=function(x,y){this.setTo(x,y),this.m_key=pathfindnode._genkey(x,y)},pathfindnode.prototype.calc=function(dx,dy){this.m_h=Math.sqrt(Math.abs((dx-this.x)*(dx-this.x))+Math.abs((dy-this.y)*(dy-this.y))),this.m_f=this.m_g+this.m_h},pathfindnode}(laya.maths.Point);core.pathfindnode=pathfindnode;var pathfind=function(){function pathfind(mb,w,h){this.m_g_h=10,this.m_g_c=14,this.m_map_block_ref=null,this.m_block_w_num=0,this.m_block_h_num=0,this.m_open_heap=new utils.small_heap,this.m_open_flag=new Object,this.m_close_flag=new Object,this.m_map_block_ref=mb,this.m_block_w_num=w,this.m_block_h_num=h}return pathfind.prototype.set_block=function(mb,w,h){this.m_map_block_ref=mb,this.m_block_w_num=w,this.m_block_h_num=h},pathfind.prototype._get_pfd=function(x,y){var ret=utils.getitembycls("pathfindnode",pathfindnode);return ret.init(x,y),ret},pathfind.prototype._del_pfd=function(nd){utils.recover("pathfindnode",nd)},pathfind.prototype._clear_pfd_cache=function(){utils.clearbysign("pathfindnode")},pathfind.prototype._clear_openclose_flag=function(){for(var key in this.m_open_flag){if(this.m_open_flag.hasOwnProperty(key))null!=(tmp=this.m_open_flag[key])&&null!=tmp&&this._del_pfd(tmp)}for(var key in this.m_open_flag=new Object,this.m_close_flag){var tmp;if(this.m_close_flag.hasOwnProperty(key))null!=(tmp=this.m_close_flag[key])&&null!=tmp&&this._del_pfd(tmp)}this.m_close_flag=new Object},pathfind.prototype._add_node=function(x,y,cx,cy,cur_g,dx,dy){var nd_key,hp_idx,pfn,node;if(nd_key=pathfindnode._genkey(cx,cy),null==this.m_close_flag[nd_key])if(null!=this.m_open_flag[nd_key])cur_g<(pfn=this.m_open_flag[nd_key]).m_g&&(pfn.m_g=cur_g,pfn.m_f=pfn.m_g+pfn.m_h,pfn.m_parent_x=x,pfn.m_parent_y=y,hp_idx=this.m_open_heap.get_idx(pfn.m_key),this.m_open_heap.modify(hp_idx,pfn.m_f));else if(0==this.m_map_block_ref.is_block_cache(cx,cy)){if((node=this._get_pfd(cx,cy)).m_parent_x=x,node.m_parent_y=y,cx==dx&&cy==dy)return this.m_close_flag[node.m_key]=node,!0;node.m_g=cur_g,node.calc(dx,dy),this.m_open_heap.push(node.m_h,node.m_key),this.m_open_flag[node.m_key]=node}return!1},pathfind.prototype.findpath=function(sx,sy,dx,dy,bclostest){if(sx==dx&&sy==dy)return core.core_tiplog("pathfind findpath sx=dx sy=dy return null",sx,sy,dx,dy),null;if(this.m_map_block_ref.is_block_cache(sx,sy))return core.core_tiplog("pathfind findpath sx sy is in block return null",sx,sy,dx,dy),null;var i,gridline=utils.genpointlinefrom2point(sx,sy,dx,dy,this.m_map_block_ref.m_grid_w,this.m_map_block_ref.m_grid_h);if(null==gridline||gridline.length<=0)return core.core_tiplog("pathfind gen first line failed return null",sx,sy,dx,dy),null;var pt,line_count=gridline.length;if(this.m_map_block_ref.is_block_cache(dx,dy)){if(0==bclostest)return core.core_tiplog("pathfind findpath dx dy is in block and bclosest = false return null",sx,sy,dx,dy),null;for(i=0;i<line_count&&(pt=gridline[line_count-i-1],this.m_map_block_ref.is_block_cache(pt.x,pt.y));++i)gridline.splice(line_count-i-1,1);if(gridline.length<=1)return core.core_tiplog("pathfind findpath firstline only have 1 point return null",sx,sy,dx,dy),null;dx=gridline[gridline.length-1].x,dy=gridline[gridline.length-1].y,core.core_tiplog("pathfind findpath get substitution of dest ",dx,dy)}if(line_count=gridline.length,0==this.has_ptline_block(gridline)){var ret=new Array;return ret.push(new laya.maths.Point(sx,sy)),ret.push(new laya.maths.Point(dx,dy)),core.core_tiplog("pathfind findpath dx dy can get directly return true",sx,sy,dx,dy),ret}core.core_tiplog("pathfind findpath dx dy can not get directly ",sx,sy,dx,dy,gridline.length,gridline);var bfind=!1;this.m_open_heap.clear(),this._clear_openclose_flag();var node=this._get_pfd(sx,sy);for(node.m_g=0,node.calc(dx,dy),node.m_parent_x=-1,node.m_parent_y=-1,this.m_open_heap.push(node.m_h,node.m_key),this.m_open_flag[node.m_key]=node;!this.m_open_heap.is_empty();){var curnode_id=this.m_open_heap.top().m_user_id;this.m_open_heap.pop();var pfn=this.m_open_flag[curnode_id];if(this.m_close_flag[pfn.m_key]=pfn,this.m_open_flag[pfn.m_key]=void 0,bfind=this._add_node(pfn.x,pfn.y,pfn.x+1,pfn.y,pfn.m_g+this.m_g_h,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x-1,pfn.y,pfn.m_g+this.m_g_h,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x,pfn.y+1,pfn.m_g+this.m_g_h,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x,pfn.y-1,pfn.m_g+this.m_g_h,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x+1,pfn.y+1,pfn.m_g+this.m_g_c,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x+1,pfn.y-1,pfn.m_g+this.m_g_c,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x-1,pfn.y+1,pfn.m_g+this.m_g_c,dx,dy))break;if(bfind=this._add_node(pfn.x,pfn.y,pfn.x-1,pfn.y-1,pfn.m_g+this.m_g_c,dx,dy))break}if(0==bfind)return core.core_tiplog("pathfind findpath failed return null",sx,sy,dx,dy),null;for(var dst_node_key=pathfindnode._genkey(dx,dy),tmp_path=Array();;){var dst_node=this.m_close_flag[dst_node_key];if(-1==dst_node.m_parent_x&&-1==dst_node.m_parent_y){tmp_path.push(new laya.maths.Point(dst_node.x,dst_node.y));break}tmp_path.push(new laya.maths.Point(dst_node.x,dst_node.y)),dst_node_key=pathfindnode._genkey(dst_node.m_parent_x,dst_node.m_parent_y)}if(tmp_path.reverse(),2<(line_count=tmp_path.length))for(var start=0,mid=1,end=2;;){var a=tmp_path[start],b=tmp_path[mid],c=tmp_path[end],bdel=!1;if(b.x==a.x&&c.x==b.x?bdel=!0:b.y==a.y&&c.y==b.y?bdel=!0:b.x-a.x==c.x-b.x&&b.y-a.y==c.y-b.y&&(bdel=!0),bdel?(tmp_path.splice(mid,1),end=(mid=start+1)+1):end=(mid=(start=mid)+1)+1,end>=tmp_path.length)break}3<(line_count=tmp_path.length)&&(tmp_path=this.delsurpluspoint(tmp_path));return core.core_tiplog("pathfind findpath normal end return true ",sx,sy,dx,dy,tmp_path),tmp_path},pathfind.prototype.has_ptline_block=function(pt_line){for(var line_count=pt_line.length,i=0;i<line_count;++i){var pt=pt_line[i];if(this.m_map_block_ref.is_block_cache(pt.x,pt.y))return!0}return!1},pathfind.prototype.delsurpluspoint=function(path){if(path.length<3)return path;var ret=new Array,min=0,max=0,start=new laya.maths.Point;start.x=path[0].x,start.y=path[0].y,path.splice(0,1),min=0,max=path.length-1;for(var b_continue=!0;b_continue;){if(path.length<=1){ret.push(start),0<path.length&&ret.push(new laya.maths.Point(path[0].x,path[0].y)),b_continue=!1;break}var cur=min+max>>1,curpt=path[cur];if(this.has_block_between_2pt(start.x,start.y,curpt.x,curpt.y))(max=cur)==min&&(ret.push(start),(start=new laya.maths.Point).x=path[min].x,start.y=path[min].y,0==min&&(min=1),path.splice(0,min),min=0,max=path.length-1);else{if(0==cur){var tmp=path[cur+1];this.has_block_between_2pt(start.x,start.y,tmp.x,tmp.y)&&(ret.push(start),(start=new laya.maths.Point).x=path[cur].x,start.y=path[cur].y),path.splice(0,1)}else path.splice(0,cur);min=0,max=path.length-1}}return ret},pathfind.prototype.has_block_between_2pt=function(sx,sy,dx,dy){var gridline=utils.genpointlinefrom2point(sx,sy,dx,dy,this.m_map_block_ref.m_grid_w,this.m_map_block_ref.m_grid_h);return null==gridline||gridline.length<=0||this.has_ptline_block(gridline)},pathfind.prototype.dispose=function(){this._clear_openclose_flag()},pathfind}();core.pathfind=pathfind}(core||(core={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var pathnode=function(_super){function pathnode(sx,sy,dx,dy,dircount){void 0===dircount&&(dircount=8);var _this=_super.call(this)||this;return _this.m_end_pt=null,_this.m_start_tm=0,_this.m_total_tm=0,_this.m_dir=0,_this.m_cur_pt=null,_this.m_dir_count=8,_this.m_angle=0,_this.m_dx=0,_this.m_dy=0,_this.m_dx_idis=0,_this.m_dy_idis=0,_this.m_idis_sec=1e3,_this.m_idis_millsec=1e6,_this.m_end_pt=new laya.maths.Point,_this.m_cur_pt=new laya.maths.Point,_this.init(sx,sy,dx,dy,dircount),_this}return __extends(pathnode,_super),pathnode.prototype.init=function(sx,sy,dx,dy,dircount){void 0===dircount&&(dircount=8),this.x=sx,this.y=sy,this.m_end_pt.setTo(dx,dy),this.m_dx=dx-sx,this.m_dy=dy-sy,this.m_angle=utils.genangle(this.m_dx,this.m_dy),this.m_dir=utils.gendir(this.m_dx,this.m_dy,this.m_dir_count,this.m_angle)},pathnode.prototype.cal_total_tm=function(speed){var adx=Math.abs(this.m_dx),ady=Math.abs(this.m_dy),totaldis=Math.sqrt(adx*adx+ady*ady);this.m_total_tm=1e3*totaldis/speed},pathnode.prototype.is_end=function(tm){return tm-this.m_start_tm>=this.m_total_tm},pathnode.prototype.get_pos=function(tm){var delta=tm-this.m_start_tm;return delta<=0?(this.m_cur_pt.x=this.x,this.m_cur_pt.y=this.y):delta>=this.m_total_tm?(this.m_cur_pt.x=this.m_end_pt.x,this.m_cur_pt.y=this.m_end_pt.y):(this.m_cur_pt.x=this.x+delta*this.m_dx/this.m_total_tm,this.m_cur_pt.y=this.y+delta*this.m_dy/this.m_total_tm),this.m_cur_pt},pathnode.prototype.dispose=function(){},pathnode}(laya.maths.Point);core.pathnode=pathnode}(core||(core={})),function(utils){utils.getitembycls=function(sign,cls){return Laya.Pool.getItemByClass(sign,cls)},utils.recover=function(sign,item){return Laya.Pool.recover(sign,item)},utils.clearbysign=function(sign){Laya.Pool.clearBySign(sign)}}(utils||(utils={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var rendercamera=function(_super){function rendercamera(){var _this=_super.call(this)||this;return _this.m_tween=null,_this.m_dst=new laya.maths.Point,_this.m_viewport=new laya.maths.Rectangle,_this}return __extends(rendercamera,_super),rendercamera.prototype.dispose=function(){},rendercamera.prototype.update=function(delta){},rendercamera.prototype.project=function(context){this.m_viewport.setTo(this.x-(this.width>>1),this.y-(this.height>>1),this.width,this.height)},rendercamera.prototype.is_project=function(rt){return this.m_viewport.intersects(rt)},rendercamera.prototype.set_pos=function(dx,dy,force){void 0===force&&(force=!0),this.m_dst.x==dx&&this.m_dst.y==dy||(this.m_dst.setTo(dx,dy),null!=this.m_tween&&(laya.utils.Tween.clear(this.m_tween),this.m_tween=null),force?this.setTo(dx,dy,this.width,this.height):laya.utils.Tween.to(this,{x:dx,y:dy},500,Laya.Ease.cubicOut,null,0,!0,!0))},rendercamera}(laya.maths.Rectangle);core.rendercamera=rendercamera}(core||(core={})),function(core){var rendercontext=function(){function rendercontext(){this.m_walk_speed=300,this.m_run_speed=8e3}return rendercontext.prototype.get_move_spd=function(b_run){return b_run?this.m_run_speed:this.m_walk_speed},rendercontext.prototype.dispose=function(){this.m_render=null,this.m_camera=null,this.m_view=null},rendercontext}();core.rendercontext=rendercontext}(core||(core={})),function(core){function render_sort(a,b){return a.m_screen_z-b.m_screen_z}var renderimpl=function(){function renderimpl(){this.m_eye=null,this.m_eye_tm=0,this.m_camera=new core.rendercamera,this.m_view=new core.renderview,this.m_scene=new core.renderscene,this.m_renderrcs=new Array,this.m_context=new core.rendercontext,this.m_context.m_camera=this.m_camera,(this.m_context.m_render=this).m_context.m_view=this.m_view,this.m_world_rect=new laya.maths.Rectangle}return renderimpl.prototype.initstage=function(sp){this.m_view.removeSelf(),sp.addChild(this.m_view)},renderimpl.prototype.setworldwh=function(w,h){this.m_world_rect.setTo(0,0,w,h)},renderimpl.prototype.getworldw=function(){return this.m_world_rect.width},renderimpl.prototype.getworldh=function(){return this.m_world_rect.height},renderimpl.prototype.set_eye=function(unit){this.m_eye=unit},renderimpl.prototype._get_renderavatar_ins=function(shape,x,y,use_default){void 0===use_default&&(use_default=!0);var ret=utils.getitembycls("renderavatar",core.renderavatar);return ret.re_init(shape,x,y,use_default),ret},renderimpl.prototype._del_renderavatar_ins=function(ins){ins.dispose(),utils.recover("renderavatar",ins)},renderimpl.prototype._get_rendereff_ins=function(aniid,x,y,underunit,autodel){var ret=utils.getitembycls("rendereff",core.rendereff);return ret.re_init(aniid,x,y,underunit,autodel),ret},renderimpl.prototype._del_rendereff_ins=function(ins){ins.dispose(),utils.recover("rendereff",ins)},renderimpl.prototype._get_renderani_ins=function(aniid,x,y,underunit){var ret=utils.getitembycls("renderani",core.renderani);return ret.re_init(aniid,x,y,underunit),ret},renderimpl.prototype._del_renderani_ins=function(ins){ins.dispose(),utils.recover("renderani",ins)},renderimpl.prototype._get_rendersprite_ins=function(sp,x,y,b_unit_front){void 0===b_unit_front&&(b_unit_front=!0);var ret=utils.getitembycls("rendersprite",core.rendersprite);return ret.re_init(sp,x,y,b_unit_front),ret},renderimpl.prototype._del_rendersprite_ins=function(ins){ins.dispose(),utils.recover("rendersprite",ins)},renderimpl.prototype.update_camera_pos=function(delta){null!=this.m_eye&&(this.m_eye_tm+=delta,0<this.m_eye_tm&&(this.m_eye_tm=0,this.setcamerapos(this.m_eye.x,this.m_eye.y,!0)))},renderimpl.prototype.setcamerapos=function(x,y,force){void 0===force&&(force=!0);var min_x=0,max_x=0,min_y=0,max_y=0;this.getviewportw()>=this.getworldw()?x=this.getworldw()>>1:(x<(min_x=this.getviewportw()>>1)&&(x=min_x),(max_x=this.getworldw()-(this.getviewportw()>>1))<x&&(x=max_x)),this.getviewporth()>=this.getworldh()?y=this.getworldh()>>1:(y<(min_y=this.getviewporth()>>1)&&(y=min_y),(max_y=this.getworldh()-(this.getviewporth()>>1))<y&&(y=max_y)),this.m_camera.set_pos(x,y,force)},renderimpl.prototype.setviewport=function(w,h){this.m_camera.setTo(this.m_camera.x,this.m_camera.y,w,h)},renderimpl.prototype.getviewportw=function(){return this.m_camera.width},renderimpl.prototype.getviewporth=function(){return this.m_camera.height},renderimpl.prototype.dispose=function(){(this.m_renderrcs=null)!=this.m_scene&&(this.m_scene.dispose(),this.m_scene=null),null!=this.m_context&&(this.m_context.dispose(),this.m_context=null),null!=this.m_camera&&(this.m_camera.dispose(),this.m_camera=null),null!=this.m_view&&(this.m_view.removeSelf(),this.m_view.dispose(),this.m_view=null)},renderimpl.prototype.addrc=function(rc){this.m_renderrcs.push(rc)},renderimpl.prototype.update=function(delta){this.update_camera_pos(delta),this.m_camera.update(delta),this.m_scene.update(delta),this.m_view.update(delta)},renderimpl.prototype.render=function(){this.m_renderrcs.length=0,this.m_camera.project(this.m_context),this.m_view.project(this.m_context),this.m_scene.project(this.m_context),this.m_renderrcs.sort(render_sort),this.m_view.renderbefore();for(var _i=0,_a=this.m_renderrcs;_i<_a.length;_i++){_a[_i].render(this.m_context)}this.m_view.renderafter()},renderimpl.prototype.check_click=function(x,y){for(var i=this.m_renderrcs.length-1;0<i;--i)if(this.m_renderrcs[i].is_contain(x,y))return this.m_renderrcs[i].m_obj.m_obj_id;return 0},renderimpl}();core.renderimpl=renderimpl}(core||(core={})),function(core){var renderscene=function(){function renderscene(){this.m_units=new Array,this.m_units_dict=new Object,this.m_anis=new Array,this.m_effs=new Array,this.m_tempeffs=new Array,this.m_sprites=new Array,this.m_map=new core.rendermap,this.m_unitpath=new Array,this.m_follow_list=new Object}return renderscene.prototype.findpath=function(sx,sy,dx,dy,bclosest,spd){return this.m_map.findpath(sx,sy,dx,dy,bclosest,spd)},renderscene.prototype.addpath=function(unit_path,unit_id){this.delpath(unit_id),null!=this.getunit(unit_id)&&(unit_path.m_unit_id=unit_id,this.m_unitpath.push(unit_path))},renderscene.prototype.get_unitpath=function(unit_id){for(var _i=0,_a=this.m_unitpath;_i<_a.length;_i++){var i=_a[_i];if(i.m_unit_id==unit_id)return i}return null},renderscene.prototype.delpath=function(unit_id){for(var i=0;i<this.m_unitpath.length;++i){var unitpath=this.m_unitpath[i];if(unitpath.m_unit_id==unit_id)return unitpath.dispose(),this.m_unitpath.splice(i,1),utils.recover("path",unitpath),unitpath}return null},renderscene.prototype.addunit=function(name,unit){return unit.set_name(name),this.m_units.push(unit),(this.m_units_dict[unit.m_obj_id]=unit).m_obj_id},renderscene.prototype.delunit=function(id){for(var i=0;i<this.m_units.length;++i){var unit=this.m_units[i];if(unit.m_obj_id==id)return delete this.m_units_dict[id],this.delpath(id),unit.dispose(),this.m_units.splice(i,1),unit}return null},renderscene.prototype.getunitbyud=function(ud){for(var i=0;i<this.m_units.length;++i){var unit=this.m_units[i];if(unit.m_user_data==ud)return unit}return null},renderscene.prototype.getunit=function(id){var obj=this.m_units_dict[id];return null!=obj?obj:null},renderscene.prototype.setunit_pos=function(id,x,y){var obj=this.getunit(id);null!=obj&&obj.set_pos(x,y)},renderscene.prototype.setunit_dir=function(id,dir){var obj=this.getunit(id);null!=obj&&obj.change_dir(dir)},renderscene.prototype.setunit_action=function(id,action_id){var obj=this.getunit(id);null!=obj&&obj.change_action(action_id)},renderscene.prototype.clear=function(){},renderscene.prototype.dispose=function(){if(null!=this.m_sprites){for(var _i=0,_a=this.m_sprites;_i<_a.length;_i++){_a[_i].dispose()}this.m_sprites=null}if(null!=this.m_anis){for(var _b=0,_c=this.m_anis;_b<_c.length;_b++){_c[_b].dispose()}this.m_anis=null}if(null!=this.m_effs){for(var _d=0,_e=this.m_effs;_d<_e.length;_d++){_e[_d].dispose()}this.m_effs=null}if(null!=this.m_units){for(var _f=0,_g=this.m_units;_f<_g.length;_f++){_g[_f].dispose()}this.m_units=null}(this.m_units_dict=null)!=this.m_map&&(this.m_map.dispose(),this.m_map=null),this.m_unitpath=null,this.m_follow_list=null},renderscene.prototype.update=function(delta){this.m_map.update(delta);for(var _i=0,_a=this.m_units;_i<_a.length;_i++){(i=_a[_i]).update(delta)}for(var _b=0,_c=this.m_anis;_b<_c.length;_b++){(i=_c[_b]).update(delta)}this.m_tempeffs=new Array;for(var _d=0,_e=this.m_effs;_d<_e.length;_d++){(i=_e[_d]).m_b_end&&i.m_b_autodel?i.dispose():(i.update(delta),this.m_tempeffs.push(i))}this.m_effs=this.m_tempeffs;for(var i=this.m_unitpath.length-1;0<=i;--i){var unitpath=this.m_unitpath[i];unitpath.update(delta);var cur_node=unitpath.get_cur_pt();this.setunit_pos(unitpath.m_unit_id,cur_node.x,cur_node.y),this.setunit_dir(unitpath.m_unit_id,cur_node.m_dir),unitpath.is_end()&&(this.setunit_action(unitpath.m_unit_id,0),unitpath.dispose(),this.m_unitpath.splice(i,1))}},renderscene.prototype.project=function(context){this.m_map.project(context);for(var _i=0,_a=this.m_units;_i<_a.length;_i++){_a[_i].project(context)}for(var _b=0,_c=this.m_anis;_b<_c.length;_b++){_c[_b].project(context)}for(var _d=0,_e=this.m_sprites;_d<_e.length;_d++){_e[_d].project(context)}for(var _f=0,_g=this.m_effs;_f<_g.length;_f++){_g[_f].project(context)}},renderscene}();core.renderscene=renderscene}(core||(core={}));var core;__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(core){var renderview=function(_super){function renderview(){var _this=_super.call(this)||this;return _this.m_mapView=new laya.display.Sprite,_this.addChild(_this.m_mapView),_this.m_map_mask=new Laya.Sprite,_this.m_map_mask.graphics.drawRect(0,0,3e3,3e3,"#000000"),_this.m_map_mask.alpha=.3,_this.m_screeneffect_view=new Laya.Sprite,_this.addChild(_this.m_screeneffect_view),_this.m_ani_underunit_View=new laya.display.Sprite,_this.addChild(_this.m_ani_underunit_View),_this.m_unitshadow_View=new Laya.Sprite,_this.addChild(_this.m_unitshadow_View),_this.m_unitname_View=new Laya.Sprite,_this.addChild(_this.m_unitname_View),_this.m_unitground_View=new Laya.Sprite,_this.addChild(_this.m_unitground_View),_this.m_unitView=new laya.display.Sprite,_this.addChild(_this.m_unitView),_this.m_unitfront_View=new Laya.Sprite,_this.addChild(_this.m_unitfront_View),_this.m_ani_uponunit_view=new laya.display.Sprite,_this.addChild(_this.m_ani_uponunit_view),_this}return __extends(renderview,_super),renderview.prototype.renderbefore=function(){this.m_mapView.graphics.clear(),this.m_mapView.removeChildren(),this.m_ani_underunit_View.graphics.clear(),this.m_ani_underunit_View.removeChildren(),this.m_unitshadow_View.removeChildren(),this.m_unitshadow_View.graphics.clear(),this.m_unitname_View.removeChildren(),this.m_unitname_View.graphics.clear(),this.m_unitground_View.graphics.clear(),this.m_unitground_View.removeChildren(),this.m_unitView.graphics.clear(),this.m_unitView.removeChildren(),this.m_unitfront_View.graphics.clear(),this.m_unitfront_View.removeChildren(),this.m_ani_uponunit_view.graphics.clear(),this.m_ani_uponunit_view.removeChildren()},renderview.prototype.blackscreen=function(tm){null!=this.m_screeneffect_view&&(Laya.Tween.clearAll(this.m_screeneffect_view),this.m_screeneffect_view.graphics.clear(),this.m_screeneffect_view.graphics.drawRect(-500,-500,3e3,3e3,"#000000"),this.m_screeneffect_view.alpha=0,Laya.Tween.to(this.m_screeneffect_view,{alpha:1},tm,Laya.Ease.linearIn,Laya.Handler.create(this,this.blackreset,[1e3])))},renderview.prototype.blackreset=function(tm){null!=this.m_screeneffect_view&&(Laya.Tween.clearAll(this.m_screeneffect_view),Laya.Tween.to(this.m_screeneffect_view,{alpha:0},tm,Laya.Ease.linearIn,Laya.Handler.create(this,this.resetscreenview)))},renderview.prototype.resetscreenview=function(){null!=this.m_screeneffect_view&&(Laya.Tween.clearAll(this.m_screeneffect_view),this.m_screeneffect_view.graphics.clear())},renderview.prototype.renderafter=function(){},renderview.prototype.update=function(delta){},renderview.prototype.show_map_mask=function(flag,alpha){void 0===alpha&&(alpha=.3),this.m_map_mask.alpha=alpha,flag?this.addChildAt(this.m_map_mask,1):this.removeChild(this.m_map_mask)},renderview.prototype.project=function(context){var cx=context.m_camera.x,cy=context.m_camera.y;this.x=(context.m_camera.width>>1)-cx,this.y=(context.m_camera.height>>1)-cy,this.m_map_mask.x=context.m_camera.x-(context.m_camera.width>>1),this.m_map_mask.y=context.m_camera.y-(context.m_camera.height>>1)},renderview.prototype.get_mapviewport_canvas=function(context,w,h){return this.m_mapView.drawToCanvas(w,h,0,0)},renderview.prototype.dispose=function(){this.removeChildren(),this.m_screeneffect_view=null,this.m_map_mask=null,this.m_mapView=null,this.m_unitshadow_View=null,this.m_unitname_View=null,this.m_unitground_View=null,this.m_unitView=null,this.m_unitfront_View=null,this.m_ani_underunit_View=null,this.m_ani_uponunit_view=null},renderview}(laya.display.Sprite);core.renderview=renderview}(core||(core={})),function(core){var renderagent=function(){function renderagent(){this.m_update_follow_tm=0,this.m_render=new core.renderimpl}return renderagent.prototype.set_avatar_config=function(conf){core.matinfo_mgr().set_avatar_config(conf)},renderagent.prototype.set_map_config=function(conf){core.matinfo_mgr().set_map_config(conf)},renderagent.prototype.set_ani_config=function(conf){core.matinfo_mgr().set_ani_config(conf)},renderagent.prototype.set_eff_config=function(conf){core.matinfo_mgr().set_eff_config(conf)},renderagent.prototype.initstage=function(sp){this.m_render.initstage(sp)},renderagent.prototype.check_point=function(x,y){return this.m_render.check_click(x,y)},renderagent.prototype.blackscene=function(tm){this.m_render.m_view.blackscreen(tm)},renderagent.prototype.setcamerapos=function(x,y,force){void 0===force&&(force=!0),this.m_render.setcamerapos(x,y,force)},renderagent.prototype.cameralookat=function(unit){this.m_render.set_eye(unit)},renderagent.prototype.setviewport=function(w,h){this.m_render.setviewport(w,h)},renderagent.prototype.update=function(delta){this.m_render.update(delta),this.m_update_follow_tm+=delta,500<this.m_update_follow_tm&&(this.update_follow_pos(),this.m_update_follow_tm=0)},renderagent.prototype.render=function(){this.m_render.render()},renderagent.prototype.dispose=function(){null!=this.m_render&&(this.m_render.dispose(),this.m_render=null)},renderagent.prototype.clear=function(){this.m_render.m_scene.m_map.clear(),this.delallani(),this.delalleff(),this.delallsprite(),this.delallunit()},renderagent.prototype.check_release=function(){core.mat_mgr().check_release()},renderagent.prototype.preload_matres=function(res,extrares,types){void 0===extrares&&(extrares=""),void 0===types&&(types=""),core.mat_mgr().preload_mat(res,extrares,types)},renderagent.prototype.clearmap=function(){this.m_render.m_scene.m_map.clear()},renderagent.prototype.clearmapslotcache=function(){core.mat_mgr().clearallmapslot()},renderagent.prototype.set_map_filter=function(f){this.m_render.m_view.m_mapView.filters=f},renderagent.prototype.show_map_mask=function(flag,alpha){void 0===alpha&&(alpha=.3),this.m_render.m_view.show_map_mask(flag,alpha)},renderagent.prototype.setmapbk=function(res){this.m_render.m_scene.m_map.setbk(res)},renderagent.prototype.addmapscrollbk=function(res,w,h){this.m_render.m_scene.m_map.addscrollbk(res,w,h)},renderagent.prototype.setmapscrollbkpos=function(x,y){this.m_render.m_scene.m_map.setscrollbkpos(x,y)},renderagent.prototype.setmapscrollbkview=function(w,h){this.m_render.m_scene.m_map.setscrollbkview(w,h)},renderagent.prototype.setmapscrollbkspd=function(spd){this.m_render.m_scene.m_map.setscrollbkspd(spd)},renderagent.prototype.clearmapscrollbk=function(){this.m_render.m_scene.m_map.clearscrollbk()},renderagent.prototype.setmapbksp=function(sp){this.m_render.m_scene.m_map.setsp(sp)},renderagent.prototype.clearmapbksp=function(){this.m_render.m_scene.m_map.removesp()},renderagent.prototype.stagepos2worldpos=function(pos){return new laya.maths.Point(pos.x+this.m_render.m_camera.m_viewport.x,pos.y+this.m_render.m_camera.m_viewport.y)},renderagent.prototype.worldpos2stagepos=function(pos){return new laya.maths.Point(pos.x-this.m_render.m_camera.m_viewport.x,pos.y-this.m_render.m_camera.m_viewport.y)},renderagent.prototype.entermap=function(mapid,b_slot){void 0===b_slot&&(b_slot=!0),this.m_render.m_scene.m_map.setmapid(mapid,b_slot),this.m_render.setworldwh(this.m_render.m_scene.m_map.m_mapw,this.m_render.m_scene.m_map.m_maph)},renderagent.prototype.addani=function(aniid,x,y,underunit){void 0===underunit&&(underunit=!0);var ani=this.m_render._get_renderani_ins(aniid,x,y,underunit);return this.m_render.m_scene.m_anis.push(ani),ani.m_obj_id},renderagent.prototype.delani=function(objid){for(var idx=0,_i=0,_a=this.m_render.m_scene.m_anis;_i<_a.length;_i++){var i=_a[_i];if(i.m_obj_id==objid)return i.dispose(),this.m_render.m_scene.m_anis.splice(idx,1),void this.m_render._del_renderani_ins(i);idx++}},renderagent.prototype.delallani=function(){for(var _i=0,_a=this.m_render.m_scene.m_anis;_i<_a.length;_i++){var i=_a[_i];i.dispose(),this.m_render._del_renderani_ins(i)}this.m_render.m_scene.m_anis=new Array},renderagent.prototype.addsprite=function(sp,x,y,b_unit_front){void 0===b_unit_front&&(b_unit_front=!0);var rsp=this.m_render._get_rendersprite_ins(sp,x,y,b_unit_front);return this.m_render.m_scene.m_sprites.push(rsp),rsp.m_obj_id},renderagent.prototype.getsprite=function(objid){for(var _i=0,_a=this.m_render.m_scene.m_sprites;_i<_a.length;_i++){var i=_a[_i];if(i.m_obj_id==objid)return i}return null},renderagent.prototype.delsprite=function(objid){for(var idx=0,_i=0,_a=this.m_render.m_scene.m_sprites;_i<_a.length;_i++){var i=_a[_i];if(i.m_obj_id==objid)return i.dispose(),this.m_render.m_scene.m_sprites.splice(idx,1),void this.m_render._del_rendersprite_ins(i);idx++}},renderagent.prototype.delallsprite=function(){for(var _i=0,_a=this.m_render.m_scene.m_sprites;_i<_a.length;_i++){var i=_a[_i];i.dispose(),this.m_render._del_rendersprite_ins(i)}this.m_render.m_scene.m_sprites=new Array},renderagent.prototype.addeff=function(aniid,x,y,underunit,autodel){void 0===underunit&&(underunit=!0),void 0===autodel&&(autodel=!1);var ani=this.m_render._get_rendereff_ins(aniid,x,y,underunit,autodel);return this.m_render.m_scene.m_effs.push(ani),ani.m_obj_id},renderagent.prototype.deleff=function(objid){for(var idx=0,_i=0,_a=this.m_render.m_scene.m_effs;_i<_a.length;_i++){var i=_a[_i];if(i.m_obj_id==objid)return i.dispose(),this.m_render.m_scene.m_effs.splice(idx,1),void this.m_render._del_rendereff_ins(i);idx++}},renderagent.prototype.delalleff=function(){for(var _i=0,_a=this.m_render.m_scene.m_effs;_i<_a.length;_i++){var i=_a[_i];i.dispose(),this.m_render._del_rendereff_ins(i)}this.m_render.m_scene.m_effs=new Array},renderagent.prototype.addunit=function(name,shape,x,y,use_default){void 0===use_default&&(use_default=!0);var unitobj=this.m_render._get_renderavatar_ins(shape,x,y,use_default);return this.m_render.m_scene.addunit(name,unitobj)},renderagent.prototype.delunit=function(id){var delunit=this.m_render.m_scene.delunit(id);if(null!=delunit&&null!=this.m_render.m_eye&&this.m_render.m_eye==delunit&&this.cameralookat(null),null!=delunit){null!=this.m_render.m_scene.m_follow_list[id]&&delete this.m_render.m_scene.m_follow_list[id];for(var del_chase_list=new Array,_i=0,_a=Object.keys(this.m_render.m_scene.m_follow_list);_i<_a.length;_i++){var k=_a[_i];if(this.m_render.m_scene.m_follow_list.hasOwnProperty(k)){var c_id=parseInt(k);this.m_render.m_scene.m_follow_list[c_id]==id&&(del_chase_list.push(c_id),delete this.m_render.m_scene.m_follow_list[c_id])}}this.m_render._del_renderavatar_ins(delunit);for(var _b=0,del_chase_list_1=del_chase_list;_b<del_chase_list_1.length;_b++){var i=del_chase_list_1[_b];this.delunit(i)}}},renderagent.prototype.set_follow_id=function(chase_id,follow_id){var chase_role=this.getunit(chase_id);if(null!=chase_role){var follow_role=this.getunit(follow_id);if(null!=follow_role){this.m_render.m_scene.m_follow_list[chase_id]=follow_id;chase_role.set_pos(follow_role.x+100*Math.random()-50,follow_role.y+100*Math.random()-50)}}},renderagent.prototype.clear_follow_id=function(chase_id){this.m_render.m_scene.m_follow_list.hasOwnProperty(chase_id.toString())&&delete this.m_render.m_scene.m_follow_list[chase_id]},renderagent.prototype.clear_all_follow=function(follow_id){for(var _i=0,_a=Object.keys(this.m_render.m_scene.m_follow_list);_i<_a.length;_i++){var key=_a[_i];if(this.m_render.m_scene.m_follow_list.hasOwnProperty(key))this.m_render.m_scene.m_follow_list[parseInt(key)]==follow_id&&(this.delunit(parseInt(key)),delete this.m_render.m_scene.m_follow_list[parseInt(key)])}},renderagent.prototype._gen_back_pos=function(pt,dir){switch(dir){case 0:pt.y-=30,pt.x+=40;break;case 1:pt.y+=10,pt.x+=45;break;case 2:pt.y+=40,pt.x+=30;break;case 3:pt.y+=45,pt.x-=10;break;case 4:pt.y+=30,pt.x-=40;break;case 5:pt.y-=15,pt.x-=40;break;case 6:pt.y-=40,pt.x-=30;break;case 7:pt.y+=10,pt.x-=45}return pt},renderagent.prototype.update_follow_pos=function(){for(var pt=new Laya.Point,_i=0,_a=Object.keys(this.m_render.m_scene.m_follow_list);_i<_a.length;_i++){var k=_a[_i];if(this.m_render.m_scene.m_follow_list.hasOwnProperty(k)){var c_id=parseInt(k),f_id=this.m_render.m_scene.m_follow_list[c_id],f_role=this.getunit(f_id);null!=f_role&&(pt.x=f_role.x,pt.y=f_role.y,pt=this._gen_back_pos(pt,f_role.m_dir),this.unit_walk2(c_id,pt.x,pt.y,!0))}}},renderagent.prototype.delallunit=function(){this.cameralookat(null);for(var i=0;i<this.m_render.m_scene.m_units.length;++i){var unit=this.m_render.m_scene.m_units[i];this.m_render.m_scene.delpath(unit.m_obj_id),unit.dispose(),this.m_render._del_renderavatar_ins(unit)}this.m_render.m_scene.m_units_dict=new Object,this.m_render.m_scene.m_units.length=0,this.m_render.m_scene.m_follow_list=new Object},renderagent.prototype.getunitbyud=function(ud){return this.m_render.m_scene.getunitbyud(ud)},renderagent.prototype.getunit=function(id){return this.m_render.m_scene.getunit(id)},renderagent.prototype.getmap_gridw=function(){return this.m_render.m_scene.m_map.m_block.m_mat.m_grid_w},renderagent.prototype.getmap_gridh=function(){return this.m_render.m_scene.m_map.m_block.m_mat.m_grid_h},renderagent.prototype.unit_stop=function(id){var unit=this.getunit(id);null!=unit&&(this.m_render.m_scene.delpath(id),unit.change_action(0))},renderagent.prototype.is_unit_walk=function(id){return null!=this.m_render.m_scene.get_unitpath(id)},renderagent.prototype.get_unit_walk=function(id){return this.m_render.m_scene.get_unitpath(id)},renderagent.prototype.is_scene_block=function(x,y){return this.m_render.m_scene.m_map.is_block(x,y)},renderagent.prototype.is_scene_mask=function(x,y){return this.m_render.m_scene.m_map.is_mask(x,y)},renderagent.prototype.get_map_canvas=function(w,h,x,y){return this.m_render.m_view.get_mapviewport_canvas(this.m_render.m_context,w,h)},renderagent.prototype.get_camera_x=function(){return this.m_render.m_camera.x},renderagent.prototype.get_view_x=function(){return this.m_render.m_view.x},renderagent.prototype.get_view_y=function(){return this.m_render.m_view.y},renderagent.prototype.get_camera_y=function(){return this.m_render.m_camera.y},renderagent.prototype.set_walk_spd=function(spd){this.m_render.m_context.m_walk_speed=spd},renderagent.prototype.set_run_spd=function(spd){this.m_render.m_context.m_run_speed=spd},renderagent.prototype.unit_walk2inspd=function(id,x,y,b_force,spd){var unit=this.getunit(id);if(null!=unit){var sx=unit.x,sy=unit.y;if(sx==x&&sy==y)return;core.core_tiplog("unit_walk2 findpath start ",id,sx,sy,x,y);var newpath=null;if(b_force?((newpath=utils.getitembycls("path",core.path)).init(spd),newpath.push_pt(sx,sy,x,y)):newpath=this.m_render.m_scene.findpath(sx,sy,x,y,!0,spd),core.core_tiplog("unit_walk2 findpath end ",id,sx,sy,x,y,newpath),null==newpath)return;return newpath.start(),this.m_render.m_scene.addpath(newpath,id),1!=unit.m_action&&unit.change_action(1),newpath.get_end()}},renderagent.prototype.unit_walk2=function(id,x,y,b_force,b_run){return void 0===b_force&&(b_force=!1),void 0===b_run&&(b_run=!1),this.unit_walk2inspd(id,x,y,b_force,this.m_render.m_context.get_move_spd(b_run))},renderagent}();core.renderagent=renderagent}(core||(core={})),function(core){var filehead=function(){this.m_key=0,this.m_size=0,this.m_offset=0},filepack=function(){function filepack(buff){this.m_sign=0,this.m_version=0,this.m_filecount=0,this.m_filehead_arr=new Array,this.m_filehead_dict=new Object,this.m_buff=null,this.m_fh_sign="pack_file_head",this.m_buff=buff,this.m_buff.pos=0,this.m_sign=this.m_buff.getUint32(),this.m_version=this.m_buff.getUint8(),this.m_filecount=this.m_buff.getUint32();for(var i=0;i<this.m_filecount;++i){var key=this.m_buff.getUint32(),size=this.m_buff.getUint32(),offset=this.m_buff.getUint32(),new_filehead=utils.getitembycls(this.m_fh_sign,filehead);new_filehead.m_key=key,new_filehead.m_size=size,new_filehead.m_offset=offset,this.m_filehead_arr.push(new_filehead),this.m_filehead_dict[key]=new_filehead}}return filepack.prototype.dispose=function(){for(var _i=0,_a=this.m_filehead_arr;_i<_a.length;_i++){var i=_a[_i];utils.recover(this.m_fh_sign,i)}this.m_filehead_arr.length=0,this.m_filehead_dict=new Object,this.m_buff.clear(),this.m_buff=null},filepack.prototype._gen_key=function(file_name){var ret=core.get_file_key(file_name);return core.core_tiplog("filepack _gen_key ",file_name,ret.toString(16)),ret},filepack.prototype.get_file=function(file_name){var key=this._gen_key(file_name);if(null==this.m_filehead_dict[key])return null;var fh=this.m_filehead_dict[key];this.m_buff.pos=fh.m_offset;fh.m_size;return this.m_buff},filepack.prototype.get_file_len=function(file_name){var key=this._gen_key(file_name);return null==this.m_filehead_dict[key]?0:this.m_filehead_dict[key].m_size},filepack}(),filepackmgr=function(){function filepackmgr(){this.m_pack_dict=new Object}return filepackmgr.prototype.delpack=function(pack_name){if(0!=this.m_pack_dict.hasOwnProperty(pack_name)){var fp=this.m_pack_dict[pack_name];null!=fp&&null!=fp&&fp.dispose(),this.m_pack_dict[pack_name]=null}},filepackmgr.prototype.addpack=function(pack_name,buff){this.m_pack_dict.hasOwnProperty(pack_name)&&this.delpack(pack_name);var new_fp=new filepack(buff);this.m_pack_dict[pack_name]=new_fp},filepackmgr.prototype.get_file=function(pack_name,file_name){if(0!=this.m_pack_dict.hasOwnProperty(pack_name)){var fp=this.m_pack_dict[pack_name];return null!=fp&&null!=fp?fp.get_file(file_name):null}},filepackmgr.prototype.get_file_len=function(pack_name,file_name){if(0==this.m_pack_dict.hasOwnProperty(pack_name))return 0;var fp=this.m_pack_dict[pack_name];return null!=fp&&null!=fp?fp.get_file_len(file_name):0},filepackmgr}();core.filepackmgr=filepackmgr;var g_ins=null;core.filepack_ins=function(){return null==g_ins&&(g_ins=new filepackmgr),g_ins}}(core||(core={})),function(utils){var game_data_mgr=function(){function game_data_mgr(){this.m_data_class_map=new Object,this.m_data_map=new Object}return game_data_mgr.prototype.register_data=function(name,module_cls){this.m_data_class_map[name]=module_cls},game_data_mgr.prototype.get_data=function(name){if(this.m_data_map.hasOwnProperty(name))return this.m_data_map[name];if(this.m_data_class_map.hasOwnProperty(name)){var m=new this.m_data_class_map[name];return this.m_data_map[name]=m}return null},game_data_mgr.prototype.dispose=function(){this.m_data_class_map=new Object;for(var _i=0,_a=Object.keys(this.m_data_map);_i<_a.length;_i++){var i=_a[_i];this.m_data_map[i].dispose()}this.m_data_map=new Object},game_data_mgr}();utils.game_data_mgr=game_data_mgr;var g_ins=null;utils.data_ins=function(){return null==g_ins&&(g_ins=new game_data_mgr),g_ins}}(utils||(utils={})),function(utils){var game_data=function(){function game_data(){}return game_data.prototype.dispose=function(){},game_data}();utils.game_data=game_data}(utils||(utils={})),function(utils){var game_event_receiver=function(){function game_event_receiver(){this.m_event_func=new Object}return game_event_receiver.prototype.register_event_func=function(event,func){this.m_event_func[event]=func},game_event_receiver.prototype.unregister_event_func=function(event){this.m_event_func.hasOwnProperty(event)&&delete this.m_event_func[event]},game_event_receiver.prototype.unregister_all_event_func=function(){this.m_event_func=new Object},game_event_receiver.prototype.on_event=function(event,user_data){(void 0===user_data&&(user_data=null),this.m_event_func.hasOwnProperty(event))&&this.m_event_func[event].apply(this,[user_data])},game_event_receiver.prototype.dispose=function(){this.unregister_all_event_func()},game_event_receiver}();utils.game_event_receiver=game_event_receiver;var game_event_dispatcher=function(){function game_event_dispatcher(){this.m_pause=!1,this.m_handler_map=new Object,this.m_handler_next_frame_map=new Object}return game_event_dispatcher.prototype.pause=function(){this.m_pause=!0},game_event_dispatcher.prototype.resume=function(){this.m_pause=!1},game_event_dispatcher.prototype.register_event=function(event,hander){0==this.m_handler_map.hasOwnProperty(event)&&(this.m_handler_map[event]=new Array);var arr=this.m_handler_map[event];arr.indexOf(hander)<0&&arr.push(hander)},game_event_dispatcher.prototype.unregister_event=function(event,hander){if(this.m_handler_map.hasOwnProperty(event)){var arr=this.m_handler_map[event],idx=arr.indexOf(hander);0<=idx&&arr.splice(idx,1)}},game_event_dispatcher.prototype.unregister_allevent=function(hander){for(var i in this.m_handler_map)this.m_handler_map.hasOwnProperty(i)&&this.unregister_event(i,hander)},game_event_dispatcher.prototype.fire_event=function(event,user_data){if(void 0===user_data&&(user_data=null),this.m_handler_map.hasOwnProperty(event))for(var _i=0,arr_1=this.m_handler_map[event];_i<arr_1.length;_i++){arr_1[_i].on_event(event,user_data)}},game_event_dispatcher.prototype.fire_event_next_frame=function(event,user_data){void 0===user_data&&(user_data=null),this.m_handler_next_frame_map[event]=user_data},game_event_dispatcher.prototype.dispatch_all_delay_event=function(){if(!this.m_pause){var tmpmap=this.m_handler_next_frame_map;this.m_handler_next_frame_map=new Object;for(var _i=0,_a=Object.keys(tmpmap);_i<_a.length;_i++){var prop=_a[_i];this.fire_event(prop,tmpmap[prop])}}},game_event_dispatcher.prototype.dispose=function(){this.m_handler_map=new Object,this.m_handler_next_frame_map=new Object},game_event_dispatcher}();utils.game_event_dispatcher=game_event_dispatcher;var g_event_ins=null;utils.event_ins=function(){return null==g_event_ins&&(g_event_ins=new game_event_dispatcher),g_event_ins}}(utils||(utils={})),function(utils){var game_module_mgr=function(){function game_module_mgr(){this.m_module_class_map=new Object,this.m_module_map=new Object}return game_module_mgr.prototype.register_module=function(name,module_cls){this.m_module_class_map[name]=module_cls},game_module_mgr.prototype.get_module=function(name){if(this.m_module_map.hasOwnProperty(name))return this.m_module_map[name];if(this.m_module_class_map.hasOwnProperty(name)){var m=new this.m_module_class_map[name];return this.m_module_map[name]=m}return null},game_module_mgr.prototype.dispose=function(){this.m_module_class_map=new Object;for(var _i=0,_a=Object.keys(this.m_module_map);_i<_a.length;_i++){var i=_a[_i];this.m_module_map[i].dispose()}this.m_module_map=new Object},game_module_mgr}();utils.game_module_mgr=game_module_mgr;var g_ins=null;utils.module_ins=function(){return null==g_ins&&(g_ins=new game_module_mgr),g_ins}}(utils||(utils={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(utils){var game_module=function(_super){function game_module(){return _super.call(this)||this}return __extends(game_module,_super),game_module.prototype.register_net_event=function(cmd,func){var event=game_event.gen_netcmd_event(cmd);utils.event_ins().register_event(event,this),this.register_event_func(event,func)},game_module.prototype.unregister_net_event=function(cmd){var event=game_event.gen_netcmd_event(cmd);utils.event_ins().unregister_event(event,this),this.unregister_event_func(event)},game_module.prototype.register_event=function(event,func){utils.event_ins().register_event(event,this),this.register_event_func(event,func)},game_module.prototype.unregister_event=function(event){utils.event_ins().unregister_event(event,this),this.unregister_event_func(event)},game_module.prototype.fire_event=function(event,user_data){void 0===user_data&&(user_data=null),utils.event_ins().fire_event(event,user_data)},game_module.prototype.unregister_allevent=function(){utils.event_ins().unregister_allevent(this),this.unregister_all_event_func()},game_module.prototype.fire_event_next_frame=function(event,user_data){void 0===user_data&&(user_data=null),utils.event_ins().fire_event_next_frame(event,user_data)},game_module.prototype.start=function(){},game_module.prototype.update=function(delta){},game_module.prototype.dispose=function(){_super.prototype.dispose.call(this),this.unregister_allevent()},game_module}(utils.game_event_receiver);utils.game_module=game_module}(utils||(utils={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(utils){var ui_loadingUI=function(_super){function ui_loadingUI(){var _this=_super.call(this)||this;return _this.m_b_use_ani=!0,_this}return __extends(ui_loadingUI,_super),ui_loadingUI.prototype.createChildren=function(){_super.prototype.createChildren.call(this),this.createView(ui_loadingUI.uiView)},ui_loadingUI.prototype.init=function(){this.m_mask=new Laya.Sprite,this.m_mask.x=0,this.m_mask.graphics.drawRect(0,0,this.m_logo.width,this.m_logo.height,"#000000")},ui_loadingUI.prototype.start=function(){this.m_b_use_ani?(this.m_logo.visible=!1,this.m_logo_grey.visible=!1,this.m_mask.visible=!1,this.m_progress.visible=!1,this.m_ani.play(),this.m_ani.visible=!0):(this.m_logo.visible=!0,this.m_logo_grey.visible=!0,this.m_mask.visible=!0,this.m_progress.visible=!0,this.m_ani.stop(),this.m_ani.visible=!1,this.m_mask.x=0)},ui_loadingUI.prototype.update=function(){this.m_b_use_ani||(this.m_mask.x>=this.m_logo_grey.width?this.m_mask.x=0:this.m_mask.x+=2)},ui_loadingUI.uiView={type:"Dialog",props:{y:0,x:0,width:800,height:400,anchorY:0,anchorX:0},child:[{type:"Image",props:{y:0,x:0,var:"m_logo",skin:"bigpic/ui_loading.png",gray:!1}},{type:"Label",props:{y:309,x:326,width:192,var:"m_progress",height:88,fontSize:50,color:"#ffffff",align:"center"}},{type:"Image",props:{y:0,x:0,var:"m_logo_grey",skin:"bigpic/ui_loading.png",gray:!0}},{type:"Animation",props:{y:231,x:400,width:0,var:"m_ani",source:"game_ani/uiloading.ani",name:"m_ani",height:0}}]},ui_loadingUI}(laya.ui.Dialog);utils.ui_loadingUI=ui_loadingUI;var game_widget_mgr=function(){function game_widget_mgr(){this.m_widget_class_map=new Object,this.m_widget_group_map=new Object,this.m_widget_map=new Object,this.m_root_view=null,this.m_view_ins=new utils.game_widget_view,this.m_release_dict=new Object,this.m_loading_ui=null,this.m_loadingui_dict=new Object,this.m_loadingui_refs=0}return game_widget_mgr.prototype.show_loadingui=function(){null==this.m_loading_ui&&(this.m_loading_ui=new ui_loadingUI,this.m_loading_ui.init(),this.m_loading_ui.x=Laya.stage.width-this.m_loading_ui.width>>1,this.m_loading_ui.y=Laya.stage.height-this.m_loading_ui.height>>1),this.m_loading_ui.visible=!0,this.m_loading_ui.start(),this.m_view_ins.m_view_topmost.addChild(this.m_loading_ui)},game_widget_mgr.prototype.hide_loadingui=function(){null!=this.m_loading_ui&&(this.m_loading_ui.visible=!1,this.m_loading_ui.removeSelf())},game_widget_mgr.prototype.update_loadingui=function(){null!=this.m_loading_ui&&0!=this.m_loading_ui.visible&&this.m_loading_ui.update()},game_widget_mgr.prototype.del_loadingui=function(){null!=this.m_loading_ui&&(this.m_loading_ui.removeSelf(),this.m_loading_ui.destroy(),this.m_loading_ui=null)},game_widget_mgr.prototype.start_load=function(uiins){0==this.m_loadingui_dict.hasOwnProperty(uiins.m_id.toString())&&(this.m_loadingui_dict[uiins.m_id.toString()]=!0,this.m_loadingui_refs+=1,this.show_loadingui())},game_widget_mgr.prototype.end_load=function(uiins){this.m_loadingui_dict.hasOwnProperty(uiins.m_id.toString())&&(delete this.m_loadingui_dict[uiins.m_id.toString()],this.m_loadingui_refs-=1,this.m_loadingui_refs<=0&&this.hide_loadingui())},game_widget_mgr.prototype.add_preload_res=function(path){utils.game_widget.s_loaded_dict[path]=!0},game_widget_mgr.prototype.set_root=function(sp){this.m_view_ins.removeSelf(),this.m_root_view=sp,this.m_root_view.addChild(this.m_view_ins)},game_widget_mgr.prototype.get_view=function(layer){return this.m_view_ins.get_view(layer)},game_widget_mgr.prototype.register_widget=function(name,widget_cls,w_group){void 0===w_group&&(w_group=utils.WIDGET_GROUP.GROUP_DEFAULT),this.m_widget_class_map[name]=widget_cls,this.m_widget_group_map[name]=w_group},game_widget_mgr.prototype.set_widget_group=function(name,w_group){this.m_widget_group_map[name]=w_group},game_widget_mgr.prototype.get_module=function(name){if(this.m_widget_map.hasOwnProperty(name))return this.m_widget_map[name];if(this.m_widget_class_map.hasOwnProperty(name)){var m=new this.m_widget_class_map[name];return(this.m_widget_map[name]=m).m_widget_name=name,m}return null},game_widget_mgr.prototype.show_widget=function(widget_name,flag,ud){void 0===ud&&(ud=null);var w=this.get_module(widget_name);null!=w&&(null!=ud&&(w.m_ud=ud),w.show(flag),flag?delete this.m_release_dict[widget_name]:this.m_release_dict[widget_name]=[w,utils.get_render_milltm()])},game_widget_mgr.prototype.call_widget_hide=function(w){this.m_release_dict[w.m_widget_name]=[w,utils.get_render_milltm()]},game_widget_mgr.prototype.check_release=function(){this.update_loadingui();for(var _i=0,_a=Object.keys(this.m_release_dict);_i<_a.length;_i++){var k=_a[_i];if(this.m_release_dict.hasOwnProperty(k)){var tm=this.m_release_dict[k][1];if(1e4<utils.get_render_milltm()-tm){var m=this.m_widget_map[k];return utils.event_ins().fire_event(game_event.EVENT_WIDGET_ONDISPOSE,m),m.dispose(),delete this.m_widget_map[k],delete this.m_release_dict[k],void core.core_errlog("game_widget_mgr release ",k)}}}},game_widget_mgr.prototype.show_widget_bygroup=function(v,flag,ud){for(var k in void 0===ud&&(ud=null),this.m_widget_group_map){if(this.m_widget_group_map.hasOwnProperty(k))v==this.m_widget_group_map[k]&&this.show_widget(k,flag,ud)}},game_widget_mgr.prototype.is_widget_show=function(widget_name){var w=this.get_module(widget_name);return null!=w&&w.m_b_show},game_widget_mgr.prototype.dispose=function(){this.del_loadingui(),this.m_widget_class_map=new Object,utils.event_ins().fire_event(game_event.EVENT_WIDGET_ALLDISPOSE);for(var _i=0,_a=Object.keys(this.m_widget_map);_i<_a.length;_i++){var i=_a[_i];this.m_widget_map[i].dispose()}null!=this.m_view_ins&&(this.m_view_ins.removeSelf(),this.m_view_ins.dispose(),this.m_view_ins=null),this.m_root_view=null,this.m_widget_map=new Object,this.m_widget_group_map=new Object},game_widget_mgr}();utils.game_widget_mgr=game_widget_mgr;var g_ins=null;utils.widget_ins=function(){return null==g_ins&&(g_ins=new game_widget_mgr),g_ins}}(utils||(utils={})),function(utils){!function(WIDGET_LAYER){WIDGET_LAYER[WIDGET_LAYER.SCENE=0]="SCENE",WIDGET_LAYER[WIDGET_LAYER.BACKGROUND=1]="BACKGROUND",WIDGET_LAYER[WIDGET_LAYER.BOTTOM=2]="BOTTOM",WIDGET_LAYER[WIDGET_LAYER.NORMAL=3]="NORMAL",WIDGET_LAYER[WIDGET_LAYER.POPUP=4]="POPUP",WIDGET_LAYER[WIDGET_LAYER.TIPS=5]="TIPS",WIDGET_LAYER[WIDGET_LAYER.TOP=6]="TOP",WIDGET_LAYER[WIDGET_LAYER.TOPMOST=7]="TOPMOST"}(utils.WIDGET_LAYER||(utils.WIDGET_LAYER={})),function(WIDGET_GROUP){WIDGET_GROUP[WIDGET_GROUP.GROUP_DEFAULT=0]="GROUP_DEFAULT",WIDGET_GROUP[WIDGET_GROUP.GROUP_0=1]="GROUP_0",WIDGET_GROUP[WIDGET_GROUP.GROUP_1=2]="GROUP_1",WIDGET_GROUP[WIDGET_GROUP.GROUP_2=3]="GROUP_2",WIDGET_GROUP[WIDGET_GROUP.GROUP_3=4]="GROUP_3",WIDGET_GROUP[WIDGET_GROUP.GROUP_4=5]="GROUP_4"}(utils.WIDGET_GROUP||(utils.WIDGET_GROUP={}))}(utils||(utils={}));__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(utils){var game_widget_view=function(_super){function game_widget_view(){var _this=_super.call(this)||this;return _this.m_view_scene=new laya.display.Sprite,_this.m_view_bk=new laya.display.Sprite,_this.m_view_bottom=new laya.display.Sprite,_this.m_view_normal=new laya.display.Sprite,_this.m_view_tips=new laya.display.Sprite,_this.m_view_popup=new laya.display.Sprite,_this.m_view_top=new laya.display.Sprite,_this.m_view_topmost=new laya.display.Sprite,_this.addChild(_this.m_view_scene),_this.addChild(_this.m_view_bk),_this.addChild(_this.m_view_bottom),_this.addChild(_this.m_view_normal),_this.addChild(_this.m_view_popup),_this.addChild(_this.m_view_tips),_this.addChild(_this.m_view_top),_this.addChild(_this.m_view_topmost),_this}return __extends(game_widget_view,_super),game_widget_view.prototype.get_view=function(layer){var ret=null;switch(layer){case utils.WIDGET_LAYER.SCENE:ret=this.m_view_scene;break;case utils.WIDGET_LAYER.BACKGROUND:ret=this.m_view_bk;break;case utils.WIDGET_LAYER.BOTTOM:ret=this.m_view_bottom;break;case utils.WIDGET_LAYER.NORMAL:ret=this.m_view_normal;break;case utils.WIDGET_LAYER.TIPS:ret=this.m_view_tips;break;case utils.WIDGET_LAYER.POPUP:ret=this.m_view_popup;break;case utils.WIDGET_LAYER.TOP:ret=this.m_view_top;break;case utils.WIDGET_LAYER.TOPMOST:ret=this.m_view_topmost;break;default:ret=this.m_view_normal}return ret},game_widget_view.prototype.dispose=function(){this.removeChildren(),this.m_view_scene.removeChildren(),this.m_view_bk.removeChildren(),this.m_view_bottom.removeChildren(),this.m_view_normal.removeChildren(),this.m_view_top.removeChildren(),this.m_view_scene=null,this.m_view_bk=null,this.m_view_bottom=null,this.m_view_normal=null,this.m_view_popup=null,this.m_view_tips=null,this.m_view_top=null,this.m_view_topmost=null},game_widget_view}(laya.display.Sprite);utils.game_widget_view=game_widget_view}(utils||(utils={}));var utils;__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(utils){var game_widget=function(_super){function game_widget(res_path,view_cls){var _this=_super.call(this)||this;return _this.m_res_path=null,_this.m_extra_res_list=new Array,_this.m_ui_cls=null,_this.m_ui=null,_this.m_b_loaded=!1,_this.m_b_loading=!1,_this.m_b_show=!1,_this.m_b_disposed=!1,_this.m_layer=utils.WIDGET_LAYER.NORMAL,_this.m_id=0,_this.m_widget_name="unknown_widget",_this.m_ud=null,_this.m_res_path=res_path,_this.m_ui_cls=view_cls,game_widget.m_start_id+=1,_this.m_id=game_widget.m_start_id,_this}return __extends(game_widget,_super),game_widget.prototype.append_extrares=function(res_url,res_type){this.m_extra_res_list.push({url:res_url,type:res_type})},game_widget.prototype.move_center=function(){this.m_ui.x=Laya.stage.width-this.m_ui.width>>1,this.m_ui.y=Laya.stage.height-this.m_ui.height>>1},game_widget.prototype.register_event=function(event,func){utils.event_ins().register_event(event,this),this.register_event_func(event,func)},game_widget.prototype.unregister_event=function(event){utils.event_ins().unregister_event(event,this),this.unregister_event_func(event)},game_widget.prototype.unregister_allevent=function(){utils.event_ins().unregister_allevent(this),this.unregister_all_event_func()},game_widget.prototype.fire_event=function(event,user_data){void 0===user_data&&(user_data=null),utils.event_ins().fire_event(event,user_data)},game_widget.prototype.fire_event_next_frame=function(event,user_data){void 0===user_data&&(user_data=null),utils.event_ins().fire_event_next_frame(event,user_data)},game_widget.prototype.register_btn_click=function(con_name,func){var btn=this.get_con(con_name);null!=btn&&btn.on(Laya.Event.CLICK,this,func)},game_widget.prototype.unregister_btn_click=function(con_name,func){var btn=this.get_con(con_name);null!=btn&&btn.off(Laya.Event.CLICK,this,func)},game_widget.prototype._get_con=function(node,name){for(var i=0;i<node.numChildren;++i){var nd=node.getChildAt(i);if(nd.name==name)return nd;if(null!=(nd=this._get_con(nd,name)))return nd}return null},game_widget.prototype.get_con=function(con_name){return this.m_b_loaded?this._get_con(this.m_ui,con_name):null},game_widget.prototype.load=function(){for(var b_need_loaded=!1,_i=0,_a=this.m_extra_res_list;_i<_a.length;_i++){var i=_a[_i];0==game_widget.s_loaded_dict.hasOwnProperty(i.url)&&(core.ui_tiplog("game_widget load need download ",i.url),b_need_loaded=!0)}b_need_loaded&&utils.widget_ins().start_load(this),this.m_b_loading=!0,Laya.loader.on(Laya.Event.ERROR,this,this.on_load_error),core.res_tiplog("game_widget load res ",this.m_extra_res_list),core.myload(this.m_extra_res_list,laya.utils.Handler.create(this,this.on_load_complete),null,null,0)},game_widget.prototype.init_uiins=function(){this.m_ui=new this.m_ui_cls,this.on_init(),this.m_b_show&&(this.m_b_show=!1,this.show(!0))},game_widget.prototype.on_load_complete=function(){if(!this.m_b_disposed)if(0!=this.m_b_loading){utils.widget_ins().end_load(this);for(var _i=0,_a=this.m_extra_res_list;_i<_a.length;_i++){var i=_a[_i];null!=Laya.loader.getRes(i.url)&&(game_widget.s_loaded_dict[i.url]=!0)}this.m_b_loading=!1,Laya.loader.off(Laya.Event.ERROR,this,this.on_load_error),null!=Laya.loader.getRes(this.m_res_path)?(this.m_b_loaded=!0,this.init_uiins()):core.res_errlog("game_widget on_load_complete getRes(this.m_res_path) == null ",this.m_res_path)}else core.res_errlog("game_widget on_load_complete this.m_b_loading = false")},game_widget.prototype.on_load_error=function(err){core.res_errlog("game_widget on_load_error ",err)},game_widget.prototype.on_init=function(){},game_widget.prototype.on_show=function(flag){},game_widget.prototype.on_show_ud=function(flag,ud){void 0===ud&&(ud=null)},game_widget.prototype.on_dispose=function(){},game_widget.prototype.show=function(flag){if(this.m_b_show!=flag)if(this.m_b_show=flag,0!=this.m_b_loaded){this.m_b_show?utils.widget_ins().get_view(this.m_layer).addChild(this.m_ui):this.m_ui.removeSelf(),this.on_show(this.m_b_show),this.on_show_ud(this.m_b_show,this.m_ud),this.m_b_show?utils.event_ins().fire_event(game_event.EVENT_WIDGET_ONSHOW,this):utils.event_ins().fire_event(game_event.EVENT_WIDGET_ONHIDE,this),this.m_b_show||utils.widget_ins().call_widget_hide(this)}else{if(!this.m_b_show)return void core.core_tiplog("game_widget do not load when it is hiden");if(null==this.m_res_path||this.m_res_path.length<=0)return void core.core_tiplog("game_widget load error,invalided res path! ");if(null==this.m_ui_cls)return void core.core_tiplog("game_widget load error,invalided ui cls! ");if(this.m_b_loading)return void core.core_tiplog("game_widget loading,return");this.m_extra_res_list.push({url:this.m_res_path,type:Laya.Loader.ATLAS});for(var _i=0,_a=this.m_extra_res_list;_i<_a.length;_i++){var i=_a[_i];game_widget.s_res_dict.hasOwnProperty(i.url)?game_widget.s_res_dict[i.url]+=1:game_widget.s_res_dict[i.url]=1}this.load()}},game_widget.prototype.dispose=function(){if(!this.m_b_disposed){if(this.unregister_allevent(),this.on_dispose(),null!=this.m_ui&&(this.m_ui.removeSelf(),this.m_ui.destroy(),this.m_ui=null),this.m_b_loaded)for(var _i=0,_a=this.m_extra_res_list;_i<_a.length;_i++){var i=_a[_i];game_widget.s_res_dict.hasOwnProperty(i.url)&&(game_widget.s_res_dict[i.url]-=1,game_widget.s_res_dict[i.url]<=0&&(core.res_tiplog("widget dispose release res ",game_widget.s_res_dict[i.url],i.url),Laya.loader.clearTextureRes(i.url),delete game_widget.s_res_dict[i.url]))}this.m_b_loading&&(utils.widget_ins().end_load(this),Laya.loader.off(Laya.Event.ERROR,this,this.on_load_error)),this.m_b_loading=!1,this.m_extra_res_list=null,this.m_ui_cls=null,this.m_res_path=null,this.m_b_loaded=!1,this.m_b_disposed=!0,this.m_b_show=!1}},game_widget.m_start_id=0,game_widget.s_res_dict=new Object,game_widget.s_loaded_dict=new Object,game_widget}(utils.game_event_receiver);utils.game_widget=game_widget}(utils||(utils={})),function(utils){var heap_node=function(){function heap_node(v,uid,ud){void 0===v&&(v=0),void 0===uid&&(uid=0),void 0===ud&&(ud=null),this.m_value=0,this.m_user_data=null,this.m_user_id=0,this.m_value=v,this.m_user_id=uid,null==ud&&(ud=new Object),this.m_user_data=ud}return heap_node.prototype.init=function(v,uid,ud){this.m_value=v,this.m_user_id=uid,null==ud&&(ud=new Object),this.m_user_data=ud},heap_node}();utils.heap_node=heap_node;var small_heap=function(){function small_heap(){this.m_array=new Array}return small_heap.prototype._get_nd=function(v,uid,ud){void 0===uid&&(uid=0),void 0===ud&&(ud=null);var ret=utils.getitembycls("heap_node",heap_node);return ret.init(v,uid,ud),ret},small_heap.prototype._del_nd=function(nd){utils.recover("heap_node",nd)},small_heap.prototype._clear_nd=function(){utils.clearbysign("heap_node")},small_heap.prototype._cmp_v=function(v1,v2){return v1<v2},small_heap.prototype._filter_up=function(start){for(var idx,i=start,nd=this.m_array[i],nd_v=nd.m_value,nd_id=nd.m_user_id,nd_obj=nd.m_user_data;0<i&&(idx=i-1>>1,this._cmp_v(nd_v,this.m_array[idx].m_value));)this.m_array[i].m_value=this.m_array[idx].m_value,this.m_array[i].m_user_id=this.m_array[idx].m_user_id,this.m_array[i].m_user_data=this.m_array[idx].m_user_data,this.m_array[i].m_user_data.idx=i,i=idx;return this.m_array[i].m_value=nd_v,this.m_array[i].m_user_id=nd_id,this.m_array[i].m_user_data=nd_obj,this.m_array[i].m_user_data.idx=i},small_heap.prototype._filter_down=function(start){for(var i=start,tmp=0,i1=0,i2=0,total=this.m_array.length,nd=this.m_array[i],nd_v=nd.m_value,nd_id=nd.m_user_id,nd_obj=nd.m_user_data;i2=2+(i<<1),!(total<=(i1=1+(i<<1)));){if(tmp=i2<total&&this._cmp_v(this.m_array[i2].m_value,this.m_array[i1].m_value)?i2:i1,!this._cmp_v(this.m_array[tmp].m_value,nd_v))break;this.m_array[i].m_value=this.m_array[tmp].m_value,this.m_array[i].m_user_id=this.m_array[tmp].m_user_id,this.m_array[i].m_user_data=this.m_array[tmp].m_user_data,this.m_array[i].m_user_data.idx=i,i=tmp}return this.m_array[i].m_value=nd_v,this.m_array[i].m_user_id=nd_id,this.m_array[i].m_user_data=nd_obj,this.m_array[i].m_user_data.idx=i},small_heap.prototype.push=function(v,uid,ud){void 0===uid&&(uid=0),void 0===ud&&(ud=null);var nd=this._get_nd(v,uid,ud);return this.m_array.push(nd),this._filter_up(this.m_array.length-1),nd},small_heap.prototype.pop=function(){if(this.m_array.length<=1)return this._del_nd(this.top()),void this.m_array.pop();var nd=this.m_array[this.m_array.length-1],nd_v=nd.m_value,nd_id=nd.m_user_id,nd_obj=nd.m_user_data;this.m_array[0].m_value=nd_v,this.m_array[0].m_user_id=nd_id,this.m_array[0].m_user_data=nd_obj,this.m_array[0].m_user_data.idx=0,this._del_nd(this.m_array[this.m_array.length-1]),this.m_array.splice(this.m_array.length-1,1),this._filter_down(0)},small_heap.prototype.get_idx=function(id){for(var i=0;i<this.m_array.length;++i){if(this.m_array[i].m_user_id==id)return i}return-1},small_heap.prototype.modify=function(idx,v){var nd=this.m_array[idx];nd.m_value!=v&&(this._cmp_v(nd.m_value,v)?(nd.m_value=v,this._filter_down(idx)):(nd.m_value=v,this._filter_up(idx)))},small_heap.prototype.clear=function(){for(var i=0;i<this.m_array.length;++i)this._del_nd(this.m_array[i]);this.m_array=new Array},small_heap.prototype.top=function(){return this.m_array[0]},small_heap.prototype.is_empty=function(){return this.m_array.length<=0},small_heap.prototype.print_data=function(pre){void 0===pre&&(pre=""),core.core_tiplog("smallheap begin ",pre,this.m_array.length);for(var _i=0,_a=this.m_array;_i<_a.length;_i++){var i=_a[_i];core.core_tiplog("smallheap ",pre,i.m_value,i.m_user_id)}core.core_tiplog("smallheap end ",pre)},small_heap}();utils.small_heap=small_heap}(utils||(utils={})),function(utils){function genafrom2point(sx,sy,dx,dy){return(sy-dy)/(sx-dx)}function genbfrom2point(sx,sy,a){return sy-sx*a}utils.get_view_wh=function(){var ret={w:640,h:960};return Laya.Browser.clientWidth,Laya.Browser.clientHeight,ret},utils.get_render_milltm=function(){return laya.utils.Browser.now()},utils.getRandom=function(n,m){return Math.round(Math.random()*(m-n)+n)},utils.genangle=function(dx,dy){return Math.atan2(1.4142135623731*dy,dx)},utils.gendir=function(dx,dy,dircount,ale){return void 0===dircount&&(dircount=8),void 0===ale&&(ale=null),0==dx?0<dy?0:dy<0?4:0:0==dy?0<dx?6:dx<0?2:0:0<dx&&0<dy?7:0<dx&&dy<0?5:dx<0&&0<dy?1:dx<0&&dy<0?3:0},utils.genafrom2point=genafrom2point,utils.genbfrom2point=genbfrom2point,utils.genpointlinefrom2point=function(sx,sy,dx,dy,gridw,gridh){void 0===gridw&&(gridw=32),void 0===gridh&&(gridh=32);var stepx,stepy,cx,cy,ret=new Array,ddx=Math.abs(dx-sx),ddy=Math.abs(dy-sy);if(0==ddx&&0==ddy)return ret;var addx,addy,addkey,tmp=new Object;if(0==ddx||0==ddy||ddx==ddy)for(stepx=1,0==ddx?stepx=0:dx<sx&&(stepx=-1),stepy=1,0==ddy?stepy=0:dy<sy&&(stepy=-1);cx=sx,cy=sy,0==ddx||0==ddy?ret.push(new laya.maths.Point(cx,cy)):(addkey=(1e5*(addx=cx)+(addy=cy)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx=cx-1)+(addy=cy)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx=cx+1)+(addy=cy-1)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx=cx-1)+(addy=cy)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy)))),sx!=dx||sy!=dy;)sx+=stepx,sy+=stepy;else{var a=genafrom2point(sx*gridw,sy*gridh,dx*gridw,dy*gridh),b=genbfrom2point(sx*gridw+(gridw>>1),sy*gridh+(gridh>>1),a);cx=sx*gridw+(gridw>>1),cy=sy*gridh+(gridh>>1);var dcx=dx*gridw+(gridw>>1),dcy=dy*gridh+(gridh>>1);if(stepx=gridw,stepy=gridh,dx<sx&&(stepx=0-gridw),dy<sy&&(stepy=0-gridh),addkey=(1e5*sx+sy).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(sx,sy))),ddy<ddx)for(;cy=a*(cx+=stepx/2)+b,cx%gridw==0&&cy%gridh==0?(addkey=(1e5*(addx=Math.floor(cx/gridw))+(addy=Math.floor(cy/gridh))).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx-=1)+(addy=addy)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx+=1)+(addy-=1)).toString()):addkey=(1e5*(addx=Math.floor(cx/gridw))+(addy=Math.floor(cy/gridh))).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx-=1)+(addy=addy)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),(cx+=stepx/2)!=dcx;);else if(ddx<ddy)for(;(cx=((cy+=stepy/2)-b)/a)%gridw==0&&cy%gridh==0?(addkey=(1e5*(addx=Math.floor(cx/gridw))+(addy=Math.floor(cy/gridh))).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx-=1)+(addy=addy)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx+=1)+(addy-=1)).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx-=1)+(addy=addy)).toString()):(addkey=(1e5*(addx=Math.floor(cx/gridw))+(addy=Math.floor(cy/gridh))).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),addkey=(1e5*(addx=addx)+(addy-=1)).toString()),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(addx,addy))),(cy+=stepy/2)!=dcy;);}return addkey=(1e5*dx+dy).toString(),0==tmp.hasOwnProperty(addkey)&&(tmp[addkey]=!0,ret.push(new laya.maths.Point(dx,dy))),ret}}(utils||(utils={}));